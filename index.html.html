<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è…åˆ©ç®¡å®¶ v2.0</title>
    <style>
        :root {
            --primary: #0077b6;
            --accent: #00b4d8;
            --bg: #f0f4f8;
            --white: #ffffff;
            --text: #333;
            --danger: #ef476f;
            --warning: #ffd166;
            --success: #06d6a0;
            --nav-height: 70px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: var(--bg); margin: 0; padding: 0; padding-bottom: calc(var(--nav-height) + 20px); color: var(--text); user-select: none; }

        /* --- Header --- */
        header { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 20px; border-radius: 0 0 25px 25px; box-shadow: 0 4px 15px rgba(0,119,182,0.3); text-align: center; position: sticky; top: 0; z-index: 100; }
        header h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }
        header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }

        /* --- Container & Sections --- */
        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Cards --- */
        .card { background: var(--white); border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); text-align: center; position: relative; overflow: hidden; }
        .card h2 { margin-top: 0; color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 2px solid #f0f4f8; padding-bottom: 10px; margin-bottom: 15px; }
        
        /* --- Inputs --- */
        .input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-group { flex: 1; text-align: left; }
        .input-group label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 2px solid #e1e5eb; border-radius: 12px; font-size: 1rem; background: #f9f9f9; outline: none; transition: 0.3s; appearance: none; }
        input:focus, select:focus { border-color: var(--primary); background: white; }
        /* Custom Arrow for Select */
        .select-wrapper { position: relative; }
        .select-wrapper::after { content: 'â–¼'; position: absolute; right: 15px; top: 40%; transform: translateY(-50%); color: #999; pointer-events: none; font-size: 0.8rem; }

        /* --- Buttons --- */
        .btn { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,119,182,0.3); transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); box-shadow: none; }
        .btn-next { background: var(--accent); margin-top: 15px; }
        
        /* --- Gauge Animation (è…åŠŸèƒ½å„€è¡¨æ¿) --- */
        .gauge-wrapper { position: relative; width: 200px; height: 100px; margin: 20px auto; overflow: hidden; }
        .gauge-bg { width: 200px; height: 200px; background: #e0e0e0; border-radius: 50%; position: absolute; top: 0; left: 0; }
        .gauge-fill { width: 200px; height: 200px; background: conic-gradient(var(--danger) 0% 30%, var(--warning) 30% 60%, var(--success) 60% 100%); border-radius: 50%; position: absolute; top: 0; left: 0; mask: radial-gradient(transparent 60%, black 61%); -webkit-mask: radial-gradient(transparent 60%, black 61%); transform: rotate(-90deg); opacity: 0.3; }
        .gauge-needle { width: 4px; height: 90px; background: #333; position: absolute; bottom: 0; left: 50%; transform-origin: bottom center; transform: rotate(-90deg); transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 4px; z-index: 2; }
        .gauge-value { position: absolute; bottom: -5px; left: 0; width: 100%; text-align: center; font-size: 2rem; font-weight: bold; color: var(--primary); }

        /* --- Diet Plate Visual --- */
        .plate-container { width: 200px; height: 200px; background: white; border-radius: 50%; border: 8px solid #eee; margin: 20px auto; position: relative; overflow: hidden; box-shadow: inset 0 0 20px rgba(0,0,0,0.1); display: flex; flex-wrap: wrap; }
        .plate-half { width: 50%; height: 100%; background: #d4edda; display: flex; align-items: center; justify-content: center; flex-direction: column; color: #155724; font-size: 0.8rem; border-right: 1px solid white; }
        .plate-quarter-container { width: 50%; height: 100%; display: flex; flex-direction: column; }
        .plate-quarter { width: 100%; height: 50%; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; font-size: 0.8rem; }
        .pq-protein { background: #f8d7da; color: #721c24; border-bottom: 1px solid white; }
        .pq-starch { background: #fff3cd; color: #856404; }
        .food-icon { font-size: 1.5rem; margin-bottom: 2px; }

        /* --- Sick Day Icons --- */
        .symptom-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .symptom-btn { background: white; border: 2px solid #eee; border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; transition: 0.2s; }
        .symptom-btn.selected { border-color: var(--danger); background: #fff5f5; transform: scale(1.02); }
        .symptom-icon { font-size: 2rem; display: block; margin-bottom: 5px; }

        /* --- Traffic Light --- */
        .traffic-container { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .light { width: 60px; height: 60px; border-radius: 50%; background: #ddd; opacity: 0.2; transition: 0.3s; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        .light.on { opacity: 1; transform: scale(1.1); box-shadow: 0 0 20px currentColor; }

        /* --- Bottom Nav --- */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-item { text-align: center; color: #999; font-size: 0.7rem; flex: 1; padding: 5px; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 1.5rem; display: block; margin-bottom: 3px; }

        /* --- Utility --- */
        .tag { padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; }
        .hidden { display: none; }
        .result-box { background: #e3f2fd; padding: 15px; border-radius: 12px; margin-top: 15px; text-align: left; border-left: 5px solid var(--primary); animation: fadeIn 0.3s ease; }
        .quiz-option { text-align: left; margin: 10px 0; padding: 12px; background: #f8f9fa; border: 2px solid #eee; border-radius: 10px; cursor: pointer; transition: 0.2s; }
        .quiz-option:active { background: #e9ecef; }
        .quiz-option.correct { border-color: var(--success); background: #d4edda; color: #155724; }
        .quiz-option.wrong { border-color: var(--danger); background: #f8d7da; color: #721c24; }
        
        .progress-bar { width: 100%; height: 6px; background: #eee; border-radius: 3px; margin-bottom: 15px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ›¡ï¸ è…åˆ©ç®¡å®¶ v2.0</h1>
    <p>è—¥å¸«èˆ‡æ‚¨çš„è­·è…å¥½å¤¥ä¼´</p>
</header>

<div class="container">

    <div id="tab-home" class="section active">
        <div class="card">
            <h2>ğŸ“Š æˆ‘çš„è…è‡Ÿåœ°åœ–</h2>
            <div class="input-row">
                <div class="input-group">
                    <label>eGFR (è…åŠŸèƒ½)</label>
                    <input type="number" id="egfr-input" placeholder="ä¾‹å¦‚ 45">
                </div>
                <div class="input-group">
                    <label>è›‹ç™½å°¿ (UACR)</label>
                    <div class="select-wrapper">
                        <select id="albumin-input">
                            <option value="A1">æ­£å¸¸/è¼•å¾® (A1)</option>
                            <option value="A2">ä¸­åº¦ (A2)</option>
                            <option value="A3">åš´é‡ (A3)</option>
                        </select>
                    </div>
                </div>
            </div>
            <button class="btn" onclick="updateRisk()">
                <span>ğŸš€ åˆ†æé¢¨éšª</span>
            </button>

            <div class="gauge-wrapper">
                <div class="gauge-bg"></div>
                <div class="gauge-fill"></div>
                <div class="gauge-needle" id="needle"></div>
                <div class="gauge-value" id="gauge-text">--</div>
            </div>
            <p id="risk-text" style="font-weight: bold; color: #666;">è¼¸å…¥æ•¸å€¼æŸ¥çœ‹æ‚¨çš„è½é»</p>
        </div>

        <div id="home-advice" class="hidden">
            <div class="card" style="background: #e3f2fd; border: 1px dashed var(--primary);">
                <h3>ğŸ‘¨â€âš•ï¸ è—¥å¸«çµ¦æ‚¨çš„é‡é»</h3>
                <ul style="text-align: left; padding-left: 20px; color: #444; line-height: 1.6;">
                    <li id="advice-1"></li>
                    <li id="advice-2"></li>
                    <li id="advice-3"></li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tab-meds" class="section">
        <div class="card">
            <h2>ğŸš¦ è—¥ç‰©å®‰å…¨ç´…ç¶ ç‡ˆ</h2>
            <p style="font-size: 0.9rem;">æŸ¥è©¢è—¥å“æˆ–è¡Œç‚ºæ˜¯å¦å‚·è… (æ”¶éŒ„20+é …)</p>
            <div class="select-wrapper">
                <select id="med-select" onchange="checkMed()">
                    <option value="">ğŸ” è«‹é¸æ“‡æŸ¥è©¢é …ç›®...</option>
                    <optgroup label="ğŸ”´ å±éšª / ç¦æ­¢ / éœ€ç‰¹åˆ¥æ³¨æ„">
                        <option value="nsaid">å¼·æ•ˆæ­¢ç—›è—¥ (NSAIDs)</option>
                        <option value="herbal">ä¾†è·¯ä¸æ˜ä¸­è‰è—¥/é»‘è—¥ä¸¸</option>
                        <option value="contrast">å«ç¢˜é¡¯å½±åŠ‘ (æª¢æŸ¥)</option>
                        <option value="mycin">éƒ¨åˆ†æŠ—ç”Ÿç´  (Aminoglycosides)</option>
                        <option value="starfruit_j">æ¥Šæ¡ƒæ±/æ¥Šæ¡ƒä¹¾</option>
                        <option value="smoking">å¸è¸ (å°¼å¤ä¸)</option>
                        <option value="hold_urine">é•·æœŸæ†‹å°¿</option>
                    </optgroup>
                    <optgroup label="ğŸŸ¡ è¬¹æ… / éœ€ç›£æ¸¬ / é©é‡">
                        <option value="diuretic">åˆ©å°¿åŠ‘ (Diuretics)</option>
                        <option value="metformin">é™ç³–è—¥ (Metformin)</option>
                        <option value="vit_d">ç¶­ç”Ÿç´  D (éˆ£ç£·å¹³è¡¡)</option>
                        <option value="multi_vit">ç¶œåˆç¶­ä»–å‘½</option>
                        <option value="enema">æ¸…è…¸åŠ‘ (å¤§è…¸é¡)</option>
                        <option value="antacid">å«é‹èƒƒè—¥/åˆ¶é…¸åŠ‘</option>
                        <option value="dehydration">å–æ°´ä¸è¶³/è„«æ°´</option>
                        <option value="constipation">é•·æœŸä¾¿ç§˜</option>
                    </optgroup>
                    <optgroup label="ğŸŸ¢ æ¨è–¦ / å®‰å…¨ / è­·è…">
                        <option value="sglt2">æ’ç³–è—¥ (SGLT2i)</option>
                        <option value="ras">è¡€å£“è—¥ (ACEi/ARB)</option>
                        <option value="panadol">æ™®æ‹¿ç–¼ (Acetaminophen)</option>
                        <option value="probiotic">è…è‡Ÿå°ˆç”¨ç›Šç”ŸèŒ</option>
                        <option value="bp_check">æ¯æ—¥é‡è¡€å£“</option>
                        <option value="vaccine">ç–«è‹—æ¥ç¨® (æµæ„Ÿ/è‚ºéˆ)</option>
                    </optgroup>
                </select>
            </div>
            
            <div class="traffic-container">
                <div id="light-r" class="light" style="color: var(--danger); background: var(--danger);"></div>
                <div id="light-y" class="light" style="color: var(--warning); background: var(--warning);"></div>
                <div id="light-g" class="light" style="color: var(--success); background: var(--success);"></div>
            </div>
            <div id="med-result" class="result-box hidden"></div>
        </div>

        <div class="card" style="border: 2px solid var(--danger);">
            <h2 style="color: var(--danger);">ğŸ¤’ ç”Ÿç—…åœè—¥ (Sick Day)</h2>
            <p style="font-size: 0.9rem;">è‹¥ç™¼ç”Ÿè„«æ°´ (åˆååˆæ‹‰)ï¼Œè«‹é»é¸ç—‡ç‹€ï¼š</p>
            <div class="symptom-grid">
                <div class="symptom-btn" onclick="toggleSymptom(this)">
                    <span class="symptom-icon">ğŸ¤®</span>å˜”å
                </div>
                <div class="symptom-btn" onclick="toggleSymptom(this)">
                    <span class="symptom-icon">ğŸš½</span>è…¹ç€‰
                </div>
                <div class="symptom-btn" onclick="toggleSymptom(this)">
                    <span class="symptom-icon">ğŸŒ¡ï¸</span>é«˜ç‡’
                </div>
                <div class="symptom-btn" onclick="toggleSymptom(this)">
                    <span class="symptom-icon">ğŸ’§</span>ç„¡æ³•å–æ°´
                </div>
            </div>
            <div id="sick-alert" class="hidden" style="background: #fff5f5; padding: 10px; border-radius: 10px; color: var(--danger); font-weight: bold; text-align: left;">
                ğŸš¨ å±éšªè­¦å ±ï¼(DAMN Rules)<br>
                è«‹è«®è©¢é†«å¸«æš«åœä»¥ä¸‹è—¥ç‰©ä»¥é˜²è…è¡°ç«­ï¼š<br>
                1. <strong>D</strong>iuretics (åˆ©å°¿åŠ‘)<br>
                2. <strong>A</strong>CEi/ARB (è¡€å£“è—¥)<br>
                3. <strong>M</strong>etformin (é™ç³–è—¥)<br>
                4. <strong>N</strong>SAIDs (æ­¢ç—›è—¥)<br>
                5. SGLT2i (æ’ç³–è—¥)
            </div>
        </div>
    </div>

    <div id="tab-diet" class="section">
        <div class="card">
            <h2>ğŸ½ï¸ è­·è…é¤ç›¤</h2>
            <p>æ¯é¤çš„é»ƒé‡‘æ¯”ä¾‹ (CKDæœªé€æ)</p>
            <div class="plate-container">
                <div class="plate-half">
                    <span class="food-icon">ğŸ¥¦</span>
                    <span>50%<br>è”¬èœ/æ°´æœ</span>
                </div>
                <div class="plate-quarter-container">
                    <div class="plate-quarter pq-protein">
                        <span class="food-icon">ğŸ¥š</span>
                        <span>25%<br>è±†/é­š/è›‹</span>
                    </div>
                    <div class="plate-quarter pq-starch">
                        <span class="food-icon">ğŸš</span>
                        <span>25%<br>ä½æ°®æ¾±ç²‰</span>
                    </div>
                </div>
            </div>
            <div style="text-align: left; background: #f9f9f9; padding: 10px; border-radius: 8px; font-size: 0.9rem;">
                <p>ğŸ’¡ <strong>KDIGO 2024 é‡é»ï¼š</strong></p>
                <ul>
                    <li>å„ªå…ˆåƒã€Œæ¤ç‰©æ€§è›‹ç™½ã€(è±†è…ã€æ¯›è±†)ã€‚</li>
                    <li>é¿å…åŠ å·¥è‚‰å“ (å¦‚é¦™è…¸ã€ç«è…¿)ã€‚</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ¥— é£Ÿç‰©æŸ¥è©¢åœ°é›·å€</h2>
            <p style="font-size: 0.9rem;">é€™å€‹å¯ä»¥åƒå—ï¼Ÿ(æ”¶éŒ„20+é …)</p>
            <div class="select-wrapper">
                <select id="food-select" onchange="checkFood()">
                    <option value="">ğŸ¥’ è«‹é¸æ“‡é£Ÿç‰©...</option>
                    <optgroup label="ğŸŸ¢ ç¶ ç‡ˆ (æ¨è–¦/é©é‡)">
                        <option value="egg_white">é›è›‹ç™½ (å„ªè³ªè›‹ç™½)</option>
                        <option value="tofu">å«©è±†è… (æ¤ç‰©è›‹ç™½)</option>
                        <option value="rice_noodle">å†¬ç²‰/ç±³ç²‰ (ä½æ°®æ¾±ç²‰)</option>
                        <option value="white_rice">ç™½é£¯ (æ¯”ç³™ç±³ä½ç£·)</option>
                        <option value="cabbage">é«˜éº—èœ/æ´‹è”¥ (ä½é‰€)</option>
                        <option value="apple">è˜‹æœ/é³³æ¢¨ (ä½é‰€)</option>
                        <option value="olive_oil">æ©„æ¬–æ²¹/è‹¦èŒ¶æ²¹ (å¥½æ²¹)</option>
                    </optgroup>
                    <optgroup label="ğŸŸ¡ é»ƒç‡ˆ (éœ€æ¸›é‡/è™•ç†)">
                        <option value="spinach">è èœ/åœ°ç“œè‘‰ (é«˜é‰€-éœ€æ±†ç‡™)</option>
                        <option value="brown_rice">ç³™ç±³/äº”ç©€ç±³ (é«˜ç£·)</option>
                        <option value="nuts">å …æœ (é«˜ç£·é‰€)</option>
                        <option value="coffee">é»‘å’–å•¡ (åˆ©å°¿/å«é‰€)</option>
                        <option value="kiwi">å¥‡ç•°æœ (é‰€ç¨é«˜)</option>
                        <option value="banana">é¦™è•‰ (é«˜é‰€)</option>
                    </optgroup>
                    <optgroup label="ğŸ”´ ç´…ç‡ˆ (å±éšª/ç¦æ­¢)">
                        <option value="starfruit">æ¥Šæ¡ƒ (ç¥ç¶“æ¯’ç´ -çµ•å°ç¦æ­¢)</option>
                        <option value="processed_meat">é¦™è…¸/ç«è…¿ (ç„¡æ©Ÿç£·)</option>
                        <option value="organs">è±¬è‚/è…°å­/å…§è‡Ÿ (é«˜æ¯’ç´ )</option>
                        <option value="low_na_salt">ä½éˆ‰é¹½/è–„é¹½é†¬æ²¹ (é«˜é‰€)</option>
                        <option value="cola">å¯æ¨‚/ç¢³é…¸é£²æ–™ (é«˜ç£·é…¸)</option>
                        <option value="chicken_essence">é›ç²¾/æ»´é›ç²¾ (é«˜é‰€)</option>
                        <option value="instant_noodle">æ³¡éºµæ¹¯/é†ƒæ¼¬ç‰© (é«˜éˆ‰)</option>
                        <option value="pastry">æ²¹æ¢/éºµåŒ… (å«é‹è†¨é¬†åŠ‘)</option>
                    </optgroup>
                </select>
            </div>
            <div id="food-result" class="result-box hidden"></div>
        </div>
    </div>

    <div id="tab-quiz" class="section">
        <div class="card">
            <h2>ğŸ“ è…åˆ©å¤§æœƒè€ƒ</h2>
            <div class="progress-bar"><div id="quiz-progress" class="progress-fill"></div></div>
            <p id="quiz-counter" style="font-size:0.8rem; color:#999; text-align:right;">Q1/10</p>
            
            <div id="quiz-area">
                <h3 id="quiz-question" style="color: #444; min-height: 60px;">è¼‰å…¥ä¸­...</h3>
                <div id="quiz-options"></div>
            </div>

            <div id="quiz-feedback-box" class="hidden" style="margin-top: 20px;">
                <div id="quiz-feedback-text" style="font-weight: bold; margin-bottom: 10px;"></div>
                <div id="quiz-explanation" style="font-size: 0.9rem; color: #555; background: #fff; padding: 10px; border-radius: 8px;"></div>
                <button class="btn btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ âœ</button>
            </div>

            <div id="quiz-score-area" class="hidden">
                <h3 style="font-size: 2rem; color: var(--primary);">å¾—åˆ†ï¼š<span id="final-score">0</span> / 100</h3>
                <p id="score-comment"></p>
                <button class="btn" onclick="restartQuiz()">ğŸ”„ å†æ¸¬ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)">
        <span class="nav-icon">ğŸ </span>
        é¦–é 
    </div>
    <div class="nav-item" onclick="switchTab('meds', this)">
        <span class="nav-icon">ğŸ’Š</span>
        ç”¨è—¥
    </div>
    <div class="nav-item" onclick="switchTab('diet', this)">
        <span class="nav-icon">ğŸ¥¦</span>
        é£²é£Ÿ
    </div>
    <div class="nav-item" onclick="switchTab('quiz', this)">
        <span class="nav-icon">ğŸ“</span>
        æ¸¬é©—
    </div>
</nav>

<script>
    // --- è³‡æ–™åº« (Data) ---
    
    // 1. è—¥ç‰©è³‡æ–™åº« (Med DB)
    const medDB = {
        'nsaid': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (NSAIDs)', desc: 'æœ€å¼·çƒˆçš„è…è‡Ÿæ®ºæ‰‹ï¼é€™é¡æ­¢ç—›è—¥æœƒæ”¶ç¸®å…¥çƒå°å‹•è„ˆï¼Œæ¥µæ˜“é€ æˆæ€¥æ€§è…æå‚·ã€‚è«‹æ”¹ç”¨æ™®æ‹¿ç–¼ã€‚' },
        'herbal': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (ä¸­è‰è—¥)', desc: 'ä¾†è·¯ä¸æ˜çš„é»‘è—¥ä¸¸æˆ–å«é¦¬å…œéˆ´é…¸è—¥æï¼Œæ˜¯å°ç£æ´—è…ä¸»å› ä¹‹ä¸€ã€‚è«‹å‹¿è½ä¿¡é›»å°å»£å‘Šã€‚' },
        'contrast': { level: 'r', title: 'âš ï¸ é«˜é¢¨éšª (é¡¯å½±åŠ‘)', desc: 'åš CT æª¢æŸ¥å‰è«‹å‹™å¿…å‘ŠçŸ¥é†«å¸«æ‚¨çš„ eGFRã€‚æª¢æŸ¥å¾Œéœ€å¤§é‡å–æ°´å¹«åŠ©ä»£è¬ã€‚' },
        'mycin': { level: 'r', title: 'âš ï¸ é«˜é¢¨éšª (æŠ—ç”Ÿç´ )', desc: 'æŸäº›æŠ—ç”Ÿç´  (å¦‚ Aminoglycosides) å…·è…æ¯’æ€§ï¼Œä½¿ç”¨æ™‚éœ€ç›£æ¸¬è—¥ç‰©æ¿ƒåº¦ã€‚' },
        'starfruit_j': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (æ¥Šæ¡ƒ)', desc: 'æ¥Šæ¡ƒå«ç¥ç¶“æ¯’ç´ ï¼Œè…å‹ç„¡æ³•æ’å‡ºï¼Œæœƒå°è‡´æ‰“å—ã€ç™²ç™‡ç”šè‡³æ˜è¿·ã€‚' },
        'smoking': { level: 'r', title: 'ğŸ›‘ å»ºè­°æˆ’é™¤ (å¸è¸)', desc: 'å°¼å¤ä¸æœƒæ”¶ç¸®è…è‡Ÿè¡€ç®¡ï¼ŒåŠ é€Ÿè…çµ²çƒç¡¬åŒ–ã€‚æˆ’è¸æ˜¯è­·è…ç¬¬ä¸€æ­¥ã€‚' },
        'hold_urine': { level: 'r', title: 'ğŸ›‘ å£ç¿’æ…£ (æ†‹å°¿)', desc: 'æ˜“å¼•ç™¼æ³Œå°¿é“æ„ŸæŸ“ï¼Œç´°èŒé€†è¡Œå‘ä¸Šæå°è‡´è…ç›‚è…ç‚ï¼Œæå‚·è…åŠŸèƒ½ã€‚' },
        
        'diuretic': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (åˆ©å°¿åŠ‘)', desc: 'æœ‰åŠ©æ¶ˆæ°´è…«ï¼Œä½†è‹¥è„«æ°´æˆ–ç”Ÿç—… (Sick Day) æ™‚éœ€è©•ä¼°æš«åœï¼Œä»¥å…æ€¥æ€§è…è¡°ç«­ã€‚' },
        'metformin': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (é™ç³–è—¥)', desc: 'eGFR < 30 åˆ†æ™‚é€šå¸¸éœ€åœç”¨ï¼Œä»¥å…ç™¼ç”Ÿä¹³é…¸ä¸­æ¯’ã€‚' },
        'vit_d': { level: 'y', title: 'ğŸŸ¡ éœ€ç›£æ¸¬ (ç¶­ç”Ÿç´ D)', desc: 'å»ºè­°ç”±é†«å¸«é–‹ç«‹æ´»æ€§ç¶­ç”Ÿç´  Dï¼Œéœ€å®šæœŸç›£æ¸¬è¡€éˆ£èˆ‡è¡€ç£·æ¿ƒåº¦ã€‚' },
        'multi_vit': { level: 'y', title: 'ğŸŸ¡ éœ€æŒ‘é¸ (ç¶œåˆç¶­ä»–å‘½)', desc: 'å¸‚å”®ç”¢å“å¯èƒ½å«é«˜ç£·ã€é«˜é‰€ã€‚é€æç—…æ‚£å»ºè­°è£œå……å°ˆç”¨æ°´æº¶æ€§ B ç¾¤ã€‚' },
        'enema': { level: 'y', title: 'ğŸŸ¡ éœ€å‘ŠçŸ¥ (æ¸…è…¸åŠ‘)', desc: 'å«ç£·é…¸éˆ‰çš„æ¸…è…¸åŠ‘å¯èƒ½é€ æˆæ€¥æ€§ç£·è…ç—…è®Šï¼Œè«‹äº‹å…ˆå‘ŠçŸ¥é†«å¸«ç—…å²ã€‚' },
        'antacid': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (èƒƒè—¥)', desc: 'é¿å…é•·æœŸæœç”¨å«ã€Œé‹ã€æˆ–ã€Œé‚ã€çš„åˆ¶é…¸åŠ‘ï¼Œè…è‡Ÿç„¡æ³•ä»£è¬æä¸­æ¯’ã€‚' },
        'dehydration': { level: 'y', title: 'ğŸŸ¡ éœ€å–æ°´ (è„«æ°´)', desc: 'é™¤éé†«å¸«é™æ°´ï¼Œå¦å‰‡é£²æ°´ä¸è¶³æœƒæ¸›å°‘è…è‡Ÿè¡€æµã€‚' },
        'constipation': { level: 'y', title: 'ğŸŸ¡ éœ€æ”¹å–„ (ä¾¿ç§˜)', desc: 'ä¾¿ç§˜æœƒå¢åŠ è…¸é“å°¿æ¯’ç´ çš„å¸æ”¶ï¼ŒåŠ é‡è…è‡Ÿè² æ“”ã€‚' },

        'sglt2': { level: 'g', title: 'âœ… å¼·åŠ›æ¨è–¦ (æ’ç³–è—¥)', desc: 'æ–°ä¸€ä»£è­·è…ç¥è—¥ï¼èƒ½é¡¯è‘—å»¶ç·©æ´—è…æ™‚é–“ä¸¦ä¿è­·å¿ƒè‡Ÿï¼Œä½†éœ€æ³¨æ„ç”Ÿæ®–å™¨æ¸…æ½”ã€‚' },
        'ras': { level: 'g', title: 'âœ… å¼·åŠ›æ¨è–¦ (ACEi/ARB)', desc: 'é›–çŸ­æœŸå¯èƒ½è®“ eGFR å¾®é™ï¼Œä½†é•·æœŸèƒ½æ¸›å°‘è›‹ç™½å°¿ï¼Œæ˜¯æ ¸å¿ƒè­·è…è—¥ç‰©ã€‚' },
        'panadol': { level: 'g', title: 'âœ… ç›¸å°å®‰å…¨ (æ™®æ‹¿ç–¼)', desc: 'è‹¥éœ€æ­¢ç—›é€€ç‡’ï¼ŒAcetaminophen åœ¨å®‰å…¨åŠ‘é‡ä¸‹ä¸å‚·è…ï¼Œæ˜¯é¦–é¸è—¥ç‰©ã€‚' },
        'probiotic': { level: 'g', title: 'âœ… è¼”åŠ©æ¨è–¦ (ç›Šç”ŸèŒ)', desc: 'éƒ¨åˆ†ç‰¹å®šèŒæ ªè­‰å¯¦æœ‰åŠ©æ¸›å°‘è…¸é“å°¿æ¯’ç´ å‰é©…ç‰©ã€‚' },
        'bp_check': { level: 'g', title: 'âœ… å¿…è¦è¡Œç‚º (é‡è¡€å£“)', desc: 'æ§åˆ¶è¡€å£“ (<130/80) æ˜¯å»¶ç·©æ´—è…æœ€é‡è¦çš„ä¸€ä»¶äº‹ã€‚' },
        'vaccine': { level: 'g', title: 'âœ… å»ºè­°æ–½æ‰“ (ç–«è‹—)', desc: 'é é˜²æµæ„Ÿèˆ‡è‚ºç‚ï¼Œæ¸›å°‘å› åš´é‡æ„ŸæŸ“å¼•ç™¼æ€¥æ€§è…æå‚·çš„é¢¨éšªã€‚' }
    };

    // 2. é£²é£Ÿè³‡æ–™åº« (Food DB)
    const foodDB = {
        'egg_white': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (å„ªè³ª)', d: 'é«˜ç”Ÿç‰©åƒ¹è›‹ç™½è³ªï¼Œç£·å«é‡ä½ï¼Œæ˜¯è…å‹è£œå……ç‡Ÿé¤Šçš„é¦–é¸ã€‚' },
        'tofu': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (å„ªè³ª)', d: 'æ¤ç‰©æ€§è›‹ç™½ç”¢ç”Ÿçš„å«æ°®å»¢ç‰©è¼ƒå°‘ï¼Œä¸”åŠ å·¥éç¨‹ç£·è¼ƒä½ (å„ªæ–¼ç™¾é )ã€‚' },
        'rice_noodle': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (ä¸»é£Ÿ)', d: 'ä½æ°®æ¾±ç²‰ï¼ç†±é‡å¤ ä¸”å¹¾ä¹ä¸ç”¢ç”Ÿå°¿æ¯’ç´ ï¼Œé©åˆå–ä»£éƒ¨åˆ†ç±³é£¯ã€‚' },
        'white_rice': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (ä¸»é£Ÿ)', d: 'é›–ç„¶ä¸å¦‚ç³™ç±³ç‡Ÿé¤Šï¼Œä½†å°æ™šæœŸè…è‡Ÿç—…ä¾†èªªï¼Œã€Œä½ç£·ã€çš„ç™½é£¯æ¯”è¼ƒå®‰å…¨ã€‚' },
        'cabbage': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (è”¬èœ)', d: 'é«˜éº—èœã€æ´‹è”¥å±¬æ–¼ä½é‰€è”¬èœï¼Œé©åˆé£Ÿç”¨ã€‚' },
        'apple': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (æ°´æœ)', d: 'è˜‹æœã€é³³æ¢¨ã€è‘¡è„å±¬æ–¼ä½é‰€æ°´æœï¼Œå¯é©é‡é£Ÿç”¨ã€‚' },
        'olive_oil': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (æ²¹è„‚)', d: 'å„ªè³ªä¸é£½å’Œè„‚è‚ªé…¸ï¼Œè£œå……ç†±é‡ä¸”ä¸å‚·è…ã€‚' },
        
        'spinach': { t: 'ğŸŸ¡ é»ƒç‡ˆ (é«˜é‰€)', d: 'æ·±ç¶ è‰²è”¬èœé€šå¸¸é«˜é‰€ã€‚å»ºè­°åˆ‡æ®µå¾Œã€Œæ±†ç‡™ã€3åˆ†é˜ï¼Œè®“é‰€æµå¤±å¾Œå†æ‹Œæ²¹åƒã€‚' },
        'brown_rice': { t: 'ğŸŸ¡ é»ƒç‡ˆ (é«˜ç£·)', d: 'ç³™ç±³ã€äº”ç©€ç±³ç£·å«é‡é«˜ï¼ŒåˆæœŸ CKD å¯åƒï¼Œæ™šæœŸå»ºè­°æ”¹åƒç™½é£¯ã€‚' },
        'nuts': { t: 'ğŸŸ¡ é»ƒç‡ˆ (é«˜ç£·é‰€)', d: 'é›–è­·å¿ƒä½†ç£·é‰€çš†é«˜ã€‚ä¸€å¤©é™åˆ¶ 5 é¡†ï¼Œæˆ–è¡€ç£·é«˜è€…é¿å…ã€‚' },
        'coffee': { t: 'ğŸŸ¡ é»ƒç‡ˆ (å’–å•¡å› )', d: 'é»‘å’–å•¡å«é‰€ï¼Œä¸”åˆ©å°¿å¯èƒ½å½±éŸ¿æ°´åˆ†ã€‚å»ºè­°æ¯æ—¥ä¸€æ¯ç‚ºé™ï¼Œé¿å…åŠ å¥¶ç²¾ã€‚' },
        'kiwi': { t: 'ğŸŸ¡ é»ƒç‡ˆ (æ°´æœ)', d: 'é‰€å«é‡ä¸­ç­‰åé«˜ï¼Œéœ€è¦–ç•¶æ¬¡æŠ½è¡€å ±å‘Šæ±ºå®šæ˜¯å¦é™é‡ã€‚' },
        'banana': { t: 'ğŸŸ¡ é»ƒç‡ˆ (é«˜é‰€)', d: 'è‘—åçš„å¥½é‰€æ°´æœï¼Œè¡€é‰€ä¸ç©©è€…æ‡‰é¿å…ã€‚' },

        'starfruit': { t: 'ğŸ”´ ç´…ç‡ˆ (åŠ‡æ¯’)', d: 'çµ•å°ç¦æ­¢ï¼å«ç¥ç¶“æ¯’ç´ ï¼Œè…ç—…æ‚£è€…é£Ÿç”¨æœƒå¼•ç™¼åš´é‡ç¥ç¶“ç—‡ç‹€ã€‚' },
        'processed_meat': { t: 'ğŸ”´ ç´…ç‡ˆ (ç„¡æ©Ÿç£·)', d: 'é¦™è…¸ã€ç«è…¿æ·»åŠ ã€Œç£·é…¸é¹½ã€ï¼Œå¸æ”¶ç‡100%ï¼Œæ¥µåº¦å‚·è¡€ç®¡èˆ‡éª¨é ­ã€‚' },
        'organs': { t: 'ğŸ”´ ç´…ç‡ˆ (é«˜æ¯’ç´ )', d: 'å…§è‡Ÿé¡è†½å›ºé†‡èˆ‡ç£·å«é‡æ¥µé«˜ï¼Œç—›é¢¨èˆ‡è…å‹æ‡‰ç¦é£Ÿã€‚' },
        'low_na_salt': { t: 'ğŸ”´ ç´…ç‡ˆ (é«˜é‰€)', d: 'ä½éˆ‰é¹½é€šå¸¸æ˜¯ã€Œä»¥é‰€ä»£éˆ‰ã€ï¼Œå°æ’é‰€åŠŸèƒ½å·®çš„è…å‹æ˜¯è‡´å‘½æ¯’è—¥ã€‚' },
        'cola': { t: 'ğŸ”´ ç´…ç‡ˆ (é«˜ç£·)', d: 'ç¢³é…¸é£²æ–™å«å¤§é‡ã€Œç£·é…¸ã€ï¼Œæ˜¯é«˜è¡€ç£·çš„éš±å½¢æ®ºæ‰‹ã€‚' },
        'chicken_essence': { t: 'ğŸ”´ ç´…ç‡ˆ (æ¿ƒç¸®)', d: 'æ¿ƒç¸®çš„é‰€é›¢å­èˆ‡æ™®æ—ï¼ŒæœƒåŠ é‡è…è‡Ÿè² æ“”ã€‚' },
        'instant_noodle': { t: 'ğŸ”´ ç´…ç‡ˆ (é«˜éˆ‰)', d: 'æ¹¯é ­éˆ‰å«é‡é©šäººï¼Œéºµé«”å¸¸å«ç£·é…¸é¹½ã€‚' },
        'pastry': { t: 'ğŸ”´ ç´…ç‡ˆ (å«é‹)', d: 'æ²¹æ¢ã€ç³•é»å¸¸å«å«é‹è†¨é¬†åŠ‘ï¼Œè…å‹ç„¡æ³•æ’é‹æå°è‡´è…¦ç—…è®Šã€‚' }
    };

    // 3. æ¸¬é©—é¡Œåº« (Quiz DB - 10é¡Œ)
    const quizDB = [
        { q: "å› ç‚ºæˆ‘æœ‰è…è‡Ÿç—…ï¼Œæ‰€ä»¥è¦æ”¹åƒã€Œè–„é¹½é†¬æ²¹ã€æˆ–ã€Œä½éˆ‰é¹½ã€æ¯”è¼ƒå¥åº·ï¼Ÿ", a: [ {t:"å°ï¼Œå°‘é¹½å°±æ˜¯å¥½", c:false}, {t:"éŒ¯ï¼Œé‚£äº›é€šå¸¸æ˜¯é«˜é‰€ç”¢å“", c:true} ], exp: "ä½éˆ‰ç”¢å“å¸¸ä»¥ã€Œé‰€ã€å–ä»£éˆ‰ï¼Œå°è…å‹ä¾†èªªå¯èƒ½å°è‡´é«˜è¡€é‰€å¿ƒå¾‹ä¸æ•´ã€‚" },
        { q: "é—œæ–¼æ°´åˆ†æ”å–ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ", a: [ {t:"è…è‡Ÿç—…å®Œå…¨ä¸èƒ½å–æ°´", c:false}, {t:"æ²’æœ‰æ°´è…«ä¸‹ï¼Œæ‡‰é©é‡å–æ°´", c:true} ], exp: "é™¤éå·²é€ææˆ–åš´é‡æ°´è…«ï¼Œå¦å‰‡æ°´åˆ†ä¸è¶³æœƒæ¸›å°‘è…è‡Ÿè¡€æµï¼Œåè€Œå‚·è…ã€‚" },
        { q: "æˆ‘æ„Ÿå†’å…¨èº«ç— ç—›ï¼Œå»è—¥å±€è²·ã€Œå¼·æ•ˆæ­¢ç—›è—¥ (NSAID)ã€åƒæ¯”è¼ƒå¿«å¥½ï¼Ÿ", a: [ {t:"çµ•å°ä¸å¯ï¼Œæœƒå‚·è…", c:true}, {t:"å¯ä»¥ï¼Œåªè¦ä¸åƒè¶…éä¸‰å¤©", c:false} ], exp: "NSAIDs æ˜¯å¸¸è¦‹å‚·è…è—¥ç‰©ï¼Œæœƒé€ æˆæ€¥æ€§è…æå‚·ã€‚è«‹æ”¹ç”¨æ™®æ‹¿ç–¼æˆ–è«®è©¢é†«å¸«ã€‚" },
        { q: "å°¿æ¶²æœ‰æ³¡æ³¡ï¼Œä¸€å®šå°±æ˜¯è…è‡Ÿå£æ‰äº†å—ï¼Ÿ", a: [ {t:"ä¸ä¸€å®šï¼Œéœ€æª¢é©—ç¢ºèª", c:true}, {t:"å°ï¼Œç«‹åˆ»æº–å‚™æ´—è…", c:false} ], exp: "è¡åŠ›å¤§æˆ–å°¿å¤ªæ¿ƒä¹Ÿæœƒæœ‰æ³¡æ³¡ã€‚è‹¥æ³¡æ³¡ã€Œ10åˆ†é˜ä¸æ•£ã€æ‰é«˜åº¦æ‡·ç–‘æ˜¯è›‹ç™½å°¿ã€‚" },
        { q: "é†«ç”Ÿé–‹çš„ã€Œéˆ£ç‰‡ã€å¥½å¤§é¡†ï¼Œæˆ‘ä¸æƒ³åƒå¯ä»¥å—ï¼Ÿ", a: [ {t:"å¯ä»¥ï¼Œé‚£æ˜¯è£œéª¨é ­çš„", c:false}, {t:"ä¸è¡Œï¼Œé‚£æ˜¯é™ç£·ç”¨çš„", c:true} ], exp: "è…å‹çš„éˆ£ç‰‡é€šå¸¸ä½œç‚ºã€Œç£·çµåˆåŠ‘ã€ï¼Œéœ€éš¨é¤å’¬ç¢æœç”¨ä»¥å¸é™„é£Ÿç‰©ä¸­çš„ç£·ã€‚" },
        { q: "æ¥Šæ¡ƒå¾ˆå¥½åƒï¼Œæˆ‘åªåƒã€Œä¸€å£ã€æ‡‰è©²æ²’é—œä¿‚å§ï¼Ÿ", a: [ {t:"çµ•å°ç¦æ­¢", c:true}, {t:"æ²’é—œä¿‚ï¼Œä¸è¦å–æ±å°±å¥½", c:false} ], exp: "æ¥Šæ¡ƒå«ç¥ç¶“æ¯’ç´ ï¼Œè…åŠŸèƒ½ä¸å…¨è€…ç„¡æ³•ä»£è¬ï¼Œåš´é‡æè‡´æ˜è¿·ã€‚" },
        { q: "SGLT2 æŠ‘åˆ¶åŠ‘ï¼ˆæ’ç³–è—¥ï¼‰é™¤äº†é™è¡€ç³–ï¼Œé‚„æœ‰ä»€éº¼åŠŸèƒ½ï¼Ÿ", a: [ {t:"ä¿è­·å¿ƒè‡Ÿèˆ‡å»¶ç·©è…æƒ¡åŒ–", c:true}, {t:"åªæœ‰é™è¡€ç³–", c:false} ], exp: "é€™æ˜¯åœ‹éš›æŒ‡å¼•æ¨è–¦çš„è­·è…è—¥ç‰©ï¼Œå³ä½¿ç„¡ç³–å°¿ç—…çš„è…å‹ä¹Ÿå¯èƒ½ä½¿ç”¨ã€‚" },
        { q: "è½èªªã€Œè…°å­ï¼ˆè…è‡Ÿï¼‰ã€ä»¥å½¢è£œå½¢ï¼Œè…ä¸å¥½è¦å¤šåƒè±¬è…°å­ï¼Ÿ", a: [ {t:"å°ï¼Œåƒè…è£œè…", c:false}, {t:"éŒ¯ï¼Œé‚£æ˜¯é«˜æ¯’ç´ é£Ÿç‰©", c:true} ], exp: "å…§è‡Ÿé¡å«æ¥µé«˜ç£·èˆ‡æ¯’ç´ ï¼Œåƒå¤šåè€ŒåŠ é€Ÿè…è¡°ç«­ã€‚" },
        { q: "ä¸€æ—¦é–‹å§‹æ´—è…ï¼ˆé€æï¼‰ï¼Œé€™è¼©å­å°±æ²’æ•‘äº†å—ï¼Ÿ", a: [ {t:"éŒ¯ï¼Œé€æä»å¯ç¶­æŒç”Ÿæ´»å“è³ª", c:true}, {t:"å°ï¼Œäººç”Ÿè®Šé»‘ç™½çš„", c:false} ], exp: "é€ææ˜¯å»¶çºŒç”Ÿå‘½çš„æ–¹å¼ï¼Œè¨±å¤šè…å‹ä»èƒ½å·¥ä½œã€æ—…éŠï¼Œæˆ–ç­‰å¾…è…è‡Ÿç§»æ¤ã€‚" },
        { q: "è…è‡Ÿä¸å¥½çš„äººï¼Œé‹å‹•æœƒè®“è…°æ›´ç— ï¼Œæ‰€ä»¥è¦å¤šèººè‘—ä¼‘æ¯ï¼Ÿ", a: [ {t:"å°ï¼Œèƒ½ä¸å‹•å°±ä¸å‹•", c:false}, {t:"éŒ¯ï¼Œé©åº¦é‹å‹•åè€Œè­·è…", c:true} ], exp: "è¦å¾‹é‹å‹•ï¼ˆå¦‚å¿«èµ°ï¼‰èƒ½æ§åˆ¶ä¸‰é«˜ï¼Œæ˜¯ä¿è­·è…è‡Ÿçš„é‡è¦ç”Ÿæ´»ç¿’æ…£ã€‚" }
    ];

    // --- ç¨‹å¼é‚è¼¯ ---

    // å°èˆªåˆ‡æ›
    function switchTab(tabId, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        window.scrollTo(0,0);
    }

    // 1. é¢¨éšªå„€è¡¨æ¿
    function updateRisk() {
        const egfr = parseFloat(document.getElementById('egfr-input').value);
        const albumin = document.getElementById('albumin-input').value;
        const needle = document.getElementById('needle');
        const text = document.getElementById('risk-text');
        const gaugeVal = document.getElementById('gauge-text');
        const adviceBox = document.getElementById('home-advice');

        if (!egfr) { alert("è«‹è¼¸å…¥ eGFR æ•¸å€¼"); return; }
        gaugeVal.innerText = egfr;

        // è¨ˆç®—è§’åº¦ (-90deg ~ 90deg)
        let angle = -90 + (Math.min(Math.max(egfr, 0), 120) / 120) * 180;
        needle.style.transform = `rotate(${angle}deg)`;

        let riskLevel = "";
        let color = "";
        
        if (egfr >= 60 && albumin === 'A1') {
            riskLevel = "ä½é¢¨éšª (ç¶ ç‡ˆ)";
            color = "var(--success)";
            document.getElementById('advice-1').innerText = "ç¶­æŒå¥åº·ç”Ÿæ´»ï¼Œæ¯å¹´å®šæœŸæª¢æŸ¥å³å¯ã€‚";
            document.getElementById('advice-2').innerText = "é£²é£Ÿå‡è¡¡ï¼Œä¸éœ€éåº¦é™åˆ¶è›‹ç™½è³ªã€‚";
            document.getElementById('advice-3').innerText = "é¿å…ä½¿ç”¨ NSAID æ­¢ç—›è—¥èˆ‡ä¾†è·¯ä¸æ˜ä¸­è‰è—¥ã€‚";
        } else if (egfr < 45 || albumin === 'A3') {
            riskLevel = "é«˜é¢¨éšª (ç´…ç‡ˆ)";
            color = "var(--danger)";
            document.getElementById('advice-1').innerText = "åš´æ ¼æ§åˆ¶è¡€å£“èˆ‡è›‹ç™½å°¿ (ACEi/ARB)ã€‚";
            document.getElementById('advice-2').innerText = "ä½è›‹ç™½é£²é£Ÿ (0.8 g/kg)ï¼Œé¿å…åŠ å·¥é£Ÿå“ã€‚";
            document.getElementById('advice-3').innerText = "è«®è©¢é†«å¸«æ˜¯å¦ä½¿ç”¨ SGLT2 æ’ç³–è—¥ä¿è­·å¿ƒè…ã€‚";
        } else {
            riskLevel = "ä¸­åº¦é¢¨éšª (é»ƒç‡ˆ)";
            color = "var(--warning)";
            document.getElementById('advice-1').innerText = "æ¯ 3-6 å€‹æœˆè¿½è¹¤ä¸€æ¬¡è…åŠŸèƒ½ã€‚";
            document.getElementById('advice-2').innerText = "æ³¨æ„è¡€å£“æ§åˆ¶ï¼Œæ¸›å°‘é¹½åˆ†æ”å–ã€‚";
            document.getElementById('advice-3').innerText = "è‹¥æœ‰ç³–å°¿ç—…ï¼Œå‹™å¿…åš´æ ¼æ§ç³–ã€‚";
        }

        text.innerHTML = `é¢¨éšªç­‰ç´šï¼š<span style="color:${color}; font-size: 1.2rem;">${riskLevel}</span>`;
        adviceBox.classList.remove('hidden');
    }

    // 2. è—¥ç‰©æŸ¥è©¢
    function checkMed() {
        const val = document.getElementById('med-select').value;
        const lights = document.querySelectorAll('.light');
        const res = document.getElementById('med-result');
        
        lights.forEach(l => l.classList.remove('on'));
        res.classList.add('hidden');
        if(!val) return;

        const data = medDB[val];
        res.classList.remove('hidden');
        res.innerHTML = `<strong>${data.title}</strong><br>${data.desc}`;
        
        if (data.level === 'r') {
            document.getElementById('light-r').classList.add('on');
            res.style.borderColor = "var(--danger)";
            res.style.background = "#fff5f5";
        } else if (data.level === 'y') {
            document.getElementById('light-y').classList.add('on');
            res.style.borderColor = "var(--warning)";
            res.style.background = "#fffbf0";
        } else {
            document.getElementById('light-g').classList.add('on');
            res.style.borderColor = "var(--success)";
            res.style.background = "#e6fffa";
        }
    }

    // 3. ç”Ÿç—…ç—‡ç‹€
    function toggleSymptom(btn) {
        btn.classList.toggle('selected');
        const anySelected = document.querySelectorAll('.symptom-btn.selected').length > 0;
        const alertBox = document.getElementById('sick-alert');
        anySelected ? alertBox.classList.remove('hidden') : alertBox.classList.add('hidden');
    }

    // 4. é£²é£ŸæŸ¥è©¢
    function checkFood() {
        const val = document.getElementById('food-select').value;
        const res = document.getElementById('food-result');
        res.classList.add('hidden');
        if(!val) return;

        const data = foodDB[val];
        res.classList.remove('hidden');
        res.innerHTML = `<strong>${data.t}</strong><br>${data.d}`;
        
        if (data.t.includes("ç´…ç‡ˆ")) {
            res.style.borderColor = "var(--danger)";
            res.style.background = "#fff5f5";
            res.style.color = "#721c24";
        } else if (data.t.includes("é»ƒç‡ˆ")) {
            res.style.borderColor = "var(--warning)";
            res.style.background = "#fffbf0";
            res.style.color = "#856404";
        } else {
            res.style.borderColor = "var(--success)";
            res.style.background = "#e6fffa";
            res.style.color = "#155724";
        }
    }

    // 5. æ¸¬é©—é‚è¼¯
    let currentQ = 0;
    let score = 0;

    function initQuiz() {
        currentQ = 0;
        score = 0;
        document.getElementById('quiz-score-area').classList.add('hidden');
        document.getElementById('quiz-area').classList.remove('hidden');
        document.getElementById('quiz-progress').style.width = '0%';
        renderQuestion();
    }

    function renderQuestion() {
        const qData = quizDB[currentQ];
        document.getElementById('quiz-question').innerText = `Q${currentQ+1}. ${qData.q}`;
        document.getElementById('quiz-counter').innerText = `Q${currentQ+1} / ${quizDB.length}`;
        document.getElementById('quiz-progress').style.width = `${((currentQ)/quizDB.length)*100}%`;
        
        const optsDiv = document.getElementById('quiz-options');
        optsDiv.innerHTML = '';
        document.getElementById('quiz-feedback-box').classList.add('hidden');

        qData.a.forEach((opt, idx) => {
            const btn = document.createElement('div');
            btn.className = 'quiz-option';
            btn.innerText = opt.t;
            btn.onclick = () => checkAnswer(btn, opt.c);
            optsDiv.appendChild(btn);
        });
    }

    function checkAnswer(btn, isCorrect) {
        // Disable all clicks
        const allBtns = document.querySelectorAll('.quiz-option');
        allBtns.forEach(b => b.style.pointerEvents = 'none');

        if (isCorrect) {
            btn.classList.add('correct');
            score += 10;
            document.getElementById('quiz-feedback-text').innerText = "ğŸ‰ ç­”å°äº†ï¼";
            document.getElementById('quiz-feedback-text').style.color = "var(--success)";
        } else {
            btn.classList.add('wrong');
            // Find correct one
            // not implemented visually to keep simple, just show explanation
            document.getElementById('quiz-feedback-text').innerText = "ğŸ˜± ç­”éŒ¯å›‰ï¼";
            document.getElementById('quiz-feedback-text').style.color = "var(--danger)";
        }

        const fbBox = document.getElementById('quiz-feedback-box');
        fbBox.classList.remove('hidden');
        document.getElementById('quiz-explanation').innerText = quizDB[currentQ].exp;
    }

    function nextQuestion() {
        currentQ++;
        if (currentQ < quizDB.length) {
            renderQuestion();
        } else {
            showScore();
        }
    }

    function showScore() {
        document.getElementById('quiz-area').classList.add('hidden');
        document.getElementById('quiz-feedback-box').classList.add('hidden');
        const scoreArea = document.getElementById('quiz-score-area');
        scoreArea.classList.remove('hidden');
        document.getElementById('final-score').innerText = score;
        document.getElementById('quiz-progress').style.width = '100%';

        let comment = "";
        if (score === 100) comment = "ğŸ† å¤ªå¼·äº†ï¼ä½ æ˜¯è­·è…é”äººï¼";
        else if (score >= 60) comment = "ğŸ‘ å¾ˆä¸éŒ¯ï¼Œç¹¼çºŒä¿æŒï¼";
        else comment = "ğŸ’ª åŠ æ²¹ï¼Œå¤šçœ‹å¹¾æ¬¡è¡›æ•™è³‡è¨Šå–”ï¼";
        document.getElementById('score-comment').innerText = comment;
    }

    function restartQuiz() {
        initQuiz();
    }

    // åˆå§‹åŒ–æ¸¬é©—
    initQuiz();

</script>

</body>
</html>