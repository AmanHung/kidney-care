<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è…åˆ©ç®¡å®¶ v3.1</title>
    <style>
        :root {
            /* --- è±åŸé†«é™¢é…è‰²ç³»çµ± --- */
            --primary: #009045;   /* é†«é™¢ç¶  */
            --primary-dark: #007035;
            --accent: #F58220;    /* æ´»åŠ›æ©˜ */
            --secondary: #009ADA; /* å¤©ç©ºè— */
            
            --bg: #f4f9f6;
            --white: #ffffff;
            --text: #333;
            
            /* --- é¢¨éšªç‡ˆè™Ÿé¡è‰² --- */
            --risk-g: #6bbd45; --risk-y: #f9d423; --risk-o: #f58220; --risk-r: #e03e2e;
            
            --nav-height: 70px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: var(--bg); margin: 0; padding: 0; padding-bottom: calc(var(--nav-height) + 20px); color: var(--text); user-select: none; }

        /* --- Header --- */
        header { 
            background: var(--white); padding: 12px 15px; border-radius: 0 0 25px 25px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        header::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, var(--secondary) 20%, var(--primary) 50%, var(--accent) 80%);
        }
        .header-logo { max-height: 45px; max-width: 28vw; width: auto; height: auto; object-fit: contain; flex-shrink: 0; }
        .header-title-box { text-align: center; flex: 1; padding: 0 8px; min-width: 120px; }
        .header-title-box h1 { margin: 0; font-size: 1.3rem; letter-spacing: 1px; color: var(--primary); font-weight: 800; line-height: 1.2; }
        .header-title-box p { margin: 3px 0 0; color: #666; font-size: 0.8rem; }

        /* --- Container & CSS --- */
        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--white); border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,144,69,0.08); text-align: center; position: relative; overflow: hidden; border: 1px solid rgba(0,0,0,0.02); }
        .card h2 { margin-top: 0; color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom: 2px solid #f0f4f8; padding-bottom: 10px; margin-bottom: 15px; }

        .input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-group { flex: 1; text-align: left; }
        .input-group label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 2px solid #e1e5eb; border-radius: 12px; font-size: 1rem; background: #fcfcfc; outline: none; transition: 0.3s; appearance: none; }
        input:focus, select:focus { border-color: var(--primary); background: white; }
        .select-wrapper { position: relative; }
        .select-wrapper::after { content: 'â–¼'; position: absolute; right: 15px; top: 40%; transform: translateY(-50%); color: #999; pointer-events: none; font-size: 0.8rem; }

        .btn { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; padding: 15px; width: 100%; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,144,69,0.3); transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; }
        .btn:active { transform: scale(0.98); }
        .btn-line { background: #06c755; box-shadow: 0 4px 10px rgba(6,199,85,0.3); }
        .btn-refill { background: linear-gradient(135deg, var(--accent), #e07010); box-shadow: 0 4px 10px rgba(245,130,32,0.3); } /* æ©˜è‰²æŒ‰éˆ•çµ¦æ…¢ç®‹ */
        .btn-next { background: linear-gradient(135deg, var(--accent), #e07010); margin-top: 15px; box-shadow: 0 4px 10px rgba(245,130,32,0.3); }

        /* KDIGO Grid */
        .risk-matrix { display: grid; grid-template-columns: 50px 1fr 1fr 1fr; gap: 2px; margin: 20px auto; font-size: 0.75rem; line-height: 1.2; background: #fff; }
        .matrix-cell { display: flex; align-items: center; justify-content: center; text-align: center; padding: 5px 2px; border-radius: 4px; font-weight: bold; color: rgba(0,0,0,0.6); height: 45px; position: relative; }
        .matrix-header { background: #f0f4f8; color: #444; font-weight: bold; }
        .matrix-label { background: #f0f4f8; color: #444; font-weight: bold; font-size: 0.7rem; flex-direction: column; }
        .bg-g { background-color: var(--risk-g); color: white; }
        .bg-y { background-color: var(--risk-y); color: #555; }
        .bg-o { background-color: var(--risk-o); color: white; }
        .bg-r { background-color: var(--risk-r); color: white; }
        .matrix-cell.active-cell { border: 3px solid #0056b3; box-shadow: 0 0 10px rgba(0,86,179,0.5); z-index: 10; transform: scale(1.1); }
        
        .risk-result-box { margin-top: 15px; padding: 15px; background: #fffbe6; border-radius: 12px; border-left: 5px solid var(--accent); text-align: left; }
        .risk-title { font-size: 1.2rem; font-weight: 800; color: #333; margin-bottom: 5px; }
        .risk-desc { font-size: 0.95rem; color: #555; margin-bottom: 5px; }
        .risk-value { font-size: 0.9rem; color: #777; font-family: monospace; }
        
        .plate-container { width: 200px; height: 200px; background: white; border-radius: 50%; border: 8px solid #eee; margin: 20px auto; position: relative; overflow: hidden; box-shadow: inset 0 0 20px rgba(0,0,0,0.1); display: flex; flex-wrap: wrap; }
        .plate-half { width: 50%; height: 100%; background: #d4edda; display: flex; align-items: center; justify-content: center; flex-direction: column; color: #155724; font-size: 0.8rem; border-right: 1px solid white; }
        .plate-quarter-container { width: 50%; height: 100%; display: flex; flex-direction: column; }
        .plate-quarter { width: 100%; height: 50%; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; font-size: 0.8rem; }
        .pq-protein { background: #f8d7da; color: #721c24; border-bottom: 1px solid white; }
        .pq-starch { background: #fff3cd; color: #856404; }
        .food-icon { font-size: 1.5rem; margin-bottom: 2px; }

        .symptom-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .symptom-btn { background: white; border: 2px solid #eee; border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; transition: 0.2s; }
        .symptom-btn.selected { border-color: var(--danger); background: #fff5f5; transform: scale(1.02); }
        .symptom-icon { font-size: 2rem; display: block; margin-bottom: 5px; }

        .traffic-container { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .light { width: 60px; height: 60px; border-radius: 50%; background: #ddd; opacity: 0.2; transition: 0.3s; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        .light.on { opacity: 1; transform: scale(1.1); box-shadow: 0 0 20px currentColor; }

        .result-box { background: #e8f5e9; padding: 15px; border-radius: 12px; margin-top: 15px; text-align: left; border-left: 5px solid var(--primary); animation: fadeIn 0.3s ease; }
        .hidden { display: none; }
        .progress-bar { width: 100%; height: 6px; background: #eee; border-radius: 3px; margin-bottom: 15px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        .quiz-option { text-align: left; margin: 10px 0; padding: 12px; background: #f8f9fa; border: 2px solid #eee; border-radius: 10px; cursor: pointer; transition: 0.2s; }
        .quiz-option:active { background: #e9ecef; }
        .quiz-option.correct { border-color: var(--success); background: #d4edda; color: #155724; }
        .quiz-option.wrong { border-color: var(--danger); background: #f8d7da; color: #721c24; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-item { text-align: center; color: #999; font-size: 0.65rem; flex: 1; padding: 5px; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item.active .nav-icon { transform: scale(1.1); transition: 0.2s; }
        .nav-icon { font-size: 1.4rem; display: block; margin-bottom: 3px; }
        
        /* Consult specific */
        .qr-box { width: 180px; height: 180px; margin: 10px auto; border: 1px solid #eee; border-radius: 10px; overflow: hidden; }
        .qr-img { width: 100%; height: 100%; object-fit: cover; }
        
        /* Refill Box */
        .refill-box {
            display: flex;
            align-items: center;
            background: #fff8e1; /* æ·¡æ·¡çš„æ©˜é»ƒè‰²èƒŒæ™¯ */
            border: 1px solid #ffe0b2;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 25px;
            gap: 15px;
        }
        .refill-icon {
            width: 70px;
            height: 70px;
            object-fit: contain;
            flex-shrink: 0;
        }
    </style>
</head>
<body>

<header>
    <img src="logo_left.png" alt="è±åŸé†«é™¢" class="header-logo" onerror="this.style.opacity='0.3'">
    <div class="header-title-box">
        <h1>è…åˆ©ç®¡å®¶</h1>
        <p>æ‚¨çš„å°ˆå±¬è­·è…å°å¹«æ‰‹</p>
    </div>
    <img src="logo_right_new.png" alt="äº”ç¦è—¥å¸«åœˆ" class="header-logo" onerror="this.style.opacity='0.3'">
</header>

<div class="container">

    <div id="tab-home" class="section active">
        <div class="card">
            <h2>ğŸ“Š æˆ‘çš„è…è‡Ÿåœ°åœ–</h2>
            <div class="input-row">
                <div class="input-group">
                    <label>eGFR (è…åŠŸèƒ½)</label>
                    <input type="number" id="egfr-input" placeholder="ä¾‹å¦‚ 50">
                </div>
                <div class="input-group">
                    <label>è›‹ç™½å°¿ (UACR)</label>
                    <div class="select-wrapper">
                        <select id="albumin-input">
                            <option value="A1">æ­£å¸¸ (<30)</option>
                            <option value="A2">å¾®é‡ (30-299)</option>
                            <option value="A3">åš´é‡ (>300)</option>
                        </select>
                    </div>
                </div>
            </div>
            <button class="btn" onclick="updateRisk()"><span>ğŸš€ åˆ†æé¢¨éšª</span></button>

            <div id="risk-display" class="hidden">
                <div class="risk-result-box">
                    <div class="risk-title">æ‚¨çš„è…è‡ŸåŠŸèƒ½ç‚º <span id="res-risk-text" class="risk-badge">--</span></div>
                    <div class="risk-desc" id="res-detail-text">--</div>
                    <div class="risk-value" id="res-value-text">--</div>
                </div>
                <div class="risk-matrix">
                    <div class="matrix-header"></div><div class="matrix-header">æ­£å¸¸<br><30</div><div class="matrix-header">å¾®é‡<br>30-299</div><div class="matrix-header">åš´é‡<br>>300</div>
                    <div class="matrix-label">ç¬¬1æœŸ<br>>90</div><div class="matrix-cell bg-g" id="cell-1-1"></div><div class="matrix-cell bg-g" id="cell-1-2"></div><div class="matrix-cell bg-o" id="cell-1-3"></div>
                    <div class="matrix-label">ç¬¬2æœŸ<br>60-89</div><div class="matrix-cell bg-g" id="cell-2-1"></div><div class="matrix-cell bg-g" id="cell-2-2"></div><div class="matrix-cell bg-o" id="cell-2-3"></div>
                    <div class="matrix-label">ç¬¬3aæœŸ<br>45-59</div><div class="matrix-cell bg-y" id="cell-3a-1"></div><div class="matrix-cell bg-o" id="cell-3a-2"></div><div class="matrix-cell bg-r" id="cell-3a-3"></div>
                    <div class="matrix-label">ç¬¬3bæœŸ<br>30-44</div><div class="matrix-cell bg-o" id="cell-3b-1"></div><div class="matrix-cell bg-r" id="cell-3b-2"></div><div class="matrix-cell bg-r" id="cell-3b-3"></div>
                    <div class="matrix-label">ç¬¬4æœŸ<br>15-29</div><div class="matrix-cell bg-r" id="cell-4-1"></div><div class="matrix-cell bg-r" id="cell-4-2"></div><div class="matrix-cell bg-r" id="cell-4-3"></div>
                    <div class="matrix-label">ç¬¬5æœŸ<br><15</div><div class="matrix-cell bg-r" id="cell-5-1"></div><div class="matrix-cell bg-r" id="cell-5-2"></div><div class="matrix-cell bg-r" id="cell-5-3"></div>
                </div>
                <p style="font-size:0.75rem; color:#999;">åœ–è¡¨ä¾†æºï¼šKDIGO 2024 æŒ‡å¼•</p>
            </div>
        </div>
        <div id="home-advice" class="hidden">
            <div class="card" style="background: #e8f5e9; border: 1px dashed var(--primary);">
                <h3>ğŸ‘¨â€âš•ï¸ è—¥å¸«çµ¦æ‚¨çš„é‡é»</h3>
                <ul style="text-align: left; padding-left: 20px; color: #444; line-height: 1.6;">
                    <li id="advice-1"></li><li id="advice-2"></li><li id="advice-3"></li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tab-meds" class="section">
        <div class="card">
            <h2>ğŸš¦ è—¥ç‰©å®‰å…¨ç´…ç¶ ç‡ˆ</h2>
            <div class="select-wrapper">
                <select id="med-select" onchange="checkMed()">
                    <option value="">ğŸ” è«‹é¸æ“‡æŸ¥è©¢é …ç›®...</option>
                    <optgroup label="ğŸ”´ å±éšª / ç¦æ­¢ / éœ€ç‰¹åˆ¥æ³¨æ„">
                        <option value="nsaid">å¼·æ•ˆæ­¢ç—›è—¥ (NSAIDs)</option><option value="herbal">ä¾†è·¯ä¸æ˜ä¸­è‰è—¥/é»‘è—¥ä¸¸</option><option value="contrast">å«ç¢˜é¡¯å½±åŠ‘ (æª¢æŸ¥)</option><option value="mycin">éƒ¨åˆ†æŠ—ç”Ÿç´  (Aminoglycosides)</option><option value="starfruit_j">æ¥Šæ¡ƒæ±/æ¥Šæ¡ƒä¹¾</option><option value="smoking">å¸è¸ (å°¼å¤ä¸)</option><option value="hold_urine">é•·æœŸæ†‹å°¿</option>
                    </optgroup>
                    <optgroup label="ğŸŸ¡ è¬¹æ… / éœ€ç›£æ¸¬ / é©é‡">
                        <option value="diuretic">åˆ©å°¿åŠ‘ (Diuretics)</option><option value="metformin">é™ç³–è—¥ (Metformin)</option><option value="vit_d">ç¶­ç”Ÿç´  D (éˆ£ç£·å¹³è¡¡)</option><option value="multi_vit">ç¶œåˆç¶­ä»–å‘½</option><option value="enema">æ¸…è…¸åŠ‘ (å¤§è…¸é¡)</option><option value="antacid">å«é‹èƒƒè—¥/åˆ¶é…¸åŠ‘</option><option value="dehydration">å–æ°´ä¸è¶³/è„«æ°´</option><option value="constipation">é•·æœŸä¾¿ç§˜</option>
                    </optgroup>
                    <optgroup label="ğŸŸ¢ æ¨è–¦ / å®‰å…¨ / è­·è…">
                        <option value="sglt2">æ’ç³–è—¥ (SGLT2i)</option><option value="ras">è¡€å£“è—¥ (ACEi/ARB)</option><option value="panadol">æ™®æ‹¿ç–¼ (Acetaminophen)</option><option value="probiotic">è…è‡Ÿå°ˆç”¨ç›Šç”ŸèŒ</option><option value="bp_check">æ¯æ—¥é‡è¡€å£“</option><option value="vaccine">ç–«è‹—æ¥ç¨® (æµæ„Ÿ/è‚ºéˆ)</option>
                    </optgroup>
                </select>
            </div>
            <div class="traffic-container">
                <div id="light-r" class="light" style="color: var(--danger); background: var(--danger);"></div>
                <div id="light-y" class="light" style="color: var(--warning); background: var(--warning);"></div>
                <div id="light-g" class="light" style="color: var(--success); background: var(--success);"></div>
            </div>
            <div id="med-result" class="result-box hidden"></div>
        </div>
        <div class="card" style="border: 2px solid var(--danger);">
            <h2 style="color: var(--danger);">ğŸ¤’ ç”Ÿç—…åœè—¥ (Sick Day)</h2>
            <div class="symptom-grid">
                <div class="symptom-btn" onclick="toggleSymptom(this)"><span class="symptom-icon">ğŸ¤®</span>å˜”å</div>
                <div class="symptom-btn" onclick="toggleSymptom(this)"><span class="symptom-icon">ğŸš½</span>è…¹ç€‰</div>
                <div class="symptom-btn" onclick="toggleSymptom(this)"><span class="symptom-icon">ğŸŒ¡ï¸</span>é«˜ç‡’</div>
                <div class="symptom-btn" onclick="toggleSymptom(this)"><span class="symptom-icon">ğŸ’§</span>ç„¡æ³•å–æ°´</div>
            </div>
            <div id="sick-alert" class="hidden" style="background: #fff5f5; padding: 10px; border-radius: 10px; color: var(--danger); font-weight: bold; text-align: left;">
                ğŸš¨ å±éšªè­¦å ±ï¼(DAMN Rules)<br>è«‹è«®è©¢é†«å¸«æš«åœä»¥ä¸‹è—¥ç‰©ä»¥é˜²è…è¡°ç«­ï¼š<br>1. <strong>D</strong>iuretics (åˆ©å°¿åŠ‘)<br>2. <strong>A</strong>CEi/ARB (è¡€å£“è—¥)<br>3. <strong>M</strong>etformin (é™ç³–è—¥)<br>4. <strong>N</strong>SAIDs (æ­¢ç—›è—¥)<br>5. SGLT2i (æ’ç³–è—¥)
            </div>
        </div>
    </div>

    <div id="tab-diet" class="section">
        <div class="card">
            <h2>ğŸ½ï¸ è­·è…é¤ç›¤</h2>
            <div class="plate-container">
                <div class="plate-half"><span class="food-icon">ğŸ¥¦</span><span>50%<br>è”¬èœ/æ°´æœ</span></div>
                <div class="plate-quarter-container">
                    <div class="plate-quarter pq-protein"><span class="food-icon">ğŸ¥š</span><span>25%<br>è±†/é­š/è›‹</span></div>
                    <div class="plate-quarter pq-starch"><span class="food-icon">ğŸš</span><span>25%<br>ä½æ°®æ¾±ç²‰</span></div>
                </div>
            </div>
        </div>
        <div class="card">
            <h2>ğŸ¥— é£Ÿç‰©æŸ¥è©¢åœ°é›·å€</h2>
            <div class="select-wrapper">
                <select id="food-select" onchange="checkFood()">
                    <option value="">ğŸ¥’ è«‹é¸æ“‡é£Ÿç‰©...</option>
                    <optgroup label="ğŸŸ¢ ç¶ ç‡ˆ (æ¨è–¦/é©é‡)">
                        <option value="egg_white">é›è›‹ç™½</option><option value="tofu">å«©è±†è…</option><option value="rice_noodle">å†¬ç²‰/ç±³ç²‰</option><option value="white_rice">ç™½é£¯</option><option value="cabbage">é«˜éº—èœ/æ´‹è”¥</option><option value="apple">è˜‹æœ/é³³æ¢¨</option><option value="olive_oil">æ©„æ¬–æ²¹</option>
                    </optgroup>
                    <optgroup label="ğŸŸ¡ é»ƒç‡ˆ (éœ€æ¸›é‡/è™•ç†)">
                        <option value="spinach">è èœ/åœ°ç“œè‘‰</option><option value="brown_rice">ç³™ç±³/äº”ç©€ç±³</option><option value="nuts">å …æœ</option><option value="coffee">é»‘å’–å•¡</option><option value="kiwi">å¥‡ç•°æœ</option><option value="banana">é¦™è•‰</option>
                    </optgroup>
                    <optgroup label="ğŸ”´ ç´…ç‡ˆ (å±éšª/ç¦æ­¢)">
                        <option value="starfruit">æ¥Šæ¡ƒ</option><option value="processed_meat">é¦™è…¸/ç«è…¿</option><option value="organs">è±¬è‚/è…°å­</option><option value="low_na_salt">ä½éˆ‰é¹½/è–„é¹½é†¬æ²¹</option><option value="cola">å¯æ¨‚</option><option value="chicken_essence">é›ç²¾</option><option value="instant_noodle">æ³¡éºµ</option><option value="pastry">æ²¹æ¢/éºµåŒ…</option>
                    </optgroup>
                </select>
            </div>
            <div id="food-result" class="result-box hidden"></div>
        </div>
    </div>

    <div id="tab-quiz" class="section">
        <div class="card">
            <h2>ğŸ“ è…åˆ©å¤§æœƒè€ƒ</h2>
            <div class="progress-bar"><div id="quiz-progress" class="progress-fill"></div></div>
            <p id="quiz-counter" style="font-size:0.8rem; color:#999; text-align:right;">Q1/10</p>
            <div id="quiz-area">
                <h3 id="quiz-question" style="color: #444; min-height: 60px;">è¼‰å…¥ä¸­...</h3>
                <div id="quiz-options"></div>
            </div>
            <div id="quiz-feedback-box" class="hidden" style="margin-top: 20px;">
                <div id="quiz-feedback-text" style="font-weight: bold; margin-bottom: 10px;"></div>
                <div id="quiz-explanation" style="font-size: 0.9rem; color: #555; background: #fff; padding: 10px; border-radius: 8px;"></div>
                <button class="btn btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ âœ</button>
            </div>
            <div id="quiz-score-area" class="hidden">
                <h3 style="font-size: 2rem; color: var(--primary);">å¾—åˆ†ï¼š<span id="final-score">0</span> / 100</h3>
                <p id="score-comment"></p>
                <button class="btn" onclick="restartQuiz()">ğŸ”„ å†æ¸¬ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <div id="tab-consult" class="section">
        <div class="card">
            <h2>ğŸ’¬ è—¥å¸«è«®è©¢å®¤</h2>
            <p style="color: #666; margin-bottom: 20px;">æœ‰é—œæ–¼ç”¨è—¥æˆ–é£²é£Ÿçš„ç–‘å•å—ï¼Ÿ<br>æ­¡è¿ä½¿ç”¨ä»¥ä¸‹æœå‹™ã€‚</p>
            
            <div style="background: #f9f9f9; padding: 20px; border-radius: 15px; border: 1px solid #eee; margin-bottom: 25px;">
                <h3 style="color: #06c755; margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 5px;">
                    <span style="font-size: 1.5rem;">LINE</span> å®˜æ–¹å¸³è™Ÿ
                </h3>
                
                <div class="qr-box">
                    <img src="line_qr.png" alt="LINE QR Code" class="qr-img" onerror="this.src=''; this.style.display='none'; this.parentNode.innerHTML='<span style=\'display:block; padding-top:70px; color:#999\'>è«‹ä¸Šå‚³ line_qr.png</span>'">
                </div>
                <p style="font-size: 0.8rem; color: #999; margin-bottom: 15px;">é•·æŒ‰å„²å­˜æˆ–æƒæä¸Šæ–¹ QR Code</p>

                <a href="https://lin.ee/zwLjX1Lb" target="_blank" class="btn btn-line">
                    <span>ğŸ“² åŠ å…¥å¥½å‹ (ç·šä¸Šè«®è©¢)</span>
                </a>
                <p style="font-size: 0.8rem; color: #555; margin-top: 10px;">
                    å¯å³æ™‚è«®è©¢ã€å‚³é€è—¥è¢‹ç…§ç‰‡
                </p>
            </div>

            <div class="refill-box">
                <img src="icon_refill.png" alt="æ…¢ç®‹é ç´„" class="refill-icon" onerror="this.style.opacity='0.3'">
                <div style="flex: 1; text-align: left;">
                    <h3 style="margin: 0 0 5px 0; color: var(--accent);">æ…¢ç®‹é ç´„</h3>
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 10px; line-height: 1.4;">
                        ä¸ç”¨ç¾å ´æ’éšŠï¼Œ<br>æ‰‹æ©Ÿé ç´„å¿«é€Ÿé ˜è—¥ã€‚
                    </p>
                    <a href="https://nreg.fyh.mohw.gov.tw/OReg/HomePage?page=ChronicRegisterPage#" target="_blank" class="btn btn-refill" style="padding: 10px; font-size: 0.95rem;">
                        å‰å¾€é ç´„ âœ
                    </a>
                </div>
            </div>

            <hr style="border: 0; border-top: 1px dashed #ddd; margin: 30px 0;">

            <div style="opacity: 0.8;">
                <h3 style="color: var(--primary); margin-bottom: 10px;">ğŸ“ å¡«å¯«è©³ç´°æå•å–®</h3>
                <p style="font-size: 0.85rem;">è‹¥ä¸æ–¹ä¾¿ä½¿ç”¨ LINEï¼Œå¯å¡«å¯«è¡¨å–® (Email å›è¦†)</p>
                <div style="position: relative; overflow: hidden; padding-top: 80%; border: 1px solid #eee; border-radius: 10px; background: #f0f0f0;">
                    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScf4-vFv6sN0e5wK6_v8j8G6k6r5h3w/viewform?embedded=true" 
                            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;">è¼‰å…¥ä¸­...</iframe>
                </div>
            </div>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)"><span class="nav-icon">ğŸ </span>é¦–é </div>
    <div class="nav-item" onclick="switchTab('meds', this)"><span class="nav-icon">ğŸ’Š</span>ç”¨è—¥</div>
    <div class="nav-item" onclick="switchTab('diet', this)"><span class="nav-icon">ğŸ¥¦</span>é£²é£Ÿ</div>
    <div class="nav-item" onclick="switchTab('quiz', this)"><span class="nav-icon">ğŸ“</span>æ¸¬é©—</div>
    <div class="nav-item" onclick="switchTab('consult', this)"><span class="nav-icon">ğŸ’¬</span>è«®è©¢</div>
</nav>

<script>
    // --- Data ---
    const medDB = { 'nsaid': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (NSAIDs)', desc: 'æœ€å¼·çƒˆçš„è…è‡Ÿæ®ºæ‰‹ï¼è«‹æ”¹ç”¨æ™®æ‹¿ç–¼ã€‚' }, 'herbal': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (ä¸­è‰è—¥)', desc: 'ä¾†è·¯ä¸æ˜çš„é»‘è—¥ä¸¸æ˜¯å°ç£æ´—è…ä¸»å› ä¹‹ä¸€ã€‚' }, 'contrast': { level: 'r', title: 'âš ï¸ é«˜é¢¨éšª (é¡¯å½±åŠ‘)', desc: 'æª¢æŸ¥å‰å‘ŠçŸ¥ eGFRï¼Œæª¢æŸ¥å¾Œå¤šå–æ°´ã€‚' }, 'mycin': { level: 'r', title: 'âš ï¸ é«˜é¢¨éšª (æŠ—ç”Ÿç´ )', desc: 'æŸäº›æŠ—ç”Ÿç´ å…·è…æ¯’æ€§ï¼Œéœ€ç›£æ¸¬æ¿ƒåº¦ã€‚' }, 'starfruit_j': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (æ¥Šæ¡ƒ)', desc: 'å«ç¥ç¶“æ¯’ç´ ï¼Œè…å‹ç„¡æ³•æ’å‡ºï¼Œæè‡´æ˜è¿·ã€‚' }, 'smoking': { level: 'r', title: 'ğŸ›‘ å»ºè­°æˆ’é™¤ (å¸è¸)', desc: 'å°¼å¤ä¸åŠ é€Ÿè…çµ²çƒç¡¬åŒ–ã€‚' }, 'hold_urine': { level: 'r', title: 'ğŸ›‘ å£ç¿’æ…£ (æ†‹å°¿)', desc: 'æ˜“å¼•ç™¼æ³Œå°¿é“æ„ŸæŸ“æå‚·è…åŠŸèƒ½ã€‚' }, 'diuretic': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (åˆ©å°¿åŠ‘)', desc: 'è„«æ°´æˆ–ç”Ÿç—…æ™‚éœ€è©•ä¼°æš«åœã€‚' }, 'metformin': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (é™ç³–è—¥)', desc: 'eGFR < 30 æ™‚é€šå¸¸éœ€åœç”¨ã€‚' }, 'vit_d': { level: 'y', title: 'ğŸŸ¡ éœ€ç›£æ¸¬ (ç¶­ç”Ÿç´ D)', desc: 'éœ€å®šæœŸç›£æ¸¬è¡€éˆ£èˆ‡è¡€ç£·æ¿ƒåº¦ã€‚' }, 'multi_vit': { level: 'y', title: 'ğŸŸ¡ éœ€æŒ‘é¸ (ç¶œåˆç¶­ä»–å‘½)', desc: 'å¸‚å”®ç”¢å“å¯èƒ½å«é«˜ç£·ã€é«˜é‰€ã€‚' }, 'enema': { level: 'y', title: 'ğŸŸ¡ éœ€å‘ŠçŸ¥ (æ¸…è…¸åŠ‘)', desc: 'å«ç£·é…¸éˆ‰ç”¢å“å¯èƒ½å‚·è…ã€‚' }, 'antacid': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (èƒƒè—¥)', desc: 'å«é‹èƒƒè—¥æå°è‡´ä¸­æ¯’ã€‚' }, 'dehydration': { level: 'y', title: 'ğŸŸ¡ éœ€å–æ°´ (è„«æ°´)', desc: 'é£²æ°´ä¸è¶³æœƒæ¸›å°‘è…è‡Ÿè¡€æµã€‚' }, 'constipation': { level: 'y', title: 'ğŸŸ¡ éœ€æ”¹å–„ (ä¾¿ç§˜)', desc: 'å¢åŠ å°¿æ¯’ç´ å¸æ”¶ã€‚' }, 'sglt2': { level: 'g', title: 'âœ… å¼·åŠ›æ¨è–¦ (æ’ç³–è—¥)', desc: 'è­·è…ç¥è—¥ï¼å»¶ç·©æ´—è…ä¸¦ä¿è­·å¿ƒè‡Ÿã€‚' }, 'ras': { level: 'g', title: 'âœ… å¼·åŠ›æ¨è–¦ (ACEi/ARB)', desc: 'æ¸›å°‘è›‹ç™½å°¿ï¼Œæ ¸å¿ƒè­·è…è—¥ç‰©ã€‚' }, 'panadol': { level: 'g', title: 'âœ… ç›¸å°å®‰å…¨ (æ™®æ‹¿ç–¼)', desc: 'å®‰å…¨åŠ‘é‡ä¸‹ä¸å‚·è…ã€‚' }, 'probiotic': { level: 'g', title: 'âœ… è¼”åŠ©æ¨è–¦ (ç›Šç”ŸèŒ)', desc: 'éƒ¨åˆ†èŒæ ªæœ‰åŠ©æ¸›å°‘å°¿æ¯’ç´ ã€‚' }, 'bp_check': { level: 'g', title: 'âœ… å¿…è¦è¡Œç‚º (é‡è¡€å£“)', desc: 'æ§åˆ¶è¡€å£“æ˜¯è­·è…é—œéµã€‚' }, 'vaccine': { level: 'g', title: 'âœ… å»ºè­°æ–½æ‰“ (ç–«è‹—)', desc: 'é é˜²åš´é‡æ„ŸæŸ“å¼•ç™¼æ€¥æ€§è…æå‚·ã€‚' } };
    const foodDB = { 'egg_white': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (å„ªè³ª)', d: 'é«˜ç”Ÿç‰©åƒ¹è›‹ç™½è³ªï¼Œä½ç£·å¥½å¸æ”¶ã€‚' }, 'tofu': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (å„ªè³ª)', d: 'æ¤ç‰©æ€§è›‹ç™½ï¼ŒåŠ å·¥éç¨‹ç£·è¼ƒä½ã€‚' }, 'rice_noodle': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (ä¸»é£Ÿ)', d: 'ä½æ°®æ¾±ç²‰ï¼ç†±é‡å¤ ä¸”å°‘å°¿æ¯’ç´ ã€‚' }, 'white_rice': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (ä¸»é£Ÿ)', d: 'æ¯”ç³™ç±³ä½ç£·ï¼Œé©åˆæ™šæœŸè…å‹ã€‚' }, 'cabbage': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (è”¬èœ)', d: 'é«˜éº—èœã€æ´‹è”¥ä½é‰€ã€‚' }, 'apple': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (æ°´æœ)', d: 'è˜‹æœã€é³³æ¢¨ã€è‘¡è„ä½é‰€ã€‚' }, 'olive_oil': { t: 'ğŸŸ¢ ç¶ ç‡ˆ (æ²¹è„‚)', d: 'å„ªè³ªå¥½æ²¹è£œå……ç†±é‡ã€‚' }, 'spinach': { t: 'ğŸŸ¡ é»ƒç‡ˆ (é«˜é‰€)', d: 'å»ºè­°åˆ‡æ®µæ±†ç‡™è®“é‰€æµå¤±ã€‚' }, 'brown_rice': { t: 'ğŸŸ¡ é»ƒç‡ˆ (é«˜ç£·)', d: 'åˆæœŸå¯åƒï¼Œæ™šæœŸå»ºè­°æ”¹ç™½é£¯ã€‚' }, 'nuts': { t: 'ğŸŸ¡ é»ƒç‡ˆ (é«˜ç£·é‰€)', d: 'ä¸€å¤©é™åˆ¶ 5 é¡†ã€‚' }, 'coffee': { t: 'ğŸŸ¡ é»ƒç‡ˆ (å’–å•¡å› )', d: 'é»‘å’–å•¡å«é‰€ï¼Œå»ºè­°æ¯æ—¥ä¸€æ¯ã€‚' }, 'kiwi': { t: 'ğŸŸ¡ é»ƒç‡ˆ (æ°´æœ)', d: 'é‰€åé«˜ï¼Œéœ€é©é‡ã€‚' }, 'banana': { t: 'ğŸŸ¡ é»ƒç‡ˆ (é«˜é‰€)', d: 'è¡€é‰€ä¸ç©©è€…é¿å…ã€‚' }, 'starfruit': { t: 'ğŸ”´ ç´…ç‡ˆ (åŠ‡æ¯’)', d: 'çµ•å°ç¦æ­¢ï¼å«ç¥ç¶“æ¯’ç´ ã€‚' }, 'processed_meat': { t: 'ğŸ”´ ç´…ç‡ˆ (ç„¡æ©Ÿç£·)', d: 'é¦™è…¸ç«è…¿å«ç£·é…¸é¹½ï¼Œå¸æ”¶ç‡100%ã€‚' }, 'organs': { t: 'ğŸ”´ ç´…ç‡ˆ (é«˜æ¯’ç´ )', d: 'å…§è‡Ÿé«˜ç£·ã€é«˜æ¯’ç´ ã€‚' }, 'low_na_salt': { t: 'ğŸ”´ ç´…ç‡ˆ (é«˜é‰€)', d: 'ä½éˆ‰é¹½é€šå¸¸æ˜¯é«˜é‰€é¹½ï¼Œå±éšªã€‚' }, 'cola': { t: 'ğŸ”´ ç´…ç‡ˆ (é«˜ç£·)', d: 'ç¢³é…¸é£²æ–™å«å¤§é‡ç£·é…¸ã€‚' }, 'chicken_essence': { t: 'ğŸ”´ ç´…ç‡ˆ (æ¿ƒç¸®)', d: 'æ¿ƒç¸®é‰€èˆ‡æ™®æ—ï¼ŒåŠ é‡è² æ“”ã€‚' }, 'instant_noodle': { t: 'ğŸ”´ ç´…ç‡ˆ (é«˜éˆ‰)', d: 'æ¹¯é ­é«˜éˆ‰ï¼Œéºµé«”å«ç£·ã€‚' }, 'pastry': { t: 'ğŸ”´ ç´…ç‡ˆ (å«é‹)', d: 'æ²¹æ¢éºµåŒ…å¸¸å«è†¨é¬†åŠ‘(é‹)ã€‚' } };
    const quizDB = [ { q: "å› ç‚ºæˆ‘æœ‰è…è‡Ÿç—…ï¼Œæ‰€ä»¥è¦æ”¹åƒã€Œè–„é¹½é†¬æ²¹ã€æˆ–ã€Œä½éˆ‰é¹½ã€æ¯”è¼ƒå¥åº·ï¼Ÿ", a: [ {t:"å°ï¼Œå°‘é¹½å°±æ˜¯å¥½", c:false}, {t:"éŒ¯ï¼Œé‚£äº›é€šå¸¸æ˜¯é«˜é‰€ç”¢å“", c:true} ], exp: "ä½éˆ‰ç”¢å“å¸¸ä»¥ã€Œé‰€ã€å–ä»£éˆ‰ï¼Œå°è…å‹ä¾†èªªå¯èƒ½å°è‡´é«˜è¡€é‰€å¿ƒå¾‹ä¸æ•´ã€‚" }, { q: "é—œæ–¼æ°´åˆ†æ”å–ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ", a: [ {t:"è…è‡Ÿç—…å®Œå…¨ä¸èƒ½å–æ°´", c:false}, {t:"æ²’æœ‰æ°´è…«ä¸‹ï¼Œæ‡‰é©é‡å–æ°´", c:true} ], exp: "é™¤éå·²é€ææˆ–åš´é‡æ°´è…«ï¼Œå¦å‰‡æ°´åˆ†ä¸è¶³æœƒæ¸›å°‘è…è‡Ÿè¡€æµï¼Œåè€Œå‚·è…ã€‚" }, { q: "æˆ‘æ„Ÿå†’å…¨èº«ç— ç—›ï¼Œå»è—¥å±€è²·ã€Œå¼·æ•ˆæ­¢ç—›è—¥ (NSAID)ã€åƒæ¯”è¼ƒå¿«å¥½ï¼Ÿ", a: [ {t:"çµ•å°ä¸å¯ï¼Œæœƒå‚·è…", c:true}, {t:"å¯ä»¥ï¼Œåªè¦ä¸åƒè¶…éä¸‰å¤©", c:false} ], exp: "NSAIDs æ˜¯å¸¸è¦‹å‚·è…è—¥ç‰©ï¼Œæœƒé€ æˆæ€¥æ€§è…æå‚·ã€‚è«‹æ”¹ç”¨æ™®æ‹¿ç–¼æˆ–è«®è©¢é†«å¸«ã€‚" }, { q: "å°¿æ¶²æœ‰æ³¡æ³¡ï¼Œä¸€å®šå°±æ˜¯è…è‡Ÿå£æ‰äº†å—ï¼Ÿ", a: [ {t:"ä¸ä¸€å®šï¼Œéœ€æª¢é©—ç¢ºèª", c:true}, {t:"å°ï¼Œç«‹åˆ»æº–å‚™æ´—è…", c:false} ], exp: "è¡åŠ›å¤§æˆ–å°¿å¤ªæ¿ƒä¹Ÿæœƒæœ‰æ³¡æ³¡ã€‚è‹¥æ³¡æ³¡ã€Œ10åˆ†é˜ä¸æ•£ã€æ‰é«˜åº¦æ‡·ç–‘æ˜¯è›‹ç™½å°¿ã€‚" }, { q: "é†«ç”Ÿé–‹çš„ã€Œéˆ£ç‰‡ã€å¥½å¤§é¡†ï¼Œæˆ‘ä¸æƒ³åƒå¯ä»¥å—ï¼Ÿ", a: [ {t:"å¯ä»¥ï¼Œé‚£æ˜¯è£œéª¨é ­çš„", c:false}, {t:"ä¸è¡Œï¼Œé‚£æ˜¯é™ç£·ç”¨çš„", c:true} ], exp: "è…å‹çš„éˆ£ç‰‡é€šå¸¸ä½œç‚ºã€Œç£·çµåˆåŠ‘ã€ï¼Œéœ€éš¨é¤å’¬ç¢æœç”¨ä»¥å¸é™„é£Ÿç‰©ä¸­çš„ç£·ã€‚" }, { q: "æ¥Šæ¡ƒå¾ˆå¥½åƒï¼Œæˆ‘åªåƒã€Œä¸€å£ã€æ‡‰è©²æ²’é—œä¿‚å§ï¼Ÿ", a: [ {t:"çµ•å°ç¦æ­¢", c:true}, {t:"æ²’é—œä¿‚ï¼Œä¸è¦å–æ±å°±å¥½", c:false} ], exp: "æ¥Šæ¡ƒå«ç¥ç¶“æ¯’ç´ ï¼Œè…åŠŸèƒ½ä¸å…¨è€…ç„¡æ³•ä»£è¬ï¼Œåš´é‡æè‡´æ˜è¿·ã€‚" }, { q: "SGLT2 æŠ‘åˆ¶åŠ‘ï¼ˆæ’ç³–è—¥ï¼‰é™¤äº†é™è¡€ç³–ï¼Œé‚„æœ‰ä»€éº¼åŠŸèƒ½ï¼Ÿ", a: [ {t:"ä¿è­·å¿ƒè‡Ÿèˆ‡å»¶ç·©è…æƒ¡åŒ–", c:true}, {t:"åªæœ‰é™è¡€ç³–", c:false} ], exp: "é€™æ˜¯åœ‹éš›æŒ‡å¼•æ¨è–¦çš„è­·è…è—¥ç‰©ï¼Œå³ä½¿ç„¡ç³–å°¿ç—…çš„è…å‹ä¹Ÿå¯èƒ½ä½¿ç”¨ã€‚" }, { q: "è½èªªã€Œè…°å­ï¼ˆè…è‡Ÿï¼‰ã€ä»¥å½¢è£œå½¢ï¼Œè…ä¸å¥½è¦å¤šåƒè±¬è…°å­ï¼Ÿ", a: [ {t:"å°ï¼Œåƒè…è£œè…", c:false}, {t:"éŒ¯ï¼Œé‚£æ˜¯é«˜æ¯’ç´ é£Ÿç‰©", c:true} ], exp: "å…§è‡Ÿé¡å«æ¥µé«˜ç£·èˆ‡æ¯’ç´ ï¼Œåƒå¤šåè€ŒåŠ é€Ÿè…è¡°ç«­ã€‚" }, { q: "ä¸€æ—¦é–‹å§‹æ´—è…ï¼ˆé€æï¼‰ï¼Œé€™è¼©å­å°±æ²’æ•‘äº†å—ï¼Ÿ", a: [ {t:"éŒ¯ï¼Œé€æä»å¯ç¶­æŒç”Ÿæ´»å“è³ª", c:true}, {t:"å°ï¼Œäººç”Ÿè®Šé»‘ç™½çš„", c:false} ], exp: "é€ææ˜¯å»¶çºŒç”Ÿå‘½çš„æ–¹å¼ï¼Œè¨±å¤šè…å‹ä»èƒ½å·¥ä½œã€æ—…éŠï¼Œæˆ–ç­‰å¾…è…è‡Ÿç§»æ¤ã€‚" }, { q: "è…è‡Ÿä¸å¥½çš„äººï¼Œé‹å‹•æœƒè®“è…°æ›´ç— ï¼Œæ‰€ä»¥è¦å¤šèººè‘—ä¼‘æ¯ï¼Ÿ", a: [ {t:"å°ï¼Œèƒ½ä¸å‹•å°±ä¸å‹•", c:false}, {t:"éŒ¯ï¼Œé©åº¦é‹å‹•åè€Œè­·è…", c:true} ], exp: "è¦å¾‹é‹å‹•ï¼ˆå¦‚å¿«èµ°ï¼‰èƒ½æ§åˆ¶ä¸‰é«˜ï¼Œæ˜¯ä¿è­·è…è‡Ÿçš„é‡è¦ç”Ÿæ´»ç¿’æ…£ã€‚" } ];

    // --- Logic ---
    function switchTab(tabId, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        window.scrollTo(0,0);
    }

    function updateRisk() {
        const egfr = parseFloat(document.getElementById('egfr-input').value);
        const albumin = document.getElementById('albumin-input').value;
        const resultBox = document.getElementById('risk-display');
        const adviceBox = document.getElementById('home-advice');
        document.querySelectorAll('.matrix-cell').forEach(c => c.classList.remove('active-cell'));

        if (!egfr) { alert("è«‹è¼¸å…¥ eGFR æ•¸å€¼"); return; }
        
        resultBox.classList.remove('hidden');
        adviceBox.classList.remove('hidden');

        let stage = "", rowId = "";
        if (egfr >= 90) { stage = "ç¬¬1æœŸ"; rowId = "1"; }
        else if (egfr >= 60) { stage = "ç¬¬2æœŸ"; rowId = "2"; }
        else if (egfr >= 45) { stage = "ç¬¬3aæœŸ"; rowId = "3a"; }
        else if (egfr >= 30) { stage = "ç¬¬3bæœŸ"; rowId = "3b"; }
        else if (egfr >= 15) { stage = "ç¬¬4æœŸ"; rowId = "4"; }
        else { stage = "ç¬¬5æœŸ"; rowId = "5"; }

        let albText = "", colId = "";
        if (albumin === 'A1') { albText = "æ­£å¸¸/è¼•å¾®è›‹ç™½å°¿"; colId = "1"; }
        else if (albumin === 'A2') { albText = "å¾®é‡è›‹ç™½å°¿"; colId = "2"; }
        else { albText = "åš´é‡è›‹ç™½å°¿"; colId = "3"; }

        const targetCellId = `cell-${rowId}-${colId}`;
        const targetCell = document.getElementById(targetCellId);
        if(targetCell) targetCell.classList.add('active-cell');

        let riskText = "", riskColor = "";
        if (targetCell.classList.contains('bg-g')) { riskText = "ã€Œä½é¢¨éšªã€"; riskColor = "var(--risk-g)"; }
        else if (targetCell.classList.contains('bg-y')) { riskText = "ã€Œä¸­åº¦é¢¨éšªã€"; riskColor = "var(--risk-y)"; }
        else if (targetCell.classList.contains('bg-o')) { riskText = "ã€Œé«˜é¢¨éšªã€"; riskColor = "var(--risk-o)"; }
        else { riskText = "ã€Œè¶…é«˜é¢¨éšªã€"; riskColor = "var(--risk-r)"; }

        document.getElementById('res-risk-text').innerText = riskText;
        document.getElementById('res-risk-text').style.backgroundColor = riskColor;
        document.getElementById('res-detail-text').innerText = `è…çµ²çƒéæ¿¾ç‡${stage} èˆ‡ ${albText}`;
        document.getElementById('res-value-text').innerHTML = `æ‚¨çš„ eGFR æ•¸å€¼ç‚º <strong style="color:${riskColor}">${egfr}</strong>`;

        const a1 = document.getElementById('advice-1');
        const a2 = document.getElementById('advice-2');
        const a3 = document.getElementById('advice-3');
        if (egfr >= 60 && albumin === 'A1') { a1.innerText = "ç¶­æŒå¥åº·ç”Ÿæ´»ï¼Œæ¯å¹´å®šæœŸæª¢æŸ¥å³å¯ã€‚"; a2.innerText = "é£²é£Ÿå‡è¡¡ï¼Œä¸éœ€éåº¦é™åˆ¶è›‹ç™½è³ªã€‚"; a3.innerText = "é¿å…é•·æœŸä½¿ç”¨æ­¢ç—›è—¥ (NSAIDs) èˆ‡ä¾†è·¯ä¸æ˜ä¸­è‰è—¥ã€‚"; }
        else if (egfr < 45 || albumin === 'A3') { a1.innerText = "å±¬æ–¼é«˜é¢¨éšªç¾¤ï¼Œè«‹åš´æ ¼æ§åˆ¶è¡€å£“èˆ‡è¡€ç³–ã€‚"; a2.innerText = "ä½è›‹ç™½é£²é£Ÿ (0.6-0.8 g/kg)ï¼Œé¿å…åŠ å·¥é£Ÿå“ã€‚"; a3.innerText = "è«®è©¢é†«å¸«æ˜¯å¦ä½¿ç”¨ SGLT2 æ’ç³–è—¥æˆ– ACEi/ARB ä¿è­·å¿ƒè…ã€‚"; }
        else { a1.innerText = "æ¯ 3-6 å€‹æœˆè¿½è¹¤ä¸€æ¬¡è…åŠŸèƒ½ã€‚"; a2.innerText = "æ³¨æ„è¡€å£“æ§åˆ¶ (<130/80)ï¼Œæ¸›å°‘é¹½åˆ†æ”å–ã€‚"; a3.innerText = "è‹¥æœ‰ç³–å°¿ç—…ï¼Œå‹™å¿…åš´æ ¼æ§ç³–ã€‚"; }
    }

    function checkMed() {
        const val = document.getElementById('med-select').value;
        const lights = document.querySelectorAll('.light');
        const res = document.getElementById('med-result');
        lights.forEach(l => l.classList.remove('on'));
        res.classList.add('hidden');
        if(!val) return;
        const data = medDB[val];
        res.classList.remove('hidden');
        res.innerHTML = `<strong>${data.title}</strong><br>${data.desc}`;
        if (data.level === 'r') { document.getElementById('light-r').classList.add('on'); res.style.borderColor = "var(--danger)"; res.style.background = "#fff5f5"; }
        else if (data.level === 'y') { document.getElementById('light-y').classList.add('on'); res.style.borderColor = "var(--warning)"; res.style.background = "#fffbf0"; }
        else { document.getElementById('light-g').classList.add('on'); res.style.borderColor = "var(--success)"; res.style.background = "#e6fffa"; }
    }

    function toggleSymptom(btn) {
        btn.classList.toggle('selected');
        const any = document.querySelectorAll('.symptom-btn.selected').length > 0;
        const box = document.getElementById('sick-alert');
        any ? box.classList.remove('hidden') : box.classList.add('hidden');
    }

    function checkFood() {
        const val = document.getElementById('food-select').value;
        const res = document.getElementById('food-result');
        res.classList.add('hidden');
        if(!val) return;
        const data = foodDB[val];
        res.classList.remove('hidden');
        res.innerHTML = `<strong>${data.t}</strong><br>${data.d}`;
        if (data.t.includes("ç´…ç‡ˆ")) { res.style.borderColor = "var(--danger)"; res.style.background = "#fff5f5"; res.style.color = "#721c24"; }
        else if (data.t.includes("é»ƒç‡ˆ")) { res.style.borderColor = "var(--warning)"; res.style.background = "#fffbf0"; res.style.color = "#856404"; }
        else { res.style.borderColor = "var(--success)"; res.style.background = "#e6fffa"; res.style.color = "#155724"; }
    }

    let currentQ = 0, score = 0;
    function initQuiz() { currentQ = 0; score = 0; document.getElementById('quiz-score-area').classList.add('hidden'); document.getElementById('quiz-area').classList.remove('hidden'); document.getElementById('quiz-progress').style.width = '0%'; renderQuestion(); }
    function renderQuestion() {
        const qData = quizDB[currentQ];
        document.getElementById('quiz-question').innerText = `Q${currentQ+1}. ${qData.q}`;
        document.getElementById('quiz-counter').innerText = `Q${currentQ+1} / ${quizDB.length}`;
        document.getElementById('quiz-progress').style.width = `${((currentQ)/quizDB.length)*100}%`;
        const optsDiv = document.getElementById('quiz-options');
        optsDiv.innerHTML = '';
        document.getElementById('quiz-feedback-box').classList.add('hidden');
        qData.a.forEach(opt => {
            const btn = document.createElement('div'); btn.className = 'quiz-option'; btn.innerText = opt.t; btn.onclick = () => checkAnswer(btn, opt.c); optsDiv.appendChild(btn);
        });
    }
    function checkAnswer(btn, isCorrect) {
        document.querySelectorAll('.quiz-option').forEach(b => b.style.pointerEvents = 'none');
        if (isCorrect) { btn.classList.add('correct'); score += 10; document.getElementById('quiz-feedback-text').innerText = "ğŸ‰ ç­”å°äº†ï¼"; document.getElementById('quiz-feedback-text').style.color = "var(--success)"; }
        else { btn.classList.add('wrong'); document.getElementById('quiz-feedback-text').innerText = "ğŸ˜± ç­”éŒ¯å›‰ï¼"; document.getElementById('quiz-feedback-text').style.color = "var(--danger)"; }
        document.getElementById('quiz-feedback-box').classList.remove('hidden');
        document.getElementById('quiz-explanation').innerText = quizDB[currentQ].exp;
    }
    function nextQuestion() { currentQ++; if (currentQ < quizDB.length) renderQuestion(); else showScore(); }
    function showScore() {
        document.getElementById('quiz-area').classList.add('hidden'); document.getElementById('quiz-feedback-box').classList.add('hidden');
        document.getElementById('quiz-score-area').classList.remove('hidden');
        document.getElementById('final-score').innerText = score;
        document.getElementById('quiz-progress').style.width = '100%';
        document.getElementById('score-comment').innerText = score===100 ? "ğŸ† å¤ªå¼·äº†ï¼ä½ æ˜¯è­·è…é”äººï¼" : score>=60 ? "ğŸ‘ å¾ˆä¸éŒ¯ï¼Œç¹¼çºŒä¿æŒï¼" : "ğŸ’ª åŠ æ²¹ï¼Œå¤šçœ‹å¹¾æ¬¡è¡›æ•™è³‡è¨Šå–”ï¼";
    }
    function restartQuiz() { initQuiz(); }
    initQuiz();
</script>
</body>
</html>
