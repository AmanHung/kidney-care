<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è…åˆ©ç®¡å®¶ v4.4</title>
    <style>
        :root {
            --primary: #009045;
            --primary-dark: #007035;
            --accent: #F58220;
            --bg: #f8fbf8;
            --white: #ffffff;
            --text: #333;
            --risk-g: #6bbd45; --risk-y: #ffd700; --risk-o: #f58220; --risk-r: #e03e2e;
            --nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        /* åŸºç¤è¨­å®šï¼šå­—é«”é©åº¦åŠ å¤§ï¼Œä½†ä¿ç•™å½ˆæ€§ */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; padding: 0; 
            padding-bottom: calc(var(--nav-height) + 20px); 
            color: var(--text); 
            font-size: 18px; /* åŸºç¤å­—é«” 18px */
            line-height: 1.5;
            user-select: none; 
        }

        /* --- Header (å½ˆæ€§ä½ˆå±€) --- */
        header { 
            background: var(--white); padding: 10px 15px; border-radius: 0 0 25px 25px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        header::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, #009ADA 20%, var(--primary) 50%, var(--accent) 80%);
        }
        .header-logo { height: 45px; width: auto; object-fit: contain; }
        .header-title-box { text-align: center; flex: 1; padding: 0 5px; }
        .header-title-box h1 { margin: 0; font-size: 1.4rem; color: var(--primary); font-weight: 900; }
        .header-title-box p { margin: 0; color: #666; font-size: 0.9rem; }

        /* --- Container --- */
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--white); border-radius: 20px; padding: 20px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; border: 1px solid #eee; }
        .card h2 { margin-top: 0; color: var(--primary); font-size: 1.4rem; font-weight: 800; border-bottom: 2px solid #f0f4f8; padding-bottom: 10px; margin-bottom: 20px; }

        /* è¼¸å…¥é¸å–® (åŠ å¤§è§¸æ§å€) */
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; font-size: 1.1rem; color: #444; margin-bottom: 8px; font-weight: 900; }
        .select-wrapper { position: relative; }
        select { 
            width: 100%; padding: 15px; border: 2px solid #ccc; border-radius: 12px; 
            font-size: 1.2rem; background: #fff; outline: none; font-weight: bold; color: #222;
            -webkit-appearance: none; appearance: none; /* ç§»é™¤é è¨­æ¨£å¼ä»¥çµ±ä¸€å¤–è§€ */
        }
        .select-wrapper::after { 
            content: 'â–¼'; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); 
            color: #444; pointer-events: none; font-size: 1rem; 
        }
        select:focus { border-color: var(--primary); background: #f9fff9; }

        /* æŒ‰éˆ•å„ªåŒ– */
        .btn { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; 
            border: none; padding: 15px; width: 100%; border-radius: 15px; 
            font-size: 1.2rem; font-weight: 900; cursor: pointer; 
            box-shadow: 0 5px 15px rgba(0,144,69,0.3); display: flex; align-items: center; justify-content: center; 
            text-decoration: none; margin-bottom: 10px; 
        }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: #fff; border: 2px solid var(--primary); color: var(--primary); box-shadow: none; }
        .btn-line { background: #06c755; box-shadow: 0 5px 15px rgba(6,199,85,0.3); }
        .btn-refill { background: linear-gradient(135deg, var(--accent), #e07010); box-shadow: 0 5px 15px rgba(245,130,32,0.3); }

        /* --- é¢¨éšªçŸ©é™£ (ä¿®å¾©è·‘ç‰ˆé—œéµ) --- */
        .risk-matrix { 
            display: grid; 
            /* èª¿æ•´æ¯”ä¾‹ï¼šå·¦æ¬„å›ºå®šï¼Œå³ä¸‰æ¬„å‡åˆ† */
            grid-template-columns: 55px 1fr 1fr 1fr; 
            gap: 2px; margin: 20px auto; 
            background: #fff; 
            font-size: 0.85rem; /* è¡¨æ ¼å…§æ–‡å­—ç¨å¾®ç¸®å°ï¼Œé¿å…æ‰‹æ©Ÿæ›è¡Œ */
        }
        .matrix-cell { 
            display: flex; align-items: center; justify-content: center; text-align: center; 
            padding: 2px; border-radius: 4px; font-weight: bold; color: rgba(0,0,0,0.3); 
            height: 50px; position: relative; 
        }
        .matrix-header { background: #f4f4f4; color: #444; font-weight: 900; font-size: 0.8rem; padding: 5px 0; }
        .matrix-label { background: #f4f4f4; color: #444; font-weight: 900; font-size: 0.75rem; flex-direction: column; justify-content: center; display: flex; align-items: center; }
        
        .bg-g { background-color: var(--risk-g); }
        .bg-y { background-color: var(--risk-y); }
        .bg-o { background-color: var(--risk-o); }
        .bg-r { background-color: var(--risk-r); }
        
        /* è—è‰²æ¡†æ¡† */
        .matrix-cell.active-cell { 
            border: 4px solid #0044cc; 
            box-shadow: 0 0 15px rgba(0,68,204,0.6); 
            z-index: 10; transform: scale(1.1); 
        }

        /* çµæœé¡¯ç¤ºå€ (æ»¿ç‰ˆè‰²å¡Š) */
        .risk-banner {
            padding: 20px; margin-top: 20px; border-radius: 15px; color: white; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease;
        }
        .risk-banner h3 { margin: 0; font-size: 1.8rem; font-weight: 900; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .risk-banner p { margin: 5px 0 0; font-size: 1.1rem; font-weight: bold; opacity: 0.95; }

        /* åˆ—è¡¨å¡ç‰‡ (ç”¨è—¥/é£²é£Ÿ) */
        .list-card { text-align: left; margin-bottom: 20px; border-radius: 15px; overflow: hidden; border: 1px solid #ddd; }
        .list-head { padding: 15px; font-weight: 900; color: white; font-size: 1.2rem; }
        .list-body { padding: 20px; font-size: 1.1rem; line-height: 1.6; background: #fff; }
        .list-item { margin-bottom: 12px; border-bottom: 1px dashed #ccc; padding-bottom: 12px; }
        .list-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .list-title { font-weight: 900; display: block; color: #222; }
        
        /* å°èˆªåˆ— */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #ccc; z-index: 1000; }
        .nav-item { text-align: center; color: #999; font-size: 0.85rem; flex: 1; padding: 5px; cursor: pointer; font-weight: bold; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active .nav-icon { transform: scale(1.1); color: var(--primary); }
        .nav-icon { font-size: 1.8rem; display: block; margin-bottom: 2px; }

        .hidden { display: none; }
        /* å…¶ä»–å°å…ƒä»¶ */
        .plate-container { width: 220px; height: 220px; background: white; border-radius: 50%; border: 8px solid #eee; margin: 20px auto; display: flex; flex-wrap: wrap; overflow: hidden; }
        .plate-half { width: 50%; height: 100%; background: #d4edda; display: flex; align-items: center; justify-content: center; flex-direction: column; color: #155724; font-weight: bold; border-right: 2px solid white; }
        .plate-quarter-container { width: 50%; height: 100%; display: flex; flex-direction: column; }
        .plate-quarter { width: 100%; height: 50%; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; font-weight: bold; }
        .qr-box { width: 200px; height: 200px; margin: 15px auto; border: 2px solid #eee; border-radius: 15px; }
        .qr-img { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

<header>
    <img src="logo_left.png" alt="è±åŸé†«é™¢" class="header-logo" onerror="this.style.opacity='0.2'">
    <div class="header-title-box">
        <h1>è…åˆ©ç®¡å®¶</h1>
        <p>æ‚¨çš„å°ˆå±¬è­·è…å°å¹«æ‰‹</p>
    </div>
    <img src="logo_right_new.png" alt="äº”ç¦è—¥å¸«åœˆ" class="header-logo" onerror="this.style.opacity='0.2'">
</header>

<div class="container">

    <div id="tab-home" class="section active">
        <div class="card">
            <h2>ğŸ“Š æˆ‘çš„è…è‡Ÿåœ°åœ–</h2>
            
            <div class="input-group">
                <label>1. è…åŠŸèƒ½ (eGFR)</label>
                <div class="select-wrapper">
                    <select id="egfr-input" onchange="calcRisk()">
                        <option value="" disabled selected>è«‹é»æ­¤é¸æ“‡å€é–“...</option>
                        <option value="90">æ­£å¸¸ (eGFR â‰¥ 90)</option>
                        <option value="60">ç¬¬2æœŸ (eGFR 60-89)</option>
                        <option value="45">ç¬¬3aæœŸ (eGFR 45-59)</option>
                        <option value="30">ç¬¬3bæœŸ (eGFR 30-44)</option>
                        <option value="15">ç¬¬4æœŸ (eGFR 15-29)</option>
                        <option value="5">ç¬¬5æœŸ (eGFR &lt; 15)</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>2. è›‹ç™½å°¿ç‹€æ³ (UACR)</label>
                <div class="select-wrapper">
                    <select id="albumin-input" onchange="calcRisk()">
                        <option value="A1" selected>æ­£å¸¸/è¼•å¾® (&lt;30)</option>
                        <option value="A2">å¾®é‡è›‹ç™½å°¿ (30-299)</option>
                        <option value="A3">åš´é‡è›‹ç™½å°¿ (>300)</option>
                    </select>
                </div>
            </div>

            <p id="start-hint" style="color:#888; font-size:1.1rem; margin-top:20px;">
                ğŸ‘† è«‹é¸æ“‡ä¸Šæ–¹æ•¸å€¼ï¼Œä¸‹æ–¹å°‡è‡ªå‹•é¡¯ç¤ºçµæœ
            </p>

            <div id="risk-result-area" class="hidden">
                <div id="risk-banner" class="risk-banner" style="background:#ccc;">
                    <h3 id="risk-title">--</h3>
                    <p id="risk-desc">--</p>
                </div>

                <div class="risk-matrix">
                    <div class="matrix-header"></div><div class="matrix-header">æ­£å¸¸<br><30</div><div class="matrix-header">å¾®é‡<br>30-299</div><div class="matrix-header">åš´é‡<br>>300</div>
                    <div class="matrix-label">ç¬¬1æœŸ<br>>90</div><div class="matrix-cell bg-g" id="cell-1-1"></div><div class="matrix-cell bg-g" id="cell-1-2"></div><div class="matrix-cell bg-o" id="cell-1-3"></div>
                    <div class="matrix-label">ç¬¬2æœŸ<br>60-89</div><div class="matrix-cell bg-g" id="cell-2-1"></div><div class="matrix-cell bg-g" id="cell-2-2"></div><div class="matrix-cell bg-o" id="cell-2-3"></div>
                    <div class="matrix-label">ç¬¬3a<br>45-59</div><div class="matrix-cell bg-y" id="cell-3a-1"></div><div class="matrix-cell bg-o" id="cell-3a-2"></div><div class="matrix-cell bg-r" id="cell-3a-3"></div>
                    <div class="matrix-label">ç¬¬3b<br>30-44</div><div class="matrix-cell bg-o" id="cell-3b-1"></div><div class="matrix-cell bg-r" id="cell-3b-2"></div><div class="matrix-cell bg-r" id="cell-3b-3"></div>
                    <div class="matrix-label">ç¬¬4æœŸ<br>15-29</div><div class="matrix-cell bg-r" id="cell-4-1"></div><div class="matrix-cell bg-r" id="cell-4-2"></div><div class="matrix-cell bg-r" id="cell-4-3"></div>
                    <div class="matrix-label">ç¬¬5æœŸ<br><15</div><div class="matrix-cell bg-r" id="cell-5-1"></div><div class="matrix-cell bg-r" id="cell-5-2"></div><div class="matrix-cell bg-r" id="cell-5-3"></div>
                </div>

                <p style="color:#d32f2f; font-weight:bold; margin-top:20px;">
                    ğŸ‘‡ æ‚¨çš„ç”¨è—¥èˆ‡é£²é£Ÿå»ºè­°å·²ç”Ÿæˆï¼Œè«‹é»é¸ä¸‹æ–¹æŒ‰éˆ•æŸ¥çœ‹ã€‚
                </p>
            </div>
        </div>
    </div>

    <div id="tab-meds" class="section">
        <div class="card">
            <h2>ğŸ’Š å€‹äººåŒ–ç”¨è—¥å»ºè­°</h2>
            
            <div id="med-placeholder" style="padding:40px 10px; color:#999;">
                <div style="font-size:4rem;">ğŸ“‰</div>
                <p>è«‹å…ˆè‡³ã€Œé¦–é ã€é¸æ“‡è…åŠŸèƒ½<br>ç³»çµ±å°‡è‡ªå‹•ç”¢ç”Ÿå»ºè­°</p>
                <button class="btn btn-outline" onclick="switchTab('home')">å‰å¾€é¦–é </button>
            </div>

            <div id="med-content" class="hidden">
                <p style="background:#eee; padding:10px; border-radius:10px; color:#555;">
                    ä¾æ“šæ‚¨çš„ <strong>eGFR <span id="med-egfr-val">--</span></strong> åˆ†æï¼š
                </p>

                <div class="list-card" style="border-color: var(--risk-g);">
                    <div class="list-head" style="background: var(--risk-g);">ğŸŸ¢ å»ºè­°ç”¨è—¥ (æ”¾å¿ƒä½¿ç”¨)</div>
                    <div class="list-body" id="list-med-g"></div>
                </div>
                
                <div class="list-card" style="border-color: var(--risk-y);">
                    <div class="list-head" style="background: var(--risk-y); color:#333;">ğŸŸ¡ é ˆæ³¨æ„ (å°å¿ƒå‰¯ä½œç”¨)</div>
                    <div class="list-body" id="list-med-y"></div>
                </div>

                <div class="list-card" style="border-color: var(--risk-r);">
                    <div class="list-head" style="background: var(--risk-r);">ğŸ”´ ä¸å»ºè­°æœç”¨ (å‚·è…)</div>
                    <div class="list-body" id="list-med-r"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ” è—¥å“æŸ¥è©¢</h2>
            <div style="display:flex; gap:15px;">
                <button class="btn" style="margin:0; flex:1;" onclick="switchTab('consult')">ğŸ’¬ è«®è©¢è—¥å¸«</button>
                <a href="https://www.fyh.mohw.gov.tw/?aid=519" target="_blank" class="btn btn-outline" style="margin:0; flex:1; display:flex; align-items:center; justify-content:center;">ğŸ¥ é†«é™¢æŸ¥è—¥</a>
            </div>
        </div>
    </div>

    <div id="tab-diet" class="section">
        <div class="card">
            <h2>ğŸ½ï¸ å€‹äººåŒ–é£²é£Ÿå»ºè­°</h2>
            
            <div id="diet-placeholder" style="padding:40px 10px; color:#999;">
                <div style="font-size:4rem;">ğŸ¥£</div>
                <p>è«‹å…ˆè‡³ã€Œé¦–é ã€é¸æ“‡è…åŠŸèƒ½<br>ä»¥å–å¾—å°ˆå±¬é£²é£Ÿæ¸…å–®</p>
                <button class="btn btn-outline" onclick="switchTab('home')">å‰å¾€é¦–é </button>
            </div>

            <div id="diet-content" class="hidden">
                <div class="list-card" style="border-color: var(--risk-g);">
                    <div class="list-head" style="background: var(--risk-g);">ğŸŸ¢ å»ºè­°æ”å–</div>
                    <div class="list-body" id="list-diet-g"></div>
                </div>
                <div class="list-card" style="border-color: var(--risk-y);">
                    <div class="list-head" style="background: var(--risk-y); color:#333;">ğŸŸ¡ é ˆæ³¨æ„/æ¸›é‡</div>
                    <div class="list-body" id="list-diet-y"></div>
                </div>
                <div class="list-card" style="border-color: var(--risk-r);">
                    <div class="list-head" style="background: var(--risk-r);">ğŸ”´ ä¸å»ºè­°æ”å–</div>
                    <div class="list-body" id="list-diet-r"></div>
                </div>
            </div>

            <hr style="margin: 30px 0; border:0; border-top:2px dashed #ddd;">

            <h3 style="color:var(--primary); margin-bottom:10px;">ğŸ” å–®é …é£Ÿç‰©æŸ¥è©¢</h3>
            <div class="select-wrapper">
                <select id="food-select" onchange="checkFood()">
                    <option value="">è«‹é»æ­¤é¸æ“‡é£Ÿç‰©...</option>
                    <optgroup label="å¸¸è¦‹é£Ÿæ">
                        <option value="egg">é›è›‹ç™½</option><option value="tofu">å«©è±†è…</option><option value="rice_noodle">å†¬ç²‰/ç±³ç²‰</option><option value="rice">ç™½é£¯</option><option value="veg">é«˜éº—èœ/æ´‹è”¥</option><option value="fruit_low">è˜‹æœ/é³³æ¢¨</option><option value="oil">æ©„æ¬–æ²¹/è‹¦èŒ¶æ²¹</option>
                        <option value="spinach">è èœ/åœ°ç“œè‘‰</option><option value="brown_rice">ç³™ç±³/äº”ç©€ç±³</option><option value="nuts">å …æœ</option><option value="coffee">é»‘å’–å•¡</option><option value="banana">é¦™è•‰</option>
                        <option value="starfruit">æ¥Šæ¡ƒ</option><option value="sausage">é¦™è…¸/ç«è…¿</option><option value="organs">å…§è‡Ÿ(è±¬è‚)</option><option value="cola">å¯æ¨‚/æ±½æ°´</option><option value="chicken">é›ç²¾</option>
                    </optgroup>
                </select>
            </div>
            <div id="food-result" class="result-box hidden"></div>
        </div>
    </div>

    <div id="tab-quiz" class="section">
        <div class="card">
            <h2>ğŸ“ è…åˆ©å¤§æœƒè€ƒ</h2>
            <div class="progress-bar"><div id="quiz-progress" class="progress-fill"></div></div>
            <p id="quiz-counter" style="text-align:right; color:#666;">Q1/10</p>
            <div id="quiz-area">
                <h3 id="quiz-question" style="min-height:60px;">è¼‰å…¥ä¸­...</h3>
                <div id="quiz-options"></div>
            </div>
            <div id="quiz-feedback" class="hidden" style="margin-top:20px;">
                <div id="quiz-res-text" style="font-size:1.5rem; font-weight:900; margin-bottom:10px;"></div>
                <div id="quiz-exp" style="background:#fff; padding:15px; border-radius:10px; border:1px solid #ccc; color:#444;"></div>
                <button class="btn btn-next" onclick="nextQ()">ä¸‹ä¸€é¡Œ âœ</button>
            </div>
            <div id="quiz-score" class="hidden">
                <h3 style="font-size:3rem; color:var(--primary);">å¾—åˆ†ï¼š<span id="final-score">0</span></h3>
                <button class="btn" onclick="initQuiz()">ğŸ”„ å†æ¸¬ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <div id="tab-consult" class="section">
        <div class="card">
            <h2>ğŸ’¬ è—¥å¸«è«®è©¢å®¤</h2>
            
            <div style="background:#f9f9f9; padding:20px; border-radius:20px; border:2px solid #eee; margin-bottom:20px;">
                <h3 style="color:#06c755; margin-top:0;">LINE å®˜æ–¹å¸³è™Ÿ</h3>
                <div class="qr-box">
                    <img src="line_qr.png" class="qr-img" onerror="this.style.display='none'">
                </div>
                <a href="https://lin.ee/zwLjX1Lb" target="_blank" class="btn btn-line">ğŸ“² åŠ å…¥å¥½å‹ (ç·šä¸Šè«®è©¢)</a>
            </div>

            <div style="background:#fff8e1; padding:20px; border-radius:20px; border:2px solid #ffe0b2;">
                <h3 style="color:var(--accent); margin-top:0;">æ…¢ç®‹é ç´„</h3>
                <p style="font-weight:bold; color:#555;">ä¸ç”¨æ’éšŠï¼Œæ‰‹æ©Ÿé ç´„é ˜è—¥</p>
                <a href="https://nreg.fyh.mohw.gov.tw/OReg/HomePage?page=ChronicRegisterPage#" target="_blank" class="btn btn-refill">å‰å¾€é ç´„ âœ</a>
            </div>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home')"><span class="nav-icon">ğŸ </span>é¦–é </div>
    <div class="nav-item" onclick="switchTab('meds')"><span class="nav-icon">ğŸ’Š</span>ç”¨è—¥</div>
    <div class="nav-item" onclick="switchTab('diet')"><span class="nav-icon">ğŸ¥¦</span>é£²é£Ÿ</div>
    <div class="nav-item" onclick="switchTab('quiz')"><span class="nav-icon">ğŸ“</span>æ¸¬é©—</div>
    <div class="nav-item" onclick="switchTab('consult')"><span class="nav-icon">ğŸ’¬</span>è«®è©¢</div>
</nav>

<script>
    // --- æ ¸å¿ƒé‚è¼¯ï¼šè‡ªå‹•è¨ˆç®—é¢¨éšª (Auto Calc) ---
    function calcRisk() {
        const egfr = document.getElementById('egfr-input').value;
        const uacr = document.getElementById('albumin-input').value;
        
        // è‹¥ eGFR é‚„æ²’é¸ï¼Œå°±ä¸åŸ·è¡Œ (ä¿æŒå®‰éœï¼Œä¸å½ˆçª—)
        if (!egfr) return;

        // 1. é¡¯ç¤ºçµæœå€
        document.getElementById('start-hint').classList.add('hidden');
        document.getElementById('risk-result-area').classList.remove('hidden');
        
        // 2. æ¸…é™¤èˆŠè—æ¡†
        document.querySelectorAll('.matrix-cell').forEach(c => c.classList.remove('active-cell'));

        // 3. è¨ˆç®—åº§æ¨™ (Row & Col)
        const eVal = parseFloat(egfr);
        let row = '5', stageText = 'ç¬¬5æœŸ';
        if (eVal >= 90) { row = '1'; stageText = 'ç¬¬1æœŸ'; }
        else if (eVal >= 60) { row = '2'; stageText = 'ç¬¬2æœŸ'; }
        else if (eVal >= 45) { row = '3a'; stageText = 'ç¬¬3aæœŸ'; }
        else if (eVal >= 30) { row = '3b'; stageText = 'ç¬¬3bæœŸ'; }
        else if (eVal >= 15) { row = '4'; stageText = 'ç¬¬4æœŸ'; }

        let col = '1', uacrText = 'æ­£å¸¸/è¼•å¾®';
        if (uacr === 'A2') { col = '2'; uacrText = 'å¾®é‡è›‹ç™½å°¿'; }
        if (uacr === 'A3') { col = '3'; uacrText = 'åš´é‡è›‹ç™½å°¿'; }

        // 4. å®šä½ä¸¦åŠ æ¡†
        const cellId = `cell-${row}-${col}`;
        const cell = document.getElementById(cellId);
        if (cell) cell.classList.add('active-cell');

        // 5. åˆ¤æ–·é¡è‰²èˆ‡é¢¨éšªæ–‡å­—
        let color = '#e03e2e', text = 'è¶…é«˜é¢¨éšª';
        if (cell.classList.contains('bg-g')) { color = '#6bbd45'; text = 'ä½é¢¨éšª (å®šæœŸè¿½è¹¤)'; }
        else if (cell.classList.contains('bg-y')) { color = '#ffd700'; text = 'ä¸­åº¦é¢¨éšª (éœ€æ³¨æ„)'; }
        else if (cell.classList.contains('bg-o')) { color = '#f58220'; text = 'é«˜é¢¨éšª (åš´æ ¼æ§åˆ¶)'; }

        // 6. æ›´æ–°é¦–é  Banner
        const banner = document.getElementById('risk-banner');
        banner.style.backgroundColor = color;
        // é»ƒè‰²èƒŒæ™¯æ™‚æ–‡å­—æ”¹é»‘ï¼Œå…¶ä»–ç™½
        banner.style.color = (color === '#ffd700') ? '#222' : '#fff'; 
        
        document.getElementById('risk-title').innerText = text;
        document.getElementById('risk-desc').innerText = `è…çµ²çƒéæ¿¾ç‡${stageText} + ${uacrText}`;

        // 7. åŒæ­¥æ›´æ–°ç”¨è—¥èˆ‡é£²é£Ÿå»ºè­°
        updateMeds(eVal);
        updateDiet(eVal);
    }

    // --- ç”¨è—¥å»ºè­°ç”¢ç”Ÿå™¨ ---
    function updateMeds(egfr) {
        document.getElementById('med-placeholder').classList.add('hidden');
        document.getElementById('med-content').classList.remove('hidden');
        
        // å–å¾— eGFR é¸é …æ–‡å­—
        const sel = document.getElementById('egfr-input');
        const txt = sel.options[sel.selectedIndex].text;
        document.getElementById('med-egfr-val').innerText = txt;

        const g = document.getElementById('list-med-g');
        const y = document.getElementById('list-med-y');
        const r = document.getElementById('list-med-r');
        g.innerHTML = ''; y.innerHTML = ''; r.innerHTML = '';

        function add(list, title, desc) {
            list.innerHTML += `<div class="list-item"><span class="list-title">${title}</span><span style="color:#555;">${desc}</span></div>`;
        }

        // ç¶ ç‡ˆ
        add(g, "ACEi / ARB (è¡€å£“è—¥)", "ä¿è­·è…è‡Ÿé¦–é¸ï¼Œæ¸›å°‘è›‹ç™½å°¿ã€‚");
        add(g, "SGLT2 æŠ‘åˆ¶åŠ‘ (æ’ç³–è—¥)", "åœ‹éš›æŒ‡å¼•æ¨è–¦ï¼Œå»¶ç·©æ´—è…ã€ä¿è­·å¿ƒè‡Ÿã€‚");
        add(g, "Statins (é™è¡€è„‚è—¥)", "é é˜²è¡€ç®¡é˜»å¡ï¼Œé™ä½ä¸­é¢¨é¢¨éšªã€‚");

        // é»ƒç‡ˆ
        add(y, "Diuretics (åˆ©å°¿åŠ‘)", "è‹¥æ‹‰è‚šå­æˆ–å˜”åè„«æ°´ï¼Œéœ€è©•ä¼°æš«åœã€‚");
        add(y, "æŠ—ç”Ÿç´  (Antibiotics)", "çœ‹è¨ºè«‹å‘ŠçŸ¥é†«å¸«è…åŠŸèƒ½ï¼Œèª¿æ•´åŠ‘é‡ã€‚");

        // ç´…ç‡ˆ (å‹•æ…‹é‚è¼¯)
        add(r, "NSAIDs (å¼·æ•ˆæ­¢ç—›è—¥)", "å‚·è…åœ°é›·ï¼æ˜“å°è‡´æ€¥æ€§è…è¡°ç«­ã€‚");
        add(r, "ä¾†è·¯ä¸æ˜ä¸­è‰è—¥", "å¯èƒ½å«é‡é‡‘å±¬æˆ–é¦¬å…œéˆ´é…¸ï¼Œçµ•å°ç¦æ­¢ã€‚");
        add(r, "å«ç¢˜é¡¯å½±åŠ‘ (CT)", "æª¢æŸ¥å‰å‘ŠçŸ¥é†«å¸«ï¼Œæª¢æŸ¥å¾Œå¤šå–æ°´ã€‚");

        if (egfr < 30) {
            add(r, "Metformin (é™ç³–è—¥)", "eGFR < 30 ç¦æ­¢ä½¿ç”¨ï¼Œä¹³é…¸ä¸­æ¯’é¢¨éšªé«˜ã€‚");
        } else if (egfr < 45) {
            add(y, "Metformin (é™ç³–è—¥)", "eGFR 30-45 éœ€æ¸›é‡ä¸¦å°å¿ƒç›£æ¸¬ã€‚");
        }
    }

    // --- é£²é£Ÿå»ºè­°ç”¢ç”Ÿå™¨ ---
    function updateDiet(egfr) {
        document.getElementById('diet-placeholder').classList.add('hidden');
        document.getElementById('diet-content').classList.remove('hidden');

        const g = document.getElementById('list-diet-g');
        const y = document.getElementById('list-diet-y');
        const r = document.getElementById('list-diet-r');
        g.innerHTML = ''; y.innerHTML = ''; r.innerHTML = '';

        function add(list, title, desc) {
            list.innerHTML += `<div class="list-item"><span class="list-title">${title}</span><span style="color:#555;">${desc}</span></div>`;
        }

        add(g, "å„ªè³ªè›‹ç™½è³ª", "é›è›‹ã€è±†è…ã€é­šè‚‰ã€‚å¸æ”¶å¥½ã€å»¢ç‰©å°‘ã€‚");
        add(g, "å¤©ç„¶å¥½æ²¹", "æ©„æ¬–æ²¹ã€è‹¦èŒ¶æ²¹ã€‚");
        add(r, "æ¥Šæ¡ƒ (çµ•å°ç¦æ­¢)", "å«ç¥ç¶“æ¯’ç´ ï¼Œè…å‹ç„¡æ³•ä»£è¬ææ˜è¿·ã€‚");
        add(r, "åŠ å·¥è‚‰å“", "é¦™è…¸ã€ç«è…¿å«é«˜ç£·ï¼Œæ¥µå‚·è¡€ç®¡ã€‚");

        if (egfr < 45) { // ä¸­é‡åº¦
            add(g, "ä½æ°®æ¾±ç²‰", "å†¬ç²‰ã€ç±³ç²‰ã€‚è£œå……ç†±é‡ä¸å‚·è…ã€‚");
            add(y, "ç³™ç±³/äº”ç©€ç±³", "ç£·å«é‡é«˜ï¼Œæ™šæœŸå»ºè­°æ”¹åƒç™½é£¯ã€‚");
            add(y, "æ·±ç¶ è‰²è”¬èœ", "é‰€é«˜ï¼Œå»ºè­°åˆ‡æ®µæ±†ç‡™å¾Œå†åƒã€‚");
            add(y, "å …æœé¡", "ç£·é‰€é›™é«˜ï¼Œå°‘åƒç‚ºå¦™ã€‚");
            add(r, "ä½éˆ‰é¹½", "é€šå¸¸æ˜¯ã€Œé«˜é‰€é¹½ã€ï¼Œæœƒé€ æˆå¿ƒå¾‹ä¸æ•´ã€‚");
        } else { // åˆæœŸ
            add(g, "è”¬èœæ°´æœ", "ä¿æŒæ’ä¾¿é †æš¢ã€‚");
            add(y, "é‡å£å‘³é£Ÿç‰©", "é¹½åˆ†å¤ªé«˜æœƒå‚·è…ã€‚");
        }
    }

    // --- å–®é …é£Ÿç‰©æŸ¥è©¢è³‡æ–™åº« ---
    const foodDB = {
        'egg': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'å„ªè³ªè›‹ç™½è³ªï¼Œç£·å«é‡ä½ï¼Œæ¨è–¦é£Ÿç”¨ã€‚'},
        'tofu': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'æ¤ç‰©æ€§è›‹ç™½ï¼Œç”¢ç”Ÿå°¿æ¯’ç´ å°‘ã€‚'},
        'rice_noodle': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'ä½æ°®æ¾±ç²‰ï¼Œè£œå……ç†±é‡é¦–é¸ã€‚'},
        'rice': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'æ¯”ç³™ç±³ä½ç£·ï¼Œé©åˆæ™šæœŸè…å‹ã€‚'},
        'veg': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'ä½é‰€è”¬èœï¼Œé©åˆé£Ÿç”¨ã€‚'},
        'fruit_low': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'ä½é‰€æ°´æœï¼Œå¯é©é‡é£Ÿç”¨ã€‚'},
        'oil': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'å„ªè³ªå¥½æ²¹ï¼Œä¿è­·å¿ƒè¡€ç®¡ã€‚'},
        'spinach': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'é«˜é‰€ï¼Œè«‹æ±†ç‡™éå†åƒã€‚'},
        'brown_rice': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'é«˜ç£·ï¼ŒåˆæœŸå¯åƒï¼Œæ™šæœŸå»ºè­°å°‘åƒã€‚'},
        'nuts': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'ç£·é‰€çš†é«˜ï¼Œä¸€å¤©é™ 5 é¡†ã€‚'},
        'coffee': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'å«é‰€ä¸”åˆ©å°¿ï¼Œä¸€å¤©ä¸€æ¯ç‚ºé™ã€‚'},
        'banana': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'é«˜é‰€æ°´æœï¼Œè¡€é‰€é«˜è€…é¿å…ã€‚'},
        'starfruit': {t:'ğŸ”´ ç´…ç‡ˆ', d:'çµ•å°ç¦æ­¢ï¼å«ç¥ç¶“æ¯’ç´ ã€‚'},
        'sausage': {t:'ğŸ”´ ç´…ç‡ˆ', d:'åŠ å·¥è‚‰å“å«ç„¡æ©Ÿç£·ï¼Œæ¥µå‚·è…ã€‚'},
        'organs': {t:'ğŸ”´ ç´…ç‡ˆ', d:'å…§è‡Ÿé«˜æ¯’ç´ ã€é«˜ç£·ã€‚'},
        'cola': {t:'ğŸ”´ ç´…ç‡ˆ', d:'å«å¤§é‡ç£·é…¸ï¼Œéš±å½¢æ®ºæ‰‹ã€‚'},
        'chicken': {t:'ğŸ”´ ç´…ç‡ˆ', d:'æ¿ƒç¸®é‰€èˆ‡æ™®æ—ï¼ŒåŠ é‡è² æ“”ã€‚'}
    };

    function checkFood() {
        const val = document.getElementById('food-select').value;
        const res = document.getElementById('food-result');
        res.classList.add('hidden');
        if(!val) return;
        const data = foodDB[val];
        res.classList.remove('hidden');
        res.innerHTML = `<strong style="font-size:1.4rem;">${data.t}</strong><br>${data.d}`;
        if(data.t.includes('ç´…')) { res.style.borderColor = 'red'; res.style.background = '#fff5f5'; }
        else if(data.t.includes('é»ƒ')) { res.style.borderColor = 'gold'; res.style.background = '#fffbe6'; }
        else { res.style.borderColor = 'green'; res.style.background = '#e8f5e9'; }
    }

    // --- é é¢åˆ‡æ› ---
    function switchTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        // ç°¡å–®å°æ‡‰ï¼š0=Home, 1=Meds, 2=Diet, 3=Quiz, 4=Consult
        const idx = (id==='home')?0:(id==='meds')?1:(id==='diet')?2:(id==='quiz')?3:4;
        document.querySelectorAll('.nav-item')[idx].classList.add('active');
        window.scrollTo(0,0);
    }

    // --- æ¸¬é©—åŠŸèƒ½ ---
    const quizData = [
        {q:"è¦æ”¹åƒã€Œè–„é¹½é†¬æ²¹ã€æˆ–ã€Œä½éˆ‰é¹½ã€å—ï¼Ÿ", a:[{t:"å°ï¼Œå°‘é¹½å°±å¥½",c:false},{t:"éŒ¯ï¼Œé‚£æ˜¯é«˜é‰€é¹½",c:true}], exp:"ä½éˆ‰é¹½é€šå¸¸ä»¥ã€Œé‰€ã€å–ä»£éˆ‰ï¼Œè…å‹æ’é‰€åŠŸèƒ½å·®ï¼Œåƒå¤šæè‡´å¿ƒå¾‹ä¸æ•´ã€‚"},
        {q:"é—œæ–¼å–æ°´ï¼Œä½•è€…æ­£ç¢ºï¼Ÿ", a:[{t:"å®Œå…¨ä¸èƒ½å–æ°´",c:false},{t:"æ²’æ°´è…«æ‡‰é©é‡å–",c:true}], exp:"é™¤éå·²é€ææˆ–åš´é‡æ°´è…«ï¼Œå¦å‰‡æ°´åˆ†ä¸è¶³æœƒæ¸›å°‘è…è‡Ÿè¡€æµï¼Œåè€Œå‚·è…ã€‚"},
        {q:"å¯ä»¥è‡ªå·±è²·ã€Œå¼·æ•ˆæ­¢ç—›è—¥ã€å—ï¼Ÿ", a:[{t:"çµ•å°ä¸å¯",c:true},{t:"å¯ä»¥ï¼Œå°‘åƒå°±å¥½",c:false}], exp:"å¸‚å”®å¼·æ•ˆæ­¢ç—›è—¥(NSAIDs)æœƒæ”¶ç¸®è…è¡€ç®¡ï¼Œæ¥µæ˜“é€ æˆæ€¥æ€§è…æå‚·ã€‚"},
        {q:"å°¿æœ‰æ³¡æ³¡å°±æ˜¯è…è‡Ÿå£äº†å—ï¼Ÿ", a:[{t:"ä¸ä¸€å®šï¼Œéœ€æª¢é©—",c:true},{t:"å°ï¼Œæº–å‚™æ´—è…",c:false}], exp:"å°¿å¤ªæ¿ƒæˆ–è¡åŠ›å¤§ä¹Ÿæœƒæœ‰æ³¡æ³¡ã€‚è‹¥æ³¡æ³¡ã€Œ10åˆ†é˜ä¸æ•£ã€æ‰é«˜åº¦æ‡·ç–‘è›‹ç™½å°¿ã€‚"},
        {q:"æ¥Šæ¡ƒå¾ˆå¥½åƒï¼Œåƒä¸€é»æ²’é—œä¿‚ï¼Ÿ", a:[{t:"çµ•å°ç¦æ­¢",c:true},{t:"å¯ä»¥åƒä¸€å£",c:false}], exp:"æ¥Šæ¡ƒå«ç¥ç¶“æ¯’ç´ ï¼Œè…å‹ç„¡æ³•ä»£è¬ï¼Œé£Ÿç”¨æå°è‡´æŠ½ææ˜è¿·ã€‚"}
    ];
    let qIdx = 0, score = 0;
    
    function initQuiz() { 
        qIdx=0; score=0; 
        document.getElementById('quiz-score').classList.add('hidden'); 
        document.getElementById('quiz-area').classList.remove('hidden'); 
        renderQ(); 
    }
    
    function renderQ() {
        const q = quizData[qIdx];
        document.getElementById('quiz-counter').innerText = `Q${qIdx+1}/${quizData.length}`;
        document.getElementById('quiz-question').innerText = q.q;
        document.getElementById('quiz-feedback').classList.add('hidden');
        const div = document.getElementById('quiz-options');
        div.innerHTML = '';
        q.a.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'quiz-option';
            btn.innerText = opt.t;
            btn.onclick = () => {
                document.querySelectorAll('.quiz-option').forEach(b=>b.style.pointerEvents='none');
                if(opt.c) { btn.classList.add('correct'); score+=20; document.getElementById('quiz-res-text').innerText="ğŸ‰ ç­”å°äº†ï¼"; document.getElementById('quiz-res-text').style.color="green"; }
                else { btn.classList.add('wrong'); document.getElementById('quiz-res-text').innerText="ğŸ˜± ç­”éŒ¯å›‰ï¼"; document.getElementById('quiz-res-text').style.color="red"; }
                document.getElementById('quiz-exp').innerText = q.exp;
                document.getElementById('quiz-feedback').classList.remove('hidden');
            };
            div.appendChild(btn);
        });
        // Update Progress
        document.querySelector('.progress-fill').style.width = `${((qIdx)/quizData.length)*100}%`;
    }

    function nextQ() {
        qIdx++;
        if(qIdx < quizData.length) renderQ();
        else {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('quiz-feedback').classList.add('hidden');
            document.getElementById('quiz-score').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.querySelector('.progress-fill').style.width = '100%';
        }
    }
    initQuiz();
</script>
</body>
</html>

