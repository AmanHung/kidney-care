<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è…åˆ©ç®¡å®¶ v4.3 (é•·è¼©ç‰ˆ)</title>
    <style>
        :root {
            /* --- è±åŸé†«é™¢é…è‰² --- */
            --primary: #009045;
            --primary-dark: #007035;
            --accent: #F58220;
            --secondary: #009ADA;
            
            --bg: #fdfdfd; /* èƒŒæ™¯æ›´ç™½ï¼Œå¢åŠ å°æ¯” */
            --white: #ffffff;
            --text: #111; /* ç´”é»‘å­—é«”ï¼Œæœ€é«˜å°æ¯” */
            
            /* --- é¢¨éšªç‡ˆè™Ÿ --- */
            --risk-g: #6bbd45; --risk-y: #ffd700; --risk-o: #f58220; --risk-r: #e03e2e;
            
            --nav-height: 85px; /* å°èˆªåˆ—æ›´åŠ é«˜ */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        /* ğŸŒŸ å­—é«”å…¨é¢æ”¾å¤§ (22px) */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; padding: 0; 
            padding-bottom: calc(var(--nav-height) + 20px); 
            color: var(--text); 
            font-size: 22px; 
            line-height: 1.5;
            user-select: none; 
        }

        /* --- Header --- */
        header { 
            background: var(--white); padding: 15px; border-radius: 0 0 30px 30px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        header::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 8px;
            background: linear-gradient(90deg, var(--secondary) 20%, var(--primary) 50%, var(--accent) 80%);
        }
        .header-logo { max-height: 55px; max-width: 28vw; width: auto; height: auto; object-fit: contain; flex-shrink: 0; }
        .header-title-box { text-align: center; flex: 1; padding: 0 5px; min-width: 130px; }
        .header-title-box h1 { margin: 0; font-size: 1.6rem; letter-spacing: 1px; color: var(--primary); font-weight: 900; }
        .header-title-box p { margin: 2px 0 0; color: #555; font-size: 1rem; font-weight: bold; }

        /* --- Container --- */
        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--white); border-radius: 25px; padding: 25px; margin-bottom: 30px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); text-align: center; border: 2px solid #f0f0f0; }
        .card h2 { margin-top: 0; color: var(--primary); font-size: 1.5rem; font-weight: 900; display: flex; align-items: center; justify-content: center; gap: 10px; border-bottom: 4px solid #f0f4f8; padding-bottom: 15px; margin-bottom: 25px; }

        /* è¼¸å…¥æ¡†åŠ å¤§ */
        .input-row { display: flex; flex-direction: column; gap: 20px; margin-bottom: 10px; }
        .input-group { flex: 1; text-align: left; }
        .input-group label { display: block; font-size: 1.1rem; color: #333; margin-bottom: 10px; font-weight: 900; }
        select { width: 100%; padding: 20px; border: 3px solid #ccc; border-radius: 20px; font-size: 1.2rem; background: #fff; outline: none; color: #000; font-weight: bold; }
        select:focus { border-color: var(--primary); background: #f0fff4; }
        .select-wrapper { position: relative; }
        .select-wrapper::after { content: 'â–¼'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: #444; pointer-events: none; font-size: 1.2rem; }

        /* æŒ‰éˆ•åŠ å¤§ */
        .btn { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; padding: 20px; width: 100%; border-radius: 20px; font-size: 1.3rem; font-weight: 900; cursor: pointer; box-shadow: 0 6px 15px rgba(0,144,69,0.3); transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 10px; text-decoration: none; margin-bottom: 15px; }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 4px solid var(--primary); color: var(--primary); box-shadow: none; font-weight: 900; }
        .btn-line { background: #06c755; box-shadow: 0 6px 15px rgba(6,199,85,0.3); }
        .btn-refill { background: linear-gradient(135deg, var(--accent), #e07010); box-shadow: 0 6px 15px rgba(245,130,32,0.3); } 
        .btn-next { background: linear-gradient(135deg, var(--accent), #e07010); margin-top: 25px; }

        /* KDIGO Grid */
        .risk-matrix { display: grid; grid-template-columns: 70px 1fr 1fr 1fr; gap: 4px; margin: 30px auto; font-size: 1rem; line-height: 1.2; background: #fff; }
        .matrix-cell { display: flex; align-items: center; justify-content: center; text-align: center; padding: 5px; border-radius: 8px; font-weight: 900; color: rgba(0,0,0,0.5); height: 60px; position: relative; }
        .matrix-header { background: #f0f4f8; color: #222; font-weight: 900; padding: 5px 0; }
        .matrix-label { background: #f0f4f8; color: #222; font-weight: 900; font-size: 0.9rem; flex-direction: column; }
        .bg-g { background-color: var(--risk-g); color: white; }
        .bg-y { background-color: var(--risk-y); color: #333; }
        .bg-o { background-color: var(--risk-o); color: white; }
        .bg-r { background-color: var(--risk-r); color: white; }
        .matrix-cell.active-cell { border: 5px solid #0056b3; box-shadow: 0 0 20px rgba(0,86,179,0.5); z-index: 10; transform: scale(1.1); }
        
        /* çµæœé¡¯ç¤º */
        .risk-result-box { margin-top: 25px; padding: 25px; background: #fffbe6; border-radius: 20px; border-left: 10px solid var(--accent); text-align: left; }
        .risk-title { font-size: 1.4rem; font-weight: 900; color: #222; margin-bottom: 10px; }
        .risk-desc { font-size: 1.2rem; color: #444; margin-bottom: 10px; }
        .risk-value { font-size: 1.1rem; color: #666; font-family: monospace; font-weight: bold; }
        
        /* åˆ—è¡¨å¡ç‰‡ (ç”¨è—¥/é£²é£Ÿ) */
        .list-card { text-align: left; margin-bottom: 25px; border-radius: 20px; border: 3px solid #eee; overflow: hidden; }
        .list-head { padding: 18px; font-weight: 900; color: white; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; }
        .list-body { padding: 25px; font-size: 1.2rem; line-height: 1.6; background: #fff; }
        .list-item { margin-bottom: 18px; border-bottom: 2px dashed #ddd; padding-bottom: 18px; }
        .list-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .list-name { font-weight: 900; font-size: 1.3rem; display: block; margin-bottom: 5px; color: #000; }
        .list-effect { font-size: 1.1rem; color: #444; }

        /* å°èˆªåˆ— */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; justify-content: space-around; align-items: center; border-top: 2px solid #ddd; z-index: 1000; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        .nav-item { text-align: center; color: #999; font-size: 0.9rem; flex: 1; padding: 5px; cursor: pointer; transition: 0.2s; font-weight: 800; }
        .nav-item.active { color: var(--primary); font-size: 1rem; }
        .nav-item.active .nav-icon { transform: scale(1.2); color: var(--primary); }
        .nav-icon { font-size: 2rem; display: block; margin-bottom: 5px; color: #bbb; }
        
        /* å…¶ä»– */
        .qr-box { width: 220px; height: 220px; margin: 20px auto; border: 2px solid #eee; border-radius: 20px; overflow: hidden; }
        .qr-img { width: 100%; height: 100%; object-fit: cover; }
        .refill-box { display: flex; align-items: center; background: #fff8e1; border: 3px solid #ffe0b2; padding: 25px; border-radius: 25px; margin-bottom: 30px; gap: 20px; }
        .refill-icon { width: 90px; height: 90px; object-fit: contain; flex-shrink: 0; }
        
        .result-box { background: #e8f5e9; padding: 25px; border-radius: 20px; margin-top: 25px; text-align: left; border-left: 10px solid var(--primary); animation: fadeIn 0.3s ease; }
        .hidden { display: none; }
        
        /* é£²é£ŸæŸ¥è©¢å€å¡Š */
        .diet-search-section { background: #f4f9f6; padding: 25px; border-radius: 25px; margin-top: 30px; border: 2px solid #dcebdc; }
    </style>
</head>
<body>

<header>
    <img src="logo_left.png" alt="è±åŸé†«é™¢" class="header-logo" onerror="this.style.opacity='0.3'">
    <div class="header-title-box">
        <h1>è…åˆ©ç®¡å®¶</h1>
        <p>æ‚¨çš„å°ˆå±¬è­·è…å°å¹«æ‰‹</p>
    </div>
    <img src="logo_right_new.png" alt="äº”ç¦è—¥å¸«åœˆ" class="header-logo" onerror="this.style.opacity='0.3'">
</header>

<div class="container">

    <div id="tab-home" class="section active">
        <div class="card">
            <h2>ğŸ“Š æˆ‘çš„è…è‡Ÿåœ°åœ–</h2>
            <div class="input-row">
                <div class="input-group">
                    <label>1. é¸æ“‡è…åŠŸèƒ½åˆ†æ•¸ (eGFR)</label>
                    <div class="select-wrapper">
                        <select id="egfr-input" onchange="updateAll()">
                            <option value="" disabled selected>è«‹é»æ­¤é¸æ“‡...</option>
                            <option value="90">æ­£å¸¸ (eGFR â‰¥ 90)</option>
                            <option value="60">ç¬¬2æœŸ (eGFR 60-89)</option>
                            <option value="45">ç¬¬3aæœŸ (eGFR 45-59)</option>
                            <option value="30">ç¬¬3bæœŸ (eGFR 30-44)</option>
                            <option value="15">ç¬¬4æœŸ (eGFR 15-29)</option>
                            <option value="5">ç¬¬5æœŸ (eGFR &lt; 15)</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>2. é¸æ“‡è›‹ç™½å°¿ç‹€æ³ (UACR)</label>
                    <div class="select-wrapper">
                        <select id="albumin-input" onchange="updateAll()">
                            <option value="A1">æ­£å¸¸/è¼•å¾® (&lt;30)</option>
                            <option value="A2">å¾®é‡è›‹ç™½å°¿ (30-299)</option>
                            <option value="A3">åš´é‡è›‹ç™½å°¿ (>300)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <p style="font-size: 1rem; color: #666; margin-top: 10px;">(é»é¸ä¸Šæ–¹é¸é …ï¼Œä¸‹æ–¹è‡ªå‹•é¡¯ç¤ºçµæœ)</p>

            <div id="risk-display" class="hidden">
                <div class="risk-result-box">
                    <div class="risk-title">æ‚¨çš„è…è‡ŸåŠŸèƒ½ç‚º <span id="res-risk-text" class="risk-badge">--</span></div>
                    <div class="risk-desc" id="res-detail-text">--</div>
                    <div class="risk-value" id="res-value-text">--</div>
                </div>
                
                <div class="risk-matrix">
                    <div class="matrix-header"></div><div class="matrix-header">æ­£å¸¸<br><30</div><div class="matrix-header">å¾®é‡<br>30-299</div><div class="matrix-header">åš´é‡<br>>300</div>
                    <div class="matrix-label">ç¬¬1æœŸ<br>>90</div><div class="matrix-cell bg-g" id="cell-1-1"></div><div class="matrix-cell bg-g" id="cell-1-2"></div><div class="matrix-cell bg-o" id="cell-1-3"></div>
                    <div class="matrix-label">ç¬¬2æœŸ<br>60-89</div><div class="matrix-cell bg-g" id="cell-2-1"></div><div class="matrix-cell bg-g" id="cell-2-2"></div><div class="matrix-cell bg-o" id="cell-2-3"></div>
                    <div class="matrix-label">ç¬¬3aæœŸ<br>45-59</div><div class="matrix-cell bg-y" id="cell-3a-1"></div><div class="matrix-cell bg-o" id="cell-3a-2"></div><div class="matrix-cell bg-r" id="cell-3a-3"></div>
                    <div class="matrix-label">ç¬¬3bæœŸ<br>30-44</div><div class="matrix-cell bg-o" id="cell-3b-1"></div><div class="matrix-cell bg-r" id="cell-3b-2"></div><div class="matrix-cell bg-r" id="cell-3b-3"></div>
                    <div class="matrix-label">ç¬¬4æœŸ<br>15-29</div><div class="matrix-cell bg-r" id="cell-4-1"></div><div class="matrix-cell bg-r" id="cell-4-2"></div><div class="matrix-cell bg-r" id="cell-4-3"></div>
                    <div class="matrix-label">ç¬¬5æœŸ<br><15</div><div class="matrix-cell bg-r" id="cell-5-1"></div><div class="matrix-cell bg-r" id="cell-5-2"></div><div class="matrix-cell bg-r" id="cell-5-3"></div>
                </div>
                
                <div style="background: #e8f5e9; border: 2px dashed var(--primary); padding: 15px; border-radius: 15px; text-align: left; margin-top: 20px;">
                    <h3 style="margin: 0 0 10px 0; color: var(--primary);">ğŸ‘¨â€âš•ï¸ è—¥å¸«å®åš€ï¼š</h3>
                    <ul style="padding-left: 20px; color: #222; font-weight: bold; margin: 0;">
                        <li id="advice-1" style="margin-bottom: 8px;"></li>
                        <li id="advice-2" style="margin-bottom: 8px;"></li>
                        <li id="advice-3"></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-meds" class="section">
        <div class="card">
            <h2>ğŸ’Š å€‹äººåŒ–ç”¨è—¥å»ºè­°</h2>
            
            <div id="med-placeholder" style="padding: 40px 10px; color: #666;">
                <p style="font-size: 4rem; margin: 0;">ğŸ“‰</p>
                <p style="font-size: 1.3rem; margin: 20px 0;">è«‹å…ˆè‡³ã€Œé¦–é ã€è¼¸å…¥æ•¸å€¼<br>ç³»çµ±å°‡è‡ªå‹•åˆ†ææ‚¨çš„ç”¨è—¥</p>
                <button class="btn btn-outline" onclick="switchTab('home', document.querySelectorAll('.nav-item')[0])">
                    å‰å¾€é¦–é è¼¸å…¥
                </button>
            </div>

            <div id="med-advice-container" class="hidden">
                <p style="font-size:1.1rem; color:#444; margin-bottom:20px; background:#f0f0f0; padding:15px; border-radius:15px; font-weight:bold;">
                    ä¾æ“šæ‚¨çš„ <strong>eGFR <span id="med-egfr-display" style="color:var(--primary)">--</span></strong> åˆ†æçµæœï¼š
                </p>

                <div class="list-card" style="border-color: var(--risk-g);">
                    <div class="list-head" style="background: var(--risk-g);">ğŸŸ¢ å»ºè­°ç”¨è—¥ (æ”¾å¿ƒä½¿ç”¨)</div>
                    <div class="list-body" id="med-list-green"></div>
                </div>

                <div class="list-card" style="border-color: var(--risk-y);">
                    <div class="list-head" style="background: var(--risk-y); color: #333;">ğŸŸ¡ ä½¿ç”¨è¦æ³¨æ„ (å°å¿ƒå‰¯ä½œç”¨)</div>
                    <div class="list-body" id="med-list-yellow"></div>
                </div>

                <div class="list-card" style="border-color: var(--risk-r);">
                    <div class="list-head" style="background: var(--risk-r);">ğŸ”´ ä¸å»ºè­°æœç”¨ (å‚·è…é¢¨éšª)</div>
                    <div class="list-body" id="med-list-red"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ” è—¥å“æŸ¥è©¢æœå‹™</h2>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="btn" style="flex: 1; margin:0;" onclick="switchTab('consult', document.querySelectorAll('.nav-item')[4])">
                    ğŸ’¬ è«®è©¢è—¥å¸«
                </button>
                <a href="https://www.fyh.mohw.gov.tw/?aid=519" target="_blank" class="btn btn-outline" style="flex: 1; margin:0; text-decoration: none;">
                    ğŸ¥ é†«é™¢æŸ¥è—¥
                </a>
            </div>
        </div>
    </div>

    <div id="tab-diet" class="section">
        <div class="card">
            <h2>ğŸ½ï¸ å€‹äººåŒ–é£²é£Ÿå»ºè­°</h2>
            
            <div id="diet-placeholder" style="padding: 40px 10px; color: #666;">
                <p style="font-size: 4rem; margin: 0;">ğŸ¥£</p>
                <p style="font-size: 1.3rem; margin: 20px 0;">è«‹å…ˆè‡³ã€Œé¦–é ã€è¼¸å…¥æ•¸å€¼<br>ä»¥å–å¾—æ‚¨çš„å°ˆå±¬é£²é£Ÿæ¸…å–®</p>
                <button class="btn btn-outline" onclick="switchTab('home', document.querySelectorAll('.nav-item')[0])">
                    å‰å¾€é¦–é è¼¸å…¥
                </button>
            </div>

            <div id="diet-advice-container" class="hidden">
                <p style="font-size:1.1rem; color:#444; margin-bottom:20px; background:#f0f0f0; padding:15px; border-radius:15px; font-weight:bold;">
                    ä¾æ“šæ‚¨çš„è…è‡ŸåŠŸèƒ½å»ºè­°ï¼š
                </p>

                <div class="list-card" style="border-color: var(--risk-g);">
                    <div class="list-head" style="background: var(--risk-g);">ğŸŸ¢ å»ºè­°æ”å– (Good)</div>
                    <div class="list-body" id="diet-list-green"></div>
                </div>

                <div class="list-card" style="border-color: var(--risk-y);">
                    <div class="list-head" style="background: var(--risk-y); color: #333;">ğŸŸ¡ é ˆæ³¨æ„/æ¸›é‡ (Caution)</div>
                    <div class="list-body" id="diet-list-yellow"></div>
                </div>

                <div class="list-card" style="border-color: var(--risk-r);">
                    <div class="list-head" style="background: var(--risk-r);">ğŸ”´ ä¸å»ºè­°æ”å– (Avoid)</div>
                    <div class="list-body" id="diet-list-red"></div>
                </div>
            </div>

            <div class="diet-search-section">
                <h3 style="color: var(--primary); margin-top:0;">ğŸ” å–®é …é£Ÿç‰©æŸ¥è©¢</h3>
                <p style="font-size: 1rem; color: #555; margin-bottom: 10px;">æƒ³æŸ¥ç‰¹å®šçš„é£Ÿç‰©èƒ½ä¸èƒ½åƒï¼Ÿ</p>
                <div class="select-wrapper">
                    <select id="food-select" onchange="checkFood()">
                        <option value="">è«‹é»æ­¤é¸æ“‡é£Ÿç‰©...</option>
                        <optgroup label="å¸¸è¦‹é£Ÿæ">
                            <option value="egg_white">é›è›‹ç™½</option><option value="tofu">å«©è±†è…</option><option value="rice_noodle">å†¬ç²‰/ç±³ç²‰</option><option value="white_rice">ç™½é£¯</option><option value="cabbage">é«˜éº—èœ/æ´‹è”¥</option><option value="apple">è˜‹æœ/é³³æ¢¨</option><option value="olive_oil">æ©„æ¬–æ²¹</option>
                            <option value="spinach">è èœ/åœ°ç“œè‘‰</option><option value="brown_rice">ç³™ç±³/äº”ç©€ç±³</option><option value="nuts">å …æœ</option><option value="coffee">é»‘å’–å•¡</option><option value="kiwi">å¥‡ç•°æœ</option><option value="banana">é¦™è•‰</option>
                            <option value="starfruit">æ¥Šæ¡ƒ</option><option value="processed_meat">é¦™è…¸/ç«è…¿</option><option value="organs">è±¬è‚/è…°å­</option><option value="low_na_salt">ä½éˆ‰é¹½/è–„é¹½é†¬æ²¹</option><option value="cola">å¯æ¨‚</option><option value="chicken_essence">é›ç²¾</option><option value="instant_noodle">æ³¡éºµ</option><option value="pastry">æ²¹æ¢/éºµåŒ…</option>
                        </optgroup>
                    </select>
                </div>
                <div id="food-result" class="result-box hidden"></div>
            </div>
        </div>
    </div>

    <div id="tab-quiz" class="section">
        <div class="card">
            <h2>ğŸ“ è…åˆ©å¤§æœƒè€ƒ</h2>
            <div class="progress-bar"><div id="quiz-progress" class="progress-fill"></div></div>
            <p id="quiz-counter" style="font-size:1.1rem; color:#666; text-align:right;">Q1/10</p>
            <div id="quiz-area">
                <h3 id="quiz-question" style="color: #333; min-height: 70px; font-size: 1.4rem;">è¼‰å…¥ä¸­...</h3>
                <div id="quiz-options"></div>
            </div>
            <div id="quiz-feedback-box" class="hidden" style="margin-top: 25px;">
                <div id="quiz-feedback-text" style="font-weight: 900; margin-bottom: 15px; font-size: 1.5rem;"></div>
                <div id="quiz-explanation" style="font-size: 1.2rem; color: #444; background: #fff; padding: 20px; border-radius: 15px; border: 2px solid #ccc;"></div>
                <button class="btn btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ âœ</button>
            </div>
            <div id="quiz-score-area" class="hidden">
                <h3 style="font-size: 3rem; color: var(--primary);">å¾—åˆ†ï¼š<span id="final-score">0</span></h3>
                <p id="score-comment" style="font-size: 1.4rem; font-weight: 900;"></p>
                <button class="btn" onclick="restartQuiz()">ğŸ”„ å†æ¸¬ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <div id="tab-consult" class="section">
        <div class="card">
            <h2>ğŸ’¬ è—¥å¸«è«®è©¢å®¤</h2>
            <p style="color: #666; margin-bottom: 25px; font-size: 1.2rem;">æ­¡è¿é€é LINE è¯ç¹«æˆ‘å€‘</p>
            
            <div style="background: #f9f9f9; padding: 30px; border-radius: 25px; border: 3px solid #eee; margin-bottom: 35px;">
                <h3 style="color: #06c755; margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <span style="font-size: 2rem;">LINE</span> å®˜æ–¹å¸³è™Ÿ
                </h3>
                <div class="qr-box">
                    <img src="line_qr.png" alt="LINE QR Code" class="qr-img" onerror="this.src=''; this.style.display='none'; this.parentNode.innerHTML='<span style=\'display:block; padding-top:70px; color:#999\'>è«‹ä¸Šå‚³ line_qr.png</span>'">
                </div>
                <p style="font-size: 1.1rem; color: #555; margin-bottom: 25px; font-weight: bold;">(é•·æŒ‰å„²å­˜æˆ–æƒæ QR Code)</p>
                <a href="https://lin.ee/zwLjX1Lb" target="_blank" class="btn btn-line">
                    <span>ğŸ“² åŠ å…¥å¥½å‹ (ç·šä¸Šè«®è©¢)</span>
                </a>
            </div>

            <div class="refill-box">
                <img src="icon_refill.png" alt="æ…¢ç®‹é ç´„" class="refill-icon" onerror="this.style.opacity='0.3'">
                <div style="flex: 1; text-align: left;">
                    <h3 style="margin: 0 0 8px 0; color: var(--accent); font-size: 1.6rem;">æ…¢ç®‹é ç´„</h3>
                    <p style="font-size: 1.1rem; color: #555; margin-bottom: 15px; line-height: 1.4; font-weight: bold;">
                        ä¸ç”¨ç¾å ´æ’éšŠ<br>æ‰‹æ©Ÿé ç´„é ˜è—¥
                    </p>
                    <a href="https://nreg.fyh.mohw.gov.tw/OReg/HomePage?page=ChronicRegisterPage#" target="_blank" class="btn btn-refill" style="padding: 15px; font-size: 1.2rem; margin:0;">
                        å‰å¾€é ç´„ âœ
                    </a>
                </div>
            </div>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)"><span class="nav-icon">ğŸ </span>é¦–é </div>
    <div class="nav-item" onclick="switchTab('meds', this)"><span class="nav-icon">ğŸ’Š</span>ç”¨è—¥</div>
    <div class="nav-item" onclick="switchTab('diet', this)"><span class="nav-icon">ğŸ¥¦</span>é£²é£Ÿ</div>
    <div class="nav-item" onclick="switchTab('quiz', this)"><span class="nav-icon">ğŸ“</span>æ¸¬é©—</div>
    <div class="nav-item" onclick="switchTab('consult', this)"><span class="nav-icon">ğŸ’¬</span>è«®è©¢</div>
</nav>

<script>
    // --- Data Definitions ---
    const foodLookupDB = {
        'egg_white': { t: 'ğŸŸ¢ ç¶ ç‡ˆ', d: 'é«˜ç”Ÿç‰©åƒ¹è›‹ç™½è³ªï¼Œç£·å«é‡ä½ï¼Œæ¨è–¦é£Ÿç”¨ã€‚' },
        'tofu': { t: 'ğŸŸ¢ ç¶ ç‡ˆ', d: 'æ¤ç‰©æ€§è›‹ç™½ç”¢ç”Ÿçš„å«æ°®å»¢ç‰©è¼ƒå°‘ï¼Œå„ªè³ªé¸æ“‡ã€‚' },
        'rice_noodle': { t: 'ğŸŸ¢ ç¶ ç‡ˆ', d: 'ä½æ°®æ¾±ç²‰ä»£è¡¨ï¼Œè£œå……ç†±é‡ä¸å‚·è…ã€‚' },
        'white_rice': { t: 'ğŸŸ¢ ç¶ ç‡ˆ', d: 'æ¯”ç³™ç±³ä½ç£·ï¼Œé©åˆæ™šæœŸè…å‹é£Ÿç”¨ã€‚' },
        'cabbage': { t: 'ğŸŸ¢ ç¶ ç‡ˆ', d: 'ä½é‰€è”¬èœï¼Œé©åˆé£Ÿç”¨ã€‚' },
        'apple': { t: 'ğŸŸ¢ ç¶ ç‡ˆ', d: 'ä½é‰€æ°´æœï¼Œå¯é©é‡é£Ÿç”¨ã€‚' },
        'olive_oil': { t: 'ğŸŸ¢ ç¶ ç‡ˆ', d: 'å„ªè³ªå¥½æ²¹ï¼Œè£œå……ç†±é‡ä¸”ä¿è­·è¡€ç®¡ã€‚' },
        'spinach': { t: 'ğŸŸ¡ é»ƒç‡ˆ', d: 'é«˜é‰€è”¬èœï¼Œå»ºè­°åˆ‡æ®µæ±†ç‡™è®“é‰€æµå¤±å¾Œå†åƒã€‚' },
        'brown_rice': { t: 'ğŸŸ¡ é»ƒç‡ˆ', d: 'é«˜ç£·é£Ÿç‰©ï¼ŒåˆæœŸå¯åƒï¼Œæ™šæœŸå»ºè­°æ”¹åƒç™½é£¯ã€‚' },
        'nuts': { t: 'ğŸŸ¡ é»ƒç‡ˆ', d: 'é›–è­·å¿ƒä½†ç£·é‰€çš†é«˜ã€‚ä¸€å¤©é™åˆ¶ 5 é¡†ã€‚' },
        'coffee': { t: 'ğŸŸ¡ é»ƒç‡ˆ', d: 'å«é‰€ä¸”åˆ©å°¿ï¼Œå»ºè­°æ¯æ—¥ä¸€æ¯ç‚ºé™ï¼Œä¸åŠ å¥¶ç²¾ã€‚' },
        'kiwi': { t: 'ğŸŸ¡ é»ƒç‡ˆ', d: 'é‰€å«é‡åé«˜ï¼Œéœ€è¦–ç•¶æ¬¡æŠ½è¡€å ±å‘Šé™é‡é£Ÿç”¨ã€‚' },
        'banana': { t: 'ğŸŸ¡ é»ƒç‡ˆ', d: 'é«˜é‰€æ°´æœä»£è¡¨ï¼Œè¡€é‰€ä¸ç©©è€…æ‡‰é¿å…ã€‚' },
        'starfruit': { t: 'ğŸ”´ ç´…ç‡ˆ', d: 'çµ•å°ç¦æ­¢ï¼å«ç¥ç¶“æ¯’ç´ ï¼Œè…å‹ç„¡æ³•ä»£è¬æè‡´æ˜è¿·ã€‚' },
        'processed_meat': { t: 'ğŸ”´ ç´…ç‡ˆ', d: 'é¦™è…¸ç«è…¿å«ã€Œç„¡æ©Ÿç£·ã€ï¼Œå¸æ”¶ç‡100%ï¼Œæ¥µå‚·è…ã€‚' },
        'organs': { t: 'ğŸ”´ ç´…ç‡ˆ', d: 'å…§è‡Ÿé¡é«˜æ¯’ç´ ã€é«˜è†½å›ºé†‡ã€é«˜ç£·ï¼Œæ‡‰ç¦é£Ÿã€‚' },
        'low_na_salt': { t: 'ğŸ”´ ç´…ç‡ˆ', d: 'ä½éˆ‰é¹½é€šå¸¸æ˜¯ã€Œä»¥é‰€ä»£éˆ‰ã€ï¼Œæ˜¯è‡´å‘½é«˜é‰€é¹½ã€‚' },
        'cola': { t: 'ğŸ”´ ç´…ç‡ˆ', d: 'ç¢³é…¸é£²æ–™å«å¤§é‡ç£·é…¸ï¼Œéš±å½¢æ®ºæ‰‹ã€‚' },
        'chicken_essence': { t: 'ğŸ”´ ç´…ç‡ˆ', d: 'æ¿ƒç¸®çš„é‰€é›¢å­èˆ‡æ™®æ—ï¼ŒåŠ é‡è…è‡Ÿè² æ“”ã€‚' },
        'instant_noodle': { t: 'ğŸ”´ ç´…ç‡ˆ', d: 'æ¹¯é ­é«˜éˆ‰ï¼Œéºµé«”å¸¸å«ç£·é…¸é¹½ã€‚' },
        'pastry': { t: 'ğŸ”´ ç´…ç‡ˆ', d: 'æ²¹æ¢éºµåŒ…å¸¸å«è†¨é¬†åŠ‘(é‹)ï¼Œæè‡´è…¦ç—…è®Šã€‚' }
    };

    const quizDB = [
        { q: "é—œæ–¼è…è‡Ÿç—…é£²é£Ÿï¼Œè¦æ”¹åƒã€Œè–„é¹½é†¬æ²¹ã€æˆ–ã€Œä½éˆ‰é¹½ã€å—ï¼Ÿ", a: [ {t:"å°ï¼Œå°‘é¹½å°±æ˜¯å¥½", c:false}, {t:"éŒ¯ï¼Œé‚£äº›é€šå¸¸æ˜¯é«˜é‰€ç”¢å“", c:true} ], exp: "ä½éˆ‰ç”¢å“å¸¸ä»¥ã€Œé‰€ã€å–ä»£éˆ‰ï¼Œå°è…å‹ä¾†èªªå¯èƒ½å°è‡´é«˜è¡€é‰€å¿ƒå¾‹ä¸æ•´ã€‚" },
        { q: "é—œæ–¼æ°´åˆ†æ”å–ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ", a: [ {t:"è…è‡Ÿç—…å®Œå…¨ä¸èƒ½å–æ°´", c:false}, {t:"æ²’æœ‰æ°´è…«ä¸‹ï¼Œæ‡‰é©é‡å–æ°´", c:true} ], exp: "é™¤éå·²é€ææˆ–åš´é‡æ°´è…«ï¼Œå¦å‰‡æ°´åˆ†ä¸è¶³æœƒæ¸›å°‘è…è‡Ÿè¡€æµï¼Œåè€Œå‚·è…ã€‚" },
        { q: "æ„Ÿå†’å…¨èº«ç— ç—›ï¼Œå¯ä»¥è‡ªå·±å»è²·ã€Œå¼·æ•ˆæ­¢ç—›è—¥ (NSAID)ã€å—ï¼Ÿ", a: [ {t:"çµ•å°ä¸å¯ï¼Œæœƒå‚·è…", c:true}, {t:"å¯ä»¥ï¼Œåªè¦ä¸åƒè¶…éä¸‰å¤©", c:false} ], exp: "NSAIDs æ˜¯å¸¸è¦‹å‚·è…è—¥ç‰©ï¼Œæœƒé€ æˆæ€¥æ€§è…æå‚·ã€‚è«‹æ”¹ç”¨æ™®æ‹¿ç–¼æˆ–è«®è©¢é†«å¸«ã€‚" },
        { q: "å°¿æ¶²æœ‰æ³¡æ³¡ï¼Œä¸€å®šå°±æ˜¯è…è‡Ÿå£æ‰äº†å—ï¼Ÿ", a: [ {t:"ä¸ä¸€å®šï¼Œéœ€æª¢é©—ç¢ºèª", c:true}, {t:"å°ï¼Œç«‹åˆ»æº–å‚™æ´—è…", c:false} ], exp: "è¡åŠ›å¤§æˆ–å°¿å¤ªæ¿ƒä¹Ÿæœƒæœ‰æ³¡æ³¡ã€‚è‹¥æ³¡æ³¡ã€Œ10åˆ†é˜ä¸æ•£ã€æ‰é«˜åº¦æ‡·ç–‘æ˜¯è›‹ç™½å°¿ã€‚" },
        { q: "é†«ç”Ÿé–‹çš„ã€Œéˆ£ç‰‡ã€å¥½å¤§é¡†ï¼Œæˆ‘ä¸æƒ³åƒå¯ä»¥å—ï¼Ÿ", a: [ {t:"å¯ä»¥ï¼Œé‚£æ˜¯è£œéª¨é ­çš„", c:false}, {t:"ä¸è¡Œï¼Œé‚£æ˜¯é™ç£·ç”¨çš„", c:true} ], exp: "è…å‹çš„éˆ£ç‰‡é€šå¸¸ä½œç‚ºã€Œç£·çµåˆåŠ‘ã€ï¼Œéœ€éš¨é¤å’¬ç¢æœç”¨ä»¥å¸é™„é£Ÿç‰©ä¸­çš„ç£·ã€‚" },
        { q: "æ¥Šæ¡ƒå¾ˆå¥½åƒï¼Œæˆ‘åªåƒã€Œä¸€å£ã€æ‡‰è©²æ²’é—œä¿‚å§ï¼Ÿ", a: [ {t:"çµ•å°ç¦æ­¢", c:true}, {t:"æ²’é—œä¿‚ï¼Œä¸è¦å–æ±å°±å¥½", c:false} ], exp: "æ¥Šæ¡ƒå«ç¥ç¶“æ¯’ç´ ï¼Œè…åŠŸèƒ½ä¸å…¨è€…ç„¡æ³•ä»£è¬ï¼Œåš´é‡æè‡´æ˜è¿·ã€‚" },
        { q: "SGLT2 æŠ‘åˆ¶åŠ‘ï¼ˆæ’ç³–è—¥ï¼‰é™¤äº†é™è¡€ç³–ï¼Œé‚„æœ‰ä»€éº¼åŠŸèƒ½ï¼Ÿ", a: [ {t:"ä¿è­·å¿ƒè‡Ÿèˆ‡å»¶ç·©è…æƒ¡åŒ–", c:true}, {t:"åªæœ‰é™è¡€ç³–", c:false} ], exp: "é€™æ˜¯åœ‹éš›æŒ‡å¼•æ¨è–¦çš„è­·è…è—¥ç‰©ï¼Œå³ä½¿ç„¡ç³–å°¿ç—…çš„è…å‹ä¹Ÿå¯èƒ½ä½¿ç”¨ã€‚" },
        { q: "è½èªªã€Œè…°å­ï¼ˆè…è‡Ÿï¼‰ã€ä»¥å½¢è£œå½¢ï¼Œè…ä¸å¥½è¦å¤šåƒè±¬è…°å­ï¼Ÿ", a: [ {t:"å°ï¼Œåƒè…è£œè…", c:false}, {t:"éŒ¯ï¼Œé‚£æ˜¯é«˜æ¯’ç´ é£Ÿç‰©", c:true} ], exp: "å…§è‡Ÿé¡å«æ¥µé«˜ç£·èˆ‡æ¯’ç´ ï¼Œåƒå¤šåè€ŒåŠ é€Ÿè…è¡°ç«­ã€‚" },
        { q: "ä¸€æ—¦é–‹å§‹æ´—è…ï¼ˆé€æï¼‰ï¼Œé€™è¼©å­å°±æ²’æ•‘äº†å—ï¼Ÿ", a: [ {t:"éŒ¯ï¼Œé€æä»å¯ç¶­æŒç”Ÿæ´»å“è³ª", c:true}, {t:"å°ï¼Œäººç”Ÿè®Šé»‘ç™½çš„", c:false} ], exp: "é€ææ˜¯å»¶çºŒç”Ÿå‘½çš„æ–¹å¼ï¼Œè¨±å¤šè…å‹ä»èƒ½å·¥ä½œã€æ—…éŠï¼Œæˆ–ç­‰å¾…è…è‡Ÿç§»æ¤ã€‚" },
        { q: "è…è‡Ÿä¸å¥½çš„äººï¼Œé‹å‹•æœƒè®“è…°æ›´ç— ï¼Œæ‰€ä»¥è¦å¤šèººè‘—ä¼‘æ¯ï¼Ÿ", a: [ {t:"å°ï¼Œèƒ½ä¸å‹•å°±ä¸å‹•", c:false}, {t:"éŒ¯ï¼Œé©åº¦é‹å‹•åè€Œè­·è…", c:true} ], exp: "è¦å¾‹é‹å‹•ï¼ˆå¦‚å¿«èµ°ï¼‰èƒ½æ§åˆ¶ä¸‰é«˜ï¼Œæ˜¯ä¿è­·è…è‡Ÿçš„é‡è¦ç”Ÿæ´»ç¿’æ…£ã€‚" }
    ];

    // --- Logic Functions ---

    function switchTab(tabId, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(el) el.classList.add('active');
        window.scrollTo(0,0);
    }

    // â­ Master Update Function (Triggered by Select Change)
    function updateAll() {
        const egfrSelect = document.getElementById('egfr-input');
        const egfrVal = egfrSelect.value;
        const egfrText = egfrSelect.options[egfrSelect.selectedIndex].text;
        const albumin = document.getElementById('albumin-input').value;
        
        // å¦‚æœé‚„æ²’é¸ï¼Œå°±ä¸å‹•ä½œ
        if (egfrVal === "") return;

        // 1. Update Home Risk Matrix
        updateRiskDisplay(parseFloat(egfrVal), egfrText, albumin);
        
        // 2. Update Meds Tab
        updateMedAdvice(parseFloat(egfrVal));
        
        // 3. Update Diet Tab
        updateDietAdvice(parseFloat(egfrVal));
    }

    function updateRiskDisplay(egfr, egfrText, albumin) {
        const resultBox = document.getElementById('risk-display');
        const adviceBox = document.getElementById('home-advice');
        document.querySelectorAll('.matrix-cell').forEach(c => c.classList.remove('active-cell'));
        
        resultBox.classList.remove('hidden');
        adviceBox.classList.remove('hidden');

        let stage = "", rowId = "";
        if (egfr >= 90) { stage = "ç¬¬1æœŸ"; rowId = "1"; }
        else if (egfr >= 60) { stage = "ç¬¬2æœŸ"; rowId = "2"; }
        else if (egfr >= 45) { stage = "ç¬¬3aæœŸ"; rowId = "3a"; }
        else if (egfr >= 30) { stage = "ç¬¬3bæœŸ"; rowId = "3b"; }
        else if (egfr >= 15) { stage = "ç¬¬4æœŸ"; rowId = "4"; }
        else { stage = "ç¬¬5æœŸ"; rowId = "5"; }

        let albText = "", colId = "";
        if (albumin === 'A1') { albText = "æ­£å¸¸/è¼•å¾®è›‹ç™½å°¿"; colId = "1"; }
        else if (albumin === 'A2') { albText = "å¾®é‡è›‹ç™½å°¿"; colId = "2"; }
        else { albText = "åš´é‡è›‹ç™½å°¿"; colId = "3"; }

        const targetCellId = `cell-${rowId}-${colId}`;
        const targetCell = document.getElementById(targetCellId);
        if(targetCell) targetCell.classList.add('active-cell');

        let riskColor = "";
        if (targetCell.classList.contains('bg-g')) { riskColor = "var(--risk-g)"; }
        else if (targetCell.classList.contains('bg-y')) { riskColor = "var(--risk-y)"; }
        else if (targetCell.classList.contains('bg-o')) { riskColor = "var(--risk-o)"; }
        else { riskColor = "var(--risk-r)"; }

        document.getElementById('res-risk-text').innerText = targetCell.classList.contains('bg-g') ? "ä½é¢¨éšª" : (targetCell.classList.contains('bg-y') ? "ä¸­åº¦é¢¨éšª" : (targetCell.classList.contains('bg-o') ? "é«˜é¢¨éšª" : "è¶…é«˜é¢¨éšª"));
        document.getElementById('res-risk-text').style.backgroundColor = riskColor;
        // é»ƒè‰²èƒŒæ™¯æ™‚æ–‡å­—æ”¹æ·±è‰²
        document.getElementById('res-risk-text').style.color = (riskColor == "var(--risk-y)") ? "#333" : "white";
        
        document.getElementById('res-detail-text').innerText = `è…çµ²çƒéæ¿¾ç‡${stage} èˆ‡ ${albText}`;
        document.getElementById('res-value-text').innerHTML = `å€é–“ï¼š<strong style="color:${riskColor}; text-shadow:0 0 1px #999;">${egfrText}</strong>`;

        const a1 = document.getElementById('advice-1'); const a2 = document.getElementById('advice-2'); const a3 = document.getElementById('advice-3');
        if (egfr >= 60 && albumin === 'A1') { a1.innerText = "ç¶­æŒå¥åº·ç”Ÿæ´»ï¼Œæ¯å¹´å®šæœŸæª¢æŸ¥å³å¯ã€‚"; a2.innerText = "é£²é£Ÿå‡è¡¡ï¼Œä¸éœ€éåº¦é™åˆ¶è›‹ç™½è³ªã€‚"; a3.innerText = "é¿å…é•·æœŸä½¿ç”¨æ­¢ç—›è—¥ (NSAIDs) èˆ‡ä¾†è·¯ä¸æ˜ä¸­è‰è—¥ã€‚"; }
        else if (egfr < 45 || albumin === 'A3') { a1.innerText = "å±¬æ–¼é«˜é¢¨éšªç¾¤ï¼Œè«‹åš´æ ¼æ§åˆ¶è¡€å£“èˆ‡è¡€ç³–ã€‚"; a2.innerText = "ä½è›‹ç™½é£²é£Ÿ (0.6-0.8 g/kg)ï¼Œé¿å…åŠ å·¥é£Ÿå“ã€‚"; a3.innerText = "è«®è©¢é†«å¸«æ˜¯å¦ä½¿ç”¨ SGLT2 æ’ç³–è—¥æˆ– ACEi/ARB ä¿è­·å¿ƒè…ã€‚"; }
        else { a1.innerText = "æ¯ 3-6 å€‹æœˆè¿½è¹¤ä¸€æ¬¡è…åŠŸèƒ½ã€‚"; a2.innerText = "æ³¨æ„è¡€å£“æ§åˆ¶ (<130/80)ï¼Œæ¸›å°‘é¹½åˆ†æ”å–ã€‚"; a3.innerText = "è‹¥æœ‰ç³–å°¿ç—…ï¼Œå‹™å¿…åš´æ ¼æ§ç³–ã€‚"; }
    }

    // ğŸ’Š Generate Med Advice
    function updateMedAdvice(egfr) {
        document.getElementById('med-placeholder').classList.add('hidden');
        document.getElementById('med-advice-container').classList.remove('hidden');
        document.getElementById('med-egfr-display').innerText = document.getElementById('egfr-input').options[document.getElementById('egfr-input').selectedIndex].text;

        const green = document.getElementById('med-list-green');
        const yellow = document.getElementById('med-list-yellow');
        const red = document.getElementById('med-list-red');
        green.innerHTML = ''; yellow.innerHTML = ''; red.innerHTML = '';

        function add(list, name, desc) {
            list.innerHTML += `<div class="list-item"><span class="list-name">${name}</span><span class="list-effect">${desc}</span></div>`;
        }

        // Green
        add(green, "ACEi / ARB (è¡€å£“è—¥)", "é™ä½è›‹ç™½å°¿ï¼Œå»¶ç·©è…è‡Ÿæƒ¡åŒ–é¦–é¸ã€‚");
        add(green, "SGLT2 æŠ‘åˆ¶åŠ‘ (æ’ç³–è—¥)", "åœ‹éš›å¼·æ¨ï¼Œä¿è­·å¿ƒè‡Ÿèˆ‡è…è‡Ÿçš„ç¥è—¥ã€‚");
        add(green, "Statins (é™è¡€è„‚è—¥)", "ä¿è­·è¡€ç®¡å¥åº·ï¼Œé é˜²ä¸­é¢¨å¿ƒè‚Œæ¢—å¡ã€‚");

        // Yellow (Universal)
        add(yellow, "Diuretics (åˆ©å°¿åŠ‘)", "è‹¥æœ‰æ‹‰è‚šå­æˆ–å˜”åè„«æ°´ï¼Œéœ€å…ˆåœè—¥ã€‚");
        add(yellow, "æŠ—ç”Ÿç´  (Antibiotics)", "éƒ¨åˆ†éœ€ä¾ç…§è…åŠŸèƒ½èª¿æ•´åŠ‘é‡ã€‚");

        // Red (Universal)
        add(red, "NSAIDs (å¼·æ•ˆæ­¢ç—›è—¥)", "å‚·è…å¤§åœ°é›·ï¼æ˜“é€ æˆæ€¥æ€§è…è¡°ç«­ã€‚");
        add(red, "ä¾†è·¯ä¸æ˜ä¸­è‰è—¥", "å¯èƒ½å«é‡é‡‘å±¬æˆ–é¦¬å…œéˆ´é…¸ï¼Œçµ•å°ç¦æ­¢ã€‚");
        add(red, "å«ç¢˜é¡¯å½±åŠ‘ (CTæª¢æŸ¥)", "æª¢æŸ¥å‰è«‹å‹™å¿…å‘ŠçŸ¥é†«å¸«ï¼Œæª¢æŸ¥å¾Œå¤šå–æ°´ã€‚");

        // Dynamic Metformin
        if (egfr < 30) {
            add(red, "Metformin (é™ç³–è—¥)", "eGFR < 30 æ™‚ç¦æ­¢ä½¿ç”¨ï¼Œä¹³é…¸ä¸­æ¯’é¢¨éšªé«˜ã€‚");
        } else if (egfr < 45) {
            add(yellow, "Metformin (é™ç³–è—¥)", "eGFR 30-45 æ™‚éœ€æ¸›é‡ä½¿ç”¨ä¸¦ç›£æ¸¬ã€‚");
        }
    }

    // ğŸ½ï¸ Generate Diet Advice (New Personalization)
    function updateDietAdvice(egfr) {
        document.getElementById('diet-placeholder').classList.add('hidden');
        document.getElementById('diet-advice-container').classList.remove('hidden');

        const green = document.getElementById('diet-list-green');
        const yellow = document.getElementById('diet-list-yellow');
        const red = document.getElementById('diet-list-red');
        green.innerHTML = ''; yellow.innerHTML = ''; red.innerHTML = '';

        function add(list, name, desc) {
            list.innerHTML += `<div class="list-item"><span class="list-name">${name}</span><span class="list-effect">${desc}</span></div>`;
        }

        // åŸºç¤å»ºè­° (æ‰€æœ‰äººéƒ½é©ç”¨)
        add(green, "å„ªè³ªè›‹ç™½è³ª (è±†é­šè›‹è‚‰)", "é›è›‹ã€è±†è…ã€é­šè‚‰å¸æ”¶ç‡é«˜ï¼Œç”¢ç”Ÿå»¢ç‰©å°‘ã€‚");
        add(green, "å¤©ç„¶å¥½æ²¹", "æ©„æ¬–æ²¹ã€è‹¦èŒ¶æ²¹ï¼Œè£œå……ç†±é‡ä¸å‚·è…ã€‚");
        add(red, "æ¥Šæ¡ƒ (Starfruit)", "ç¥ç¶“æ¯’ç´ ç„¡æ³•ä»£è¬ï¼Œåš´é‡æœƒæŠ½ææ˜è¿·ï¼Œçµ•å°ç¦æ­¢ã€‚");
        add(red, "åŠ å·¥è‚‰å“ (é¦™è…¸/ç«è…¿)", "å«é«˜é‡ç„¡æ©Ÿç£·ï¼Œå¸æ”¶ç‡100%ï¼Œæ¥µå‚·è¡€ç®¡èˆ‡éª¨é ­ã€‚");

        // ä¾æ“š eGFR èª¿æ•´
        if (egfr < 45) {
            // ä¸­é‡åº¦ CKDï¼šåš´æ ¼é™ç£·é‰€
            add(green, "ä½æ°®æ¾±ç²‰ (å†¬ç²‰/ç±³ç²‰)", "è£œå……ç†±é‡ä¸”ä¸ç”¢ç”Ÿå°¿æ¯’ç´ ï¼Œå¯å–ä»£éƒ¨åˆ†ç±³é£¯ã€‚");
            add(yellow, "ç³™ç±³/äº”ç©€ç±³/ç‡•éº¥", "é›–ç„¶å¥åº·ä½†ã€Œç£·ã€å«é‡é«˜ï¼Œæ™šæœŸè…ç—…å»ºè­°æ”¹åƒç™½é£¯ã€‚");
            add(yellow, "æ·±ç¶ è‰²è”¬èœ (è èœ/åœ°ç“œè‘‰)", "é‰€é›¢å­é«˜ï¼Œå‹™å¿…ã€Œæ±†ç‡™ã€éè®“é‰€æµå¤±å†åƒã€‚");
            add(yellow, "å …æœé¡", "ç£·é‰€é›™é«˜ï¼Œä¸€å¤©é™åˆ¶ 5 é¡†æˆ–é¿å…ã€‚");
            add(red, "ä½éˆ‰é¹½/è–„é¹½é†¬æ²¹", "é€šå¸¸æ˜¯ã€Œä»¥é‰€ä»£éˆ‰ã€ï¼Œå°æ’é‰€å·®çš„æ‚¨æ˜¯è‡´å‘½æ¯’è—¥ã€‚");
        } else {
            // åˆæœŸ CKDï¼šå‡è¡¡é£²é£Ÿç‚ºä¸»
            add(green, "å¤šæ¨£åŒ–è”¬èœæ°´æœ", "ä¿æŒæ’ä¾¿é †æš¢ï¼Œæ¸›å°‘æ¯’ç´ ç´¯ç©ã€‚");
            add(yellow, "éé¹¹çš„é£Ÿç‰©", "é¹½åˆ†æœƒå‡é«˜è¡€å£“ï¼Œé–“æ¥å‚·å®³è…è‡Ÿã€‚");
            add(yellow, "å«ç³–é£²æ–™", "å®¹æ˜“å°è‡´è‚¥èƒ–èˆ‡ç—›é¢¨ï¼Œå¢åŠ è…è‡Ÿè² æ“”ã€‚");
        }
    }

    // Lookup Tool
    function checkFood() {
        const val = document.getElementById('food-select').value;
        const res = document.getElementById('food-result');
        res.classList.add('hidden');
        if(!val) return;

        const data = foodLookupDB[val];
        res.classList.remove('hidden');
        res.innerHTML = `<strong>${data.t}</strong><br>${data.d}`;
        
        if (data.t.includes("ç´…ç‡ˆ")) { res.style.borderColor = "var(--danger)"; res.style.background = "#fff5f5"; res.style.color = "#721c24"; }
        else if (data.t.includes("é»ƒç‡ˆ")) { res.style.borderColor = "var(--warning)"; res.style.background = "#fffbf0"; res.style.color = "#856404"; }
        else { res.style.borderColor = "var(--success)"; res.style.background = "#e6fffa"; res.style.color = "#155724"; }
    }

    // Quiz
    let currentQ = 0, score = 0;
    function initQuiz() { currentQ = 0; score = 0; document.getElementById('quiz-score-area').classList.add('hidden'); document.getElementById('quiz-area').classList.remove('hidden'); document.getElementById('quiz-progress').style.width = '0%'; renderQuestion(); }
    function renderQuestion() {
        const qData = quizDB[currentQ];
        document.getElementById('quiz-question').innerText = `Q${currentQ+1}. ${qData.q}`;
        document.getElementById('quiz-counter').innerText = `Q${currentQ+1} / ${quizDB.length}`;
        document.getElementById('quiz-progress').style.width = `${((currentQ)/quizDB.length)*100}%`;
        const optsDiv = document.getElementById('quiz-options');
        optsDiv.innerHTML = '';
        document.getElementById('quiz-feedback-box').classList.add('hidden');
        qData.a.forEach(opt => {
            const btn = document.createElement('div'); btn.className = 'quiz-option'; btn.innerText = opt.t; btn.onclick = () => checkAnswer(btn, opt.c); optsDiv.appendChild(btn);
        });
    }
    function checkAnswer(btn, isCorrect) {
        document.querySelectorAll('.quiz-option').forEach(b => b.style.pointerEvents = 'none');
        if (isCorrect) { btn.classList.add('correct'); score += 10; document.getElementById('quiz-feedback-text').innerText = "ğŸ‰ ç­”å°äº†ï¼"; document.getElementById('quiz-feedback-text').style.color = "var(--success)"; }
        else { btn.classList.add('wrong'); document.getElementById('quiz-feedback-text').innerText = "ğŸ˜± ç­”éŒ¯å›‰ï¼"; document.getElementById('quiz-feedback-text').style.color = "var(--danger)"; }
        document.getElementById('quiz-feedback-box').classList.remove('hidden');
        document.getElementById('quiz-explanation').innerText = quizDB[currentQ].exp;
    }
    function nextQuestion() { currentQ++; if (currentQ < quizDB.length) renderQuestion(); else showScore(); }
    function showScore() {
        document.getElementById('quiz-area').classList.add('hidden'); document.getElementById('quiz-feedback-box').classList.add('hidden');
        document.getElementById('quiz-score-area').classList.remove('hidden');
        document.getElementById('final-score').innerText = score;
        document.getElementById('quiz-progress').style.width = '100%';
        document.getElementById('score-comment').innerText = score===100 ? "ğŸ† å¤ªå¼·äº†ï¼ä½ æ˜¯è­·è…é”äººï¼" : score>=60 ? "ğŸ‘ å¾ˆä¸éŒ¯ï¼Œç¹¼çºŒä¿æŒï¼" : "ğŸ’ª åŠ æ²¹ï¼Œå¤šçœ‹å¹¾æ¬¡è¡›æ•™è³‡è¨Šå–”ï¼";
    }
    function restartQuiz() { initQuiz(); }
    initQuiz();
</script>
</body>
</html>
