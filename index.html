<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¿è…è­·å¿ƒåŠ©ç†</title>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <style>
        :root {
            --primary: #009045; --primary-dark: #007035; --accent: #F58220;
            --heart: #e91e63; --heart-light: #fce4ec; 
            --bg: #fdfdfd; --white: #ffffff; --text: #222;
            --risk-g: #6bbd45; --risk-y: #ffd700; --risk-o: #f58220; --risk-r: #e03e2e;
            --nav-height: 85px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background: var(--bg); margin: 0; padding: 0; padding-bottom: calc(var(--nav-height) + 20px); 
            color: var(--text); font-size: 19px; line-height: 1.5; user-select: none; 
        }
        
        /* Header */
        header { 
            background: var(--white); padding: 12px 15px; border-radius: 0 0 25px 25px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        header::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 6px;
            background: linear-gradient(90deg, var(--primary) 30%, var(--heart) 70%);
        }
        .header-logo { height: 50px; width: auto; object-fit: contain; }
        header img.header-logo:first-of-type { height: 38px; }
        .header-title-box { text-align: center; flex: 1; padding: 0 5px; }
        .header-title-box h1 { margin: 0; font-size: 1.6rem; color: #333; font-weight: 900; line-height: 1.1; }
        .header-title-box p { margin: 3px 0 0 0; color: #666; font-size: 0.8rem; font-weight: bold; }
        
        /* Language Switcher */
        .lang-select {
            padding: 5px; border: 1px solid #ddd; border-radius: 10px; font-size: 0.8rem; background: #fff;
        }

        /* Container & Cards */
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--white); border-radius: 20px; padding: 25px 20px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; border: 1px solid #eee; }
        .card h2 { margin-top: 0; color: var(--primary); font-size: 1.5rem; font-weight: 900; border-bottom: 3px solid #f0f4f8; padding-bottom: 15px; margin-bottom: 20px; }

        /* Inputs & Buttons UI */
        .input-group { margin-bottom: 25px; text-align: left; }
        .input-group label { display: block; font-size: 1.1rem; color: #444; margin-bottom: 8px; font-weight: 900; }
        
        .select-wrapper { position: relative; width: 100%; }
        select { 
            width: 100%; padding: 18px; border: 2px solid #ccc; border-radius: 15px; 
            font-size: 1.1rem; background: #fff; outline: none; font-weight: bold; color: #222;
            -webkit-appearance: none; appearance: none; cursor: pointer;
        }
        .select-wrapper::after { 
            content: 'â–¼'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); 
            color: #444; pointer-events: none; font-size: 1.2rem; 
        }
        select:focus { border-color: var(--primary); background: #f9fff9; }
        
        input[type="number"] {
            width: 100%; padding: 18px; border: 2px solid #ccc; border-radius: 15px; 
            font-size: 1.2rem; outline: none; font-weight: bold; color: #222;
        }

        /* Pill Buttons */
        .option-group { display: flex; gap: 10px; width: 100%; }
        .option-btn {
            flex: 1; padding: 15px 5px; 
            border: 2px solid #ddd; border-radius: 15px;
            background: #fff; color: #666;
            font-size: 1.0rem; font-weight: 900;
            text-align: center; cursor: pointer;
            transition: all 0.2s; user-select: none;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
        }
        .option-btn.active {
            border-color: var(--primary); background-color: #e8f5e9;
            color: var(--primary); box-shadow: 0 4px 10px rgba(0, 144, 69, 0.2);
            transform: scale(1.02);
        }
        #group-hf .option-btn.active {
            border-color: var(--heart); background-color: var(--heart-light);
            color: var(--heart); box-shadow: 0 4px 10px rgba(233, 30, 99, 0.2);
        }

        /* Buttons (General) */
        .btn { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; 
            border: none; padding: 18px; width: 100%; border-radius: 18px; 
            font-size: 1.3rem; font-weight: 900; cursor: pointer; 
            box-shadow: 0 6px 15px rgba(0,144,69,0.3); display: flex; align-items: center; justify-content: center; 
            text-decoration: none; margin-bottom: 15px; transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.97); }
        .btn-outline { background: #fff; border: 3px solid var(--primary); color: var(--primary); box-shadow: none; }
        .btn-line { background: #06c755; box-shadow: 0 6px 15px rgba(6,199,85,0.3); }
        .btn-refill { background: linear-gradient(135deg, var(--accent), #e07010); box-shadow: 0 6px 15px rgba(245,130,32,0.3); }
        .btn-next { background: linear-gradient(135deg, var(--accent), #e07010); margin-top: 20px; box-shadow: 0 6px 15px rgba(245,130,32,0.3); }

        /* Risk Matrix */
        .risk-matrix { display: grid; grid-template-columns: 60px 1fr 1fr 1fr; gap: 3px; margin: 25px auto; background: #fff; font-size: 0.9rem; }
        .matrix-cell { display: flex; align-items: center; justify-content: center; text-align: center; padding: 2px; border-radius: 6px; font-weight: bold; color: rgba(0,0,0,0.3); height: 55px; position: relative; }
        .matrix-header { background: #f4f4f4; color: #444; font-weight: 900; font-size: 0.85rem; padding: 5px 0; }
        .matrix-label { background: #f4f4f4; color: #444; font-weight: 900; font-size: 0.8rem; flex-direction: column; justify-content: center; display: flex; align-items: center; }
        .bg-g { background-color: var(--risk-g); } .bg-y { background-color: var(--risk-y); } .bg-o { background-color: var(--risk-o); } .bg-r { background-color: var(--risk-r); }
        .matrix-cell.active-cell { border: 4px solid #0044cc; box-shadow: 0 0 15px rgba(0,68,204,0.6); z-index: 10; transform: scale(1.1); }

        .risk-banner { padding: 20px; margin-top: 25px; border-radius: 15px; color: white; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); animation: fadeIn 0.3s ease; }
        .risk-banner h3 { margin: 0; font-size: 1.8rem; font-weight: 900; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .risk-banner p { margin: 5px 0 0; font-size: 1.1rem; font-weight: bold; opacity: 0.95; }

        /* List Cards */
        .list-card { text-align: left; margin-bottom: 25px; border-radius: 15px; overflow: hidden; border: 2px solid #ddd; }
        .list-head { padding: 18px; font-weight: 900; color: white; font-size: 1.3rem; }
        .list-body { padding: 25px; font-size: 1.15rem; line-height: 1.6; background: #fff; }
        .list-item { margin-bottom: 15px; border-bottom: 2px dashed #ccc; padding-bottom: 15px; }
        .list-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .list-title { font-weight: 900; display: block; color: #000; font-size: 1.25rem; }
        
        /* Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; justify-content: space-around; align-items: center; border-top: 2px solid #ccc; z-index: 1000; }
        .nav-item { text-align: center; color: #999; font-size: 0.85rem; flex: 1; padding: 5px; cursor: pointer; font-weight: 900; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active .nav-icon { transform: scale(1.15); color: var(--primary); }
        .nav-icon { font-size: 1.8rem; display: block; margin-bottom: 4px; }

        .hidden { display: none !important; }
        
        .page-counter { text-align: center; font-size: 1.2rem; color: #555; margin: 20px 0; font-weight: 900; }

        /* Quiz */
        .quiz-option { background: #fff; border: 3px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 15px; font-size: 1.2rem; font-weight: 900; color: #444; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.05); transition: 0.2s; position: relative; text-align: left; }
        .quiz-option:active { transform: scale(0.98); background: #f9f9f9; }
        .quiz-option.correct { border-color: #6bbd45; background: #f0fff4; color: #2e7d32; }
        .quiz-option.correct::after { content: 'âœ…'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 1.5rem; }
        .quiz-option.wrong { border-color: #e03e2e; background: #fff5f5; color: #c62828; }
        .quiz-option.wrong::after { content: 'âŒ'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 1.5rem; }
        .progress-bar { width: 100%; height: 12px; background: #eee; border-radius: 6px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }

        /* Others */
        .qr-box { width: 220px; height: 220px; margin: 20px auto; border: 2px solid #eee; border-radius: 20px; }
        .qr-img { width: 100%; height: 100%; object-fit: contain; }
        .traffic-container { display: flex; justify-content: center; gap: 20px; margin: 25px 0; }
        .light { width: 70px; height: 70px; border-radius: 50%; background: #ddd; opacity: 0.2; transition: 0.3s; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        .light.on { opacity: 1; transform: scale(1.1); box-shadow: 0 0 20px currentColor; }
        .med-result-box { background: #e8f5e9; padding: 20px; border-radius: 15px; margin-top: 20px; text-align: left; border-left: 8px solid var(--primary); animation: fadeIn 0.3s ease; }
        .kfre-highlight-label { font-size: 1.1rem; color: #555; font-weight: 900; margin-bottom: 5px; display: block; }
        .kfre-highlight-value { font-size: 2.5rem; font-weight: 900; color: #0277bd; display: block; line-height: 1.2; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        
        /* Equip Slots */
        .equip-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
        .equip-slot { background: #fff; border: 3px dashed #ccc; border-radius: 15px; padding: 15px 10px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative; user-select: none; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 140px; }
        .equip-slot:active { transform: scale(0.95); }

        .slot-legendary { border-color: #FF8C00; background-color: #FFF8E1; } .slot-legendary .equip-name { color: #E65100; }
        .slot-epic { border-color: #9C27B0; background-color: #F3E5F5; } .slot-epic .equip-name { color: #4A148C; }
        .slot-rare { border-color: #2196F3; background-color: #E3F2FD; } .slot-rare .equip-name { color: #0D47A1; }
        .slot-uncommon { border-color: #4CAF50; background-color: #E8F5E9; } .slot-uncommon .equip-name { color: #1B5E20; }
        .slot-arcane { border-color: #00BCD4; background-color: #E0F7FA; } .slot-arcane .equip-name { color: #006064; }
        .slot-heart { border-color: var(--heart); background-color: var(--heart-light); } .slot-heart .equip-name { color: #c2185b; }

        .equip-slot.equipped { border-style: solid; border-width: 4px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); background: #fff; }
        .equip-slot.equipped::after { content: attr(data-equipped-text); position: absolute; top: -12px; right: -5px; color: white; font-size: 0.8rem; padding: 3px 8px; border-radius: 10px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2); background: #555; }
        .slot-legendary.equipped::after { background: #FF8C00; }
        .slot-epic.equipped::after { background: #9C27B0; }
        .slot-rare.equipped::after { background: #2196F3; }
        .slot-uncommon.equipped::after { background: #4CAF50; }
        .slot-arcane.equipped::after { background: #00BCD4; }
        .slot-heart.equipped::after { background: var(--heart); }

        .equip-name { font-size: 1.1rem; font-weight: 900; margin-top: 5px; display: block; }
        .equip-desc { font-size: 0.85rem; color: #666; display: block; margin-top: 2px; }
        .hidden-checkbox { display: none; }
        
        .status-panel { display: flex; align-items: center; padding: 20px; border-radius: 15px; margin-bottom: 30px; color: white; transition: all 0.5s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .status-icon { font-size: 3.5rem; margin-right: 20px; }
        .status-title { font-size: 2rem; font-weight: 900; margin-bottom: 5px; }
        .status-msg { font-size: 1.1rem; opacity: 0.9; }
        .status-novice { background: linear-gradient(135deg, #757F9A, #D7DDE8); color: #333; }
        .status-apprentice { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .status-veteran { background: linear-gradient(135deg, #2193b0, #6dd5ed); }
        .status-elite { background: linear-gradient(135deg, #834d9b, #d04ed6); }
        .status-guardian { background: linear-gradient(135deg, #F2994A, #F2C94C); box-shadow: 0 0 20px #F2C94C; }
        .status-god { background: linear-gradient(135deg, #FF416C, #FF4B2B); box-shadow: 0 0 20px #FF4B2B; }
        
        .symptom-box { background: #fff5f8; border: 2px dashed #f8bbd0; border-radius: 15px; padding: 15px; margin-top: 15px; }
        .sym-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; color: #880e4f; font-weight: bold; }
        .sym-check { transform: scale(1.5); }
        
        .help-icon { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; background: #2196f3; color: white; border-radius: 50%; font-size: 0.9rem; margin-left: 8px; cursor: pointer; vertical-align: middle; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); align-items: center; justify-content: center; }
        .modal-content { background-color: #fff; padding: 25px; width: 90%; max-width: 500px; border-radius: 15px; position: relative; animation: fadeIn 0.3s; max-height: 90vh; overflow-y: auto; }
        .close-modal { position: absolute; top: 10px; right: 15px; font-size: 2rem; color: #999; cursor: pointer; background: none; border: none; }
        .guide-box { background: #fff; border-radius: 18px; padding: 20px 15px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 1px solid #f0f0f0; }
        .guide-title { margin: 0 0 15px 0; font-weight: 900; color: #444; font-size: 1.2rem; text-align: center; letter-spacing: 1px; }
        .guide-row { display: flex; align-items: flex-start; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #eee; }
        .guide-row:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
        .guide-icon { flex: 0 0 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 1.8rem; margin-right: 15px; background: #f9f9f9; }
        .guide-text { flex: 1; }
        .guide-head { font-size: 1.1rem; font-weight: 900; margin-bottom: 4px; display: block; }
        .guide-desc { font-size: 1rem; color: #666; line-height: 1.5; text-align: justify; }
        .icon-g { background: #e8f5e9; color: var(--risk-g); box-shadow: 0 2px 5px rgba(107, 189, 69, 0.2); } .text-g { color: var(--risk-g); }
        .icon-y { background: #fffde7; color: #fbc02d; box-shadow: 0 2px 5px rgba(251, 192, 45, 0.2); } .text-y { color: #fbc02d; }
        .icon-r { background: #ffebee; color: var(--risk-r); box-shadow: 0 2px 5px rgba(224, 62, 46, 0.2); } .text-r { color: var(--risk-r); }
    </style>
</head>
<body>

<header>
    <img src="logo_left.png" alt="Logo" class="header-logo" onerror="this.style.opacity='0.2'">
    <div class="header-title-box">
        <h1 data-i18n="app.title" style="color:var(--primary);">ä¿è…è­·å¿ƒåŠ©ç†</h1>
        <p data-i18n="app.subtitle">å¿ƒ/è…/ç³– æ™ºæ…§ç…§è­·</p>
    </div>
    <div style="text-align: right;">
        <select id="lang-switch" class="lang-select" onchange="changeLang(this.value)">
            <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡</option>
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        </select>
    </div>
</header>

<div class="container">

    <div id="tab-home" class="section active">
        <div class="card" style="border-top: 5px solid #29b6f6;">
            <h2 data-i18n="home.risk_title" style="color:#0277bd; border-bottom-color:#e1f5fe;">ğŸ“Š é¢¨éšªè©•ä¼°èˆ‡è¨­å®š</h2>
            <p data-i18n="home.risk_desc" style="color:#666; font-size:0.95rem; margin-bottom:20px; text-align:left; padding:0 10px;">
                è«‹è¼¸å…¥æ‚¨çš„åŸºæœ¬è³‡æ–™ï¼Œç³»çµ±å°‡ä¾æ“šæ‚¨çš„ç‹€æ³ (æ…¢æ€§è…è¡°ç«­ / ç³–å°¿ç—… / å¿ƒè¡°ç«­) æä¾›å€‹äººåŒ–çš„ç”¨è—¥èˆ‡é£²é£Ÿå»ºè­°ã€‚
            </p>
            <div style="text-align:right; margin-bottom:10px;">
                <button onclick="clearUserData()" style="background:#f5f5f5; border:1px solid #ddd; color:#666; padding:6px 12px; border-radius:20px; font-size:0.85rem; cursor:pointer; font-weight:bold;">
                    <span data-i18n="btn.clear">ğŸ—‘ï¸ æ¸…é™¤ç´€éŒ„ / é‡è¨­</span>
                </button>
            </div>

            <div class="input-group">
                <label data-i18n="label.age">1. å¹´é½¡</label>
                <div class="select-wrapper">
                    <select id="kfre-age" onchange="updateAllRisks()">
                        <option value="" disabled selected data-i18n="opt.select_age">è«‹é¸æ“‡å¹´é½¡...</option>
                        <option value="20">20-29</option><option value="30">30-39</option><option value="40">40-49</option><option value="50">50-59</option><option value="60">60-69</option><option value="70">70-79</option><option value="80">80-89</option><option value="90">90+</option>
                    </select>
                </div>
            </div>

            <div class="input-group"><label data-i18n="label.sex">2. æ€§åˆ¥</label>
                <div class="option-group" id="group-sex">
                    <div class="option-btn" onclick="setOption('kfre-sex', '1', this)" data-i18n="opt.male">ç”·</div>
                    <div class="option-btn" onclick="setOption('kfre-sex', '0', this)" data-i18n="opt.female">å¥³</div>
                </div>
                <input type="hidden" id="kfre-sex" onchange="updateAllRisks()">
            </div>
            
            <div class="input-group">
                <label>
                    <span data-i18n="label.egfr">3. è…çµ²çƒéæ¿¾ç‡ (eGFR)</span> 
                    <span class="help-icon" onclick="showHelp('egfr')">?</span>
                </label>
                <div class="select-wrapper">
                    <select id="kfre-egfr" onchange="updateAllRisks()">
                        <option value="" disabled selected data-i18n="opt.select_val">è«‹é¸æ“‡æ•¸å€¼å€é–“...</option>
                        <option value="90" data-i18n="opt.egfr_1">æ­£å¸¸ (eGFR â‰¥ 90)</option>
                        <option value="75" data-i18n="opt.egfr_2">ç¬¬2æœŸ (eGFR 60-89)</option>
                        <option value="52" data-i18n="opt.egfr_3a">ç¬¬3aæœŸ (eGFR 45-59)</option>
                        <option value="37" data-i18n="opt.egfr_3b">ç¬¬3bæœŸ (eGFR 30-44)</option>
                        <option value="22" data-i18n="opt.egfr_4">ç¬¬4æœŸ (eGFR 15-29)</option>
                        <option value="10" data-i18n="opt.egfr_5">ç¬¬5æœŸ (eGFR < 15)</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>
                    <span data-i18n="label.uacr">4. è›‹ç™½å°¿ç‹€æ³ (UACR)</span>
                    <span class="help-icon" onclick="showHelp('uacr')">?</span>
                </label>
                <div class="option-group" id="group-uacr">
                    <div class="option-btn active" onclick="setOption('kfre-uacr', '10', this)" data-i18n="opt.uacr_norm">æ­£å¸¸<br>&lt;30</div>
                    <div class="option-btn" onclick="setOption('kfre-uacr', '150', this)" data-i18n="opt.uacr_micro">å¾®é‡<br>30-300</div>
                    <div class="option-btn" onclick="setOption('kfre-uacr', '500', this)" data-i18n="opt.uacr_macro">åš´é‡<br>&gt;300</div>
                </div>
                <input type="hidden" id="kfre-uacr" value="10" onchange="updateAllRisks()">
            </div>

            <div class="input-group"><label data-i18n="label.dm">5. æ˜¯å¦æœ‰ç³–å°¿ç—… (DM)</label>
                <div class="option-group" id="group-dm">
                    <div class="option-btn" onclick="setOption('kfre-dm', '0', this)" data-i18n="opt.no">ç„¡</div>
                    <div class="option-btn" onclick="setOption('kfre-dm', '1', this)" data-i18n="opt.yes">æœ‰</div>
                </div>
                <input type="hidden" id="kfre-dm" value="" onchange="updateAllRisks()">
            </div>

            <div class="input-group"><label data-i18n="label.hf">6. æ˜¯å¦æœ‰å¿ƒè¡°ç«­ (HF)</label>
                <div class="option-group" id="group-hf">
                    <div class="option-btn" onclick="setOption('kfre-hf', '0', this); checkHFSymptoms(false);" data-i18n="opt.no">ç„¡</div>
                    <div class="option-btn" onclick="setOption('kfre-hf', '1', this); checkHFSymptoms(true);" data-i18n="opt.yes">æœ‰</div>
                </div>
                <input type="hidden" id="kfre-hf" value="" onchange="updateAllRisks()">
                
                <div id="hf-check-box" class="symptom-box hidden">
                    <p style="margin-top:0; color:#c2185b;"><strong data-i18n="hf.sym_check_title">ğŸ” å¿«é€Ÿç¯©æª¢ï¼šæ‚¨æœ‰ä»¥ä¸‹ç—‡ç‹€å—ï¼Ÿ</strong></p>
                    <div class="sym-item"><input type="checkbox" class="sym-check" onchange="symAlert()"> <span data-i18n="hf.sym_1">å¹³èººç¡è¦ºæœƒå–˜ (ç«¯åå‘¼å¸)</span></div>
                    <div class="sym-item"><input type="checkbox" class="sym-check" onchange="symAlert()"> <span data-i18n="hf.sym_2">ä¸‹è‚¢æ°´è…« (æŒ‰å£“å½ˆä¸å›ä¾†)</span></div>
                    <div class="sym-item"><input type="checkbox" class="sym-check" onchange="symAlert()"> <span data-i18n="hf.sym_3">ç¨å¾®æ´»å‹•å°±å¾ˆå–˜</span></div>
                    <div id="sym-alert" class="hidden" style="color: red; font-weight: 900; margin-top: 10px; background:white; padding:10px; border-radius:10px;"></div>
                </div>
            </div>

            <p id="start-hint" style="color:#888; font-size:1.1rem; margin-top:20px; font-weight:bold;" data-i18n="home.hint_fill">ğŸ‘† è³‡æ–™å¡«å¯«å®Œæ•´å¾Œï¼Œçµæœå°‡è‡ªå‹•é¡¯ç¤º</p>

            <div id="unified-result" class="hidden">
                <div id="risk-banner" class="risk-banner" style="background:#ccc; margin-bottom:20px;">
                    <h3 id="risk-title" style="margin-bottom:5px;">--</h3><p id="risk-desc" style="font-size:1rem;">--</p>
                </div>
                
                <div id="kfre-result-box" style="background:#e1f5fe; border-radius:15px; padding:25px 15px; border:3px solid #b3e5fc; text-align:center; margin-top:25px; transition: all 0.3s;">
                    <h3 data-i18n="res.kfre_title" id="kfre-result-title" style="margin:0 0 20px 0; color:#01579b; font-size:1.5rem; font-weight:900;">ğŸ“… æœªä¾†æ´—è…æ©Ÿç‡é æ¸¬</h3>
                    <div style="display:flex; justify-content:space-around; margin-bottom:20px; align-items: flex-start;">
                        <div style="flex:1;"><span class="kfre-highlight-label" data-i18n="res.2yr">2å¹´å…§æ´—è…æ©Ÿç‡</span><span id="res-2yr" class="kfre-highlight-value">--%</span></div>
                        <div style="width:2px; background:#ccc; opacity:0.5; height:60px; margin-top:10px;"></div>
                        <div style="flex:1;"><span class="kfre-highlight-label" data-i18n="res.5yr">5å¹´å…§æ´—è…æ©Ÿç‡</span><span id="res-5yr" class="kfre-highlight-value">--%</span></div>
                    </div>
                    <div id="kfre-advice-box" style="background:white; padding:15px; border-radius:10px; text-align:left; font-size:1.1rem; line-height:1.6; border-left:6px solid #ccc; box-shadow:0 2px 5px rgba(0,0,0,0.05);">Loading...</div>
                </div>
                <p data-i18n="home.hint_tabs" style="color:#d32f2f; font-weight:900; margin-top:25px; font-size:1.1rem;">ğŸ‘‡ æ‚¨çš„å°ˆå±¬ç”¨è—¥èˆ‡é£²é£Ÿå»ºè­°å·²ç”Ÿæˆï¼Œ<br>è«‹é»é¸ä¸‹æ–¹é¸å–®åˆ‡æ›æŸ¥çœ‹ã€‚</p>
            </div>
        </div>
        <div class="page-counter">ğŸ‘€ View Count: <span id="busuanzi_value_site_pv">--</span></div>
    </div>

    <div id="tab-meds" class="section">
        <div class="card">
            <h2 data-i18n="med.title">ğŸ’Š å€‹äººåŒ–ç”¨è—¥å»ºè­°</h2>
            <div id="med-placeholder" style="padding:40px 10px; color:#999;">
                <div style="font-size:4rem;">ğŸ“‰</div>
                <p style="font-size:1.3rem;" data-i18n="med.placeholder">è«‹å…ˆè‡³ã€Œé¦–é ã€å¡«å¯«è³‡æ–™</p>
                <button class="btn btn-outline" onclick="switchTab('home')" data-i18n="btn.go_home">å‰å¾€é¦–é </button>
            </div>
            <div id="med-content" class="hidden">
                <p style="background:#eee; padding:15px; border-radius:15px; color:#444; font-weight:bold;">
                    <span data-i18n="med.analyze_target">åˆ†æå°è±¡ï¼š</span> eGFR <span id="med-egfr-val" style="color:var(--primary);">--</span> / <span id="med-cond-text">--</span>
                </p>
                <div class="list-card" style="border-color: var(--risk-g);"><div class="list-head" style="background: var(--risk-g);" data-i18n="med.green">ğŸŸ¢ æ ¸å¿ƒæ²»ç™‚ (å»ºè­°è«®è©¢)</div><div class="list-body" id="list-med-g"></div></div>
                <div class="list-card" style="border-color: var(--risk-y);"><div class="list-head" style="background: var(--risk-y); color:#333;" data-i18n="med.yellow">ğŸŸ¡ éœ€è¬¹æ… (æ³¨æ„å‰¯ä½œç”¨)</div><div class="list-body" id="list-med-y"></div></div>
                <div class="list-card" style="border-color: var(--risk-r);"><div class="list-head" style="background: var(--risk-r);" data-i18n="med.red">ğŸ”´ æ‡‰é¿å…/ç¦ç”¨</div><div class="list-body" id="list-med-r"></div></div>
            </div>
        </div>

        <div class="card">
            <h2 data-i18n="med.safety_title">ğŸš¦ è—¥ç‰©å®‰å…¨ç´…ç¶ ç‡ˆ</h2>
            <div class="select-wrapper">
                <select id="med-select" onchange="checkMed()">
                    <option value="" data-i18n="med.select_drug">ğŸ” è«‹é¸æ“‡è—¥ç‰©åç¨±...</option>
                    <option value="ras">ACEi / ARB (Blood Pressure)</option>
                    <option value="arni">ARNI (Heart Failure)</option>
                    <option value="panadol">Acetaminophen (Panadol)</option>
                    <option value="mycin">Aminoglycosides (Antibiotics)</option>
                    <option value="bb">Beta-blocker</option>
                    <option value="contrast">Contrast Media</option>
                    <option value="diuretic">Diuretics</option>
                    <option value="enema">Enema (Phosphate)</option>
                    <option value="ns_mra">Finerenone (ns-MRA)</option>
                    <option value="glp1">GLP-1 RA</option>
                    <option value="herbal">Herbal Medicine</option>
                    <option value="metformin">Metformin</option>
                    <option value="nsaid">NSAIDs (Painkillers)</option>
                    <option value="sglt2">SGLT2i</option>
                    <option value="statins">Statins</option>
                </select>
            </div>
            <div class="traffic-container">
                <div id="light-r" class="light" style="color: var(--risk-r); background: var(--risk-r);"></div><div id="light-y" class="light" style="color: var(--risk-y); background: var(--risk-y);"></div><div id="light-g" class="light" style="color: var(--risk-g); background: var(--risk-g);"></div>
            </div>
            <div id="med-result" class="med-result-box hidden"></div>
        </div>
        
        <div class="card" style="border: 3px solid #ff9800; background: #fff8e1;">
            <h2 data-i18n="sick.title" style="color:#e65100; border-bottom-color:#ffcc80; margin-bottom:15px;">ğŸ¤¢ ç”Ÿç—…æ—¥åœè—¥å®ˆå‰‡</h2>
            <p data-i18n="sick.desc" style="text-align:left; font-weight:bold; color:#bf360c; line-height:1.6; margin-bottom:20px; font-size:1.1rem;">
                ç•¶æ‚¨ç™¼ç”Ÿè…¹ç€‰ã€ç™¼ç‡’ã€è„«æ°´æ™‚ï¼Œè«‹è«®è©¢é†«å¸«æ˜¯å¦æš«åœä»¥ä¸‹è—¥ç‰© (Sick Day Rules)ï¼š
            </p>
            <div style="text-align:left; display:grid; grid-template-columns: 1fr; gap:10px;">
                <div class="quiz-option" style="margin:0; padding:10px; border-color:#ffcc80; color:#e65100;">SGLT2i / Metformin (Diabetes)</div>
                <div class="quiz-option" style="margin:0; padding:10px; border-color:#ffcc80; color:#e65100;">ACEi / ARB (Blood Pressure)</div>
                <div class="quiz-option" style="margin:0; padding:10px; border-color:#ffcc80; color:#e65100;">Diuretics (Water Pill)</div>
                <div class="quiz-option" style="margin:0; padding:10px; border-color:#ffcc80; color:#e65100;">NSAIDs (Painkillers)</div>
            </div> 
            <a href="https://nreg.fyh.mohw.gov.tw/OReg/RegisterPage?viewparam=sect" target="_blank" class="btn" style="background:#d32f2f; margin-top:20px; box-shadow: 0 6px 15px rgba(211, 47, 47, 0.3);">
                <span data-i18n="btn.emergency">ğŸ¥ ç—‡ç‹€æ²’æ”¹å–„? ç«‹å³æ›è™Ÿ</span>
            </a>
        </div>
    </div>

    <div id="tab-diet" class="section">
        <div class="card">
            <h2 data-i18n="diet.title">ğŸ½ï¸ å°ˆå±¬é£²é£Ÿå»ºè­°</h2>
            <div id="diet-placeholder" style="padding:40px 10px; color:#999;">
                <div style="font-size:4rem;">ğŸ¥£</div>
                <p data-i18n="med.placeholder">è«‹å…ˆè‡³ã€Œé¦–é ã€å¡«å¯«è³‡æ–™</p>
                <button class="btn btn-outline" onclick="switchTab('home')" data-i18n="btn.go_home">å‰å¾€é¦–é </button>
            </div>
            <div id="diet-content" class="hidden">
                <div class="list-card" style="border-color: var(--risk-g);">
                    <div class="list-head" style="background: var(--risk-g);" data-i18n="diet.green">ğŸŸ¢ å»ºè­°æ”å–</div>
                   <div id="protein-guide-box" style="margin: 15px 0; padding: 15px; background-color: #f1f8e9; border: 2px dashed #558b2f; border-radius: 12px; display: none;">
                        <p style="margin: 0; font-size: 1.1rem; color: #33691e; font-weight: 900;" data-i18n="diet.protein_title">ğŸ¥© æ¯æ—¥è›‹ç™½è³ªå»ºè­°</p>
                        <div style="display: flex; align-items: baseline; margin-top: 5px;">
                            <span id="protein-guide-val" style="font-size: 2.5rem; font-weight: 900; color: #2e7d32;">--</span>
                            <span style="margin-left: 8px; font-size: 1.0rem; font-weight:bold; color:#558b2f;">g / kg</span>
                        </div>
                    </div>
                    <div class="list-body" id="list-diet-g"></div>
                </div>

                <div class="list-card" style="border-color: #00bcd4;">
                    <div class="list-head" style="background: #00bcd4;" data-i18n="diet.energy_title">âš¡ è£œå……ç†±é‡å°å¹«æ‰‹</div>
                    <div class="list-body" style="font-size: 1rem;">
                        <p style="margin-top:0;" data-i18n="diet.energy_desc">ç†±é‡ä¸è¶³æœƒåˆ†è§£è‚Œè‚‰ï¼Œåè€Œç”¢ç”Ÿå°¿æ¯’ç´ ï¼è«‹å¤šåˆ©ç”¨ä½æ°®æ¾±ç²‰ã€‚</p>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                            <div class="option-btn" style="font-size:0.95rem; background:#e0f7fa; border:none; color:#006064;">Glass Noodles</div>
                            <div class="option-btn" style="font-size:0.95rem; background:#e0f7fa; border:none; color:#006064;">Tapioca / Sago</div>
                        </div>
                    </div>
                </div>

                <div class="list-card" style="border-color: var(--risk-y);"><div class="list-head" style="background: var(--risk-y); color:#333;" data-i18n="diet.yellow">ğŸŸ¡ é ˆæ³¨æ„/æ¸›é‡</div><div class="list-body" id="list-diet-y"></div></div>
                <div class="list-card" style="border-color: var(--risk-r);"><div class="list-head" style="background: var(--risk-r);" data-i18n="diet.red">ğŸ”´ ä¸å»ºè­°æ”å–</div><div class="list-body" id="list-diet-r"></div></div>
            </div>
            
            <div style="margin: 30px 0; text-align: center;">
                <h3 style="color: var(--primary); font-size: 1.5rem; font-weight: 900; margin: 0 0 15px 0;" data-i18n="diet.plate_title">ğŸ½ï¸ è­·è…é¤ç›¤</h3>
                <img src="CKD_diet.png" alt="Plate" loading="lazy" style="width: 100%; max-width: 350px; height: auto; border-radius: 20px; display: block; margin: 0 auto;">
            </div>

            <hr style="margin: 30px 0; border:0; border-top:2px dashed #ddd;">
            
            <h3 style="color:var(--primary); margin-bottom:15px;" data-i18n="diet.search_title">ğŸ” é£Ÿç‰©ç´…ç¶ ç‡ˆæŸ¥è©¢</h3>
            <div class="guide-box">
                <h3 class="guide-title" data-i18n="diet.legend_title">ğŸš¦ ç‡ˆè™Ÿä»£è¡¨æ„ç¾©</h3>
                <div class="guide-row"><div class="guide-icon icon-g">ğŸŸ¢</div><div class="guide-text"><span class="guide-head text-g" data-i18n="diet.legend_g">ç¶ ç‡ˆ (å®‰å¿ƒåƒ)</span><div class="guide-desc" data-i18n="diet.legend_g_desc">ä½ç£·ã€ä½é‰€ã€å„ªè³ªè›‹ç™½æˆ–ä½æ°®æ¾±ç²‰ã€‚</div></div></div>
                <div class="guide-row"><div class="guide-icon icon-y">ğŸŸ¡</div><div class="guide-text"><span class="guide-head text-y" data-i18n="diet.legend_y">é»ƒç‡ˆ (éœ€æ³¨æ„)</span><div class="guide-desc" data-i18n="diet.legend_y_desc">å»ºè­°ã€Œé™é‡ã€æˆ–ã€Œåˆ‡å°å¡Šæ±†ç‡™ã€å¾Œå†åƒã€‚</div></div></div>
                <div class="guide-row"><div class="guide-icon icon-r">ğŸ”´</div><div class="guide-text"><span class="guide-head text-r" data-i18n="diet.legend_r">ç´…ç‡ˆ (æ‡‰é¿å…)</span><div class="guide-desc" data-i18n="diet.legend_r_desc">åŠ å·¥é«˜éˆ‰ã€å…§è‡Ÿã€æˆ–å«ç¥ç¶“æ¯’ç´ ã€‚</div></div></div>
            </div>
            
            <div style="position: sticky; top: 75px; background: #fff; padding: 10px 0; z-index: 10;">
                <input type="text" id="food-search-input" placeholder="è¼¸å…¥é—œéµå­—..." oninput="filterFood()" 
                    style="width: 100%; padding: 15px; border: 2px solid #ccc; border-radius: 30px; font-size: 1.1rem; outline: none; transition: 0.3s; font-weight:bold;">
                <div id="food-tags" style="display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; -webkit-overflow-scrolling: touch;"></div>
            </div>
            <div id="food-list-area" style="min-height: 200px;"></div>
        </div>
    </div>

    <div id="tab-quiz" class="section">
        <div class="card" style="border: 3px solid #6bbd45; background: #fff;">
            <h2 data-i18n="armor.title" style="color:#2e7d32; border-bottom-color:#a5d6a7;">ğŸ›¡ï¸ æˆ‘çš„è­·è…è—¥ç‰©æ¸…å–®</h2>
            <p data-i18n="armor.desc" style="text-align:center; color:#666; font-size:1.1rem; margin-bottom:15px; line-height: 1.6;">
                è«‹å‹¾é¸æ‚¨ç›®å‰æ­£åœ¨æœç”¨çš„è—¥ç‰©ï¼Œç³»çµ±å°‡å¹«æ‚¨æª¢è¦–ç›®å‰çš„ä¿è­·åŠ›ã€‚
            </p>

            <div class="equip-grid">
                <div class="equip-slot slot-legendary" onclick="toggleEquip(this, 'drug-sglt2')" data-equipped-text="Equipped">
                    <span class="equip-name">SGLT2i</span>
                    <span class="equip-desc">Foria/Jardiance</span>
                    <input type="checkbox" id="drug-sglt2" class="gear-checkbox hidden-checkbox">
                </div>
                <div class="equip-slot slot-epic" onclick="toggleEquip(this, 'drug-rasi')" data-equipped-text="Equipped">
                    <span id="icon-rasi" style="display:none;"></span>
                    <span class="equip-name" id="name-rasi">RASi</span>
                    <span class="equip-desc" id="desc-rasi">ACEi/ARB</span>
                    <input type="checkbox" id="drug-rasi" class="gear-checkbox hidden-checkbox">
                </div>
                <div id="slot-bb" class="equip-slot slot-heart" onclick="toggleEquip(this, 'drug-bb')" style="display:none;" data-equipped-text="Equipped">
                    <span class="equip-name">Beta-blocker</span>
                    <span class="equip-desc">Concor/Bisoprolol</span>
                    <input type="checkbox" id="drug-bb" class="gear-checkbox hidden-checkbox">
                </div>
                <div id="slot-mra-old" class="equip-slot slot-rare" onclick="toggleEquip(this, 'drug-mra-old')" style="display:none;" data-equipped-text="Equipped">
                    <span class="equip-name">MRA</span>
                    <span class="equip-desc">Spironolactone</span>
                    <input type="checkbox" id="drug-mra-old" class="gear-checkbox hidden-checkbox">
                </div>
                <div id="slot-nsmra" class="equip-slot slot-arcane" onclick="toggleEquip(this, 'drug-nsmra')" style="display:none;" data-equipped-text="Equipped">
                    <span class="equip-name">ns-MRA</span>
                    <span class="equip-desc">Kerendia</span>
                    <input type="checkbox" id="drug-nsmra" class="gear-checkbox hidden-checkbox">
                </div>
                <div class="equip-slot slot-uncommon" onclick="toggleEquip(this, 'drug-statin')" data-equipped-text="Equipped">
                    <span class="equip-name">Statin</span>
                    <span class="equip-desc">Lipitor/Crestor</span>
                    <input type="checkbox" id="drug-statin" class="gear-checkbox hidden-checkbox">
                </div>
                <div id="slot-glp1" class="equip-slot slot-arcane" onclick="toggleEquip(this, 'drug-glp1')" style="display:none;" data-equipped-text="Equipped">
                    <span class="equip-name">GLP-1 RA</span>
                    <span class="equip-desc">Ozempic/Trulicity</span>
                    <input type="checkbox" id="drug-glp1" class="gear-checkbox hidden-checkbox">
                </div>
            </div>
            
            <div id="status-panel" class="status-panel status-novice" style="margin-top: 20px;">
                <div class="status-icon" id="status-icon">âš ï¸</div>
                <div class="status-info">
                    <div class="status-title" id="status-title">--</div>
                    <div class="status-msg" id="status-msg">--</div>
                </div>
            </div>
            <div id="dynamic-advice" class="hidden" style="margin-top:15px; text-align:left; animation: fadeIn 0.5s;"></div>
        </div>
    </div>

    <div id="tab-consult" class="section">
        <div class="card">
            <h2 data-i18n="consult.title">ğŸ’¬ è«®è©¢è—¥å¸«</h2>
            <div style="background:#f9f9f9; padding:25px; border-radius:20px; border:3px solid #eee; margin-bottom:30px;">
                <h3 style="color:#06c755; margin-top:0;">LINE Official</h3>
                <div class="qr-box"><img src="line_qr.png" class="qr-img" onerror="this.style.display='none'"></div>
                <a href="https://lin.ee/sydupT8" target="_blank" class="btn btn-line" data-i18n="btn.line_add">ğŸ“² åŠ å…¥å¥½å‹ (ç·šä¸Šè«®è©¢)</a>
            </div>
        </div>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home')"><span class="nav-icon">ğŸ </span><span data-i18n="nav.home">é¦–é </span></div>
    <div class="nav-item" onclick="switchTab('meds')"><span class="nav-icon">ğŸ’Š</span><span data-i18n="nav.meds">ç”¨è—¥</span></div>
    <div class="nav-item" onclick="switchTab('diet')"><span class="nav-icon">ğŸ¥¦</span><span data-i18n="nav.diet">é£²é£Ÿ</span></div>
    <div class="nav-item" onclick="switchTab('quiz')"><span class="nav-icon">ğŸ›¡ï¸</span><span data-i18n="nav.armor">æ¸…å–®</span></div>
    <div class="nav-item" onclick="switchTab('consult')"><span class="nav-icon">ğŸ’¬</span><span data-i18n="nav.consult">è«®è©¢</span></div>
</nav>

<div id="help-modal" class="modal" onclick="closeHelp()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <button class="close-modal" onclick="closeHelp()">Ã—</button>
        <h3 data-i18n="help.title">ğŸ“„ å¦‚ä½•çœ‹å ±å‘Šï¼Ÿ</h3>
        <div id="help-egfr" class="help-content hidden"><p>Look for "eGFR" or "Creatinine".</p></div>
        <div id="help-uacr" class="help-content hidden"><p>Look for "ACR", "UACR", or "Urine Protein".</p></div>
        <button class="btn" onclick="closeHelp()" style="margin-top:20px;">Close</button>
    </div>
</div>

<script>
/**
 * ğŸŒ Internationalization (i18n) Data
 */
const i18nData = {
    'zh-TW': {
        app: { title: 'ä¿è…è­·å¿ƒåŠ©ç†', subtitle: 'å¿ƒ/è…/ç³– æ™ºæ…§ç…§è­·' },
        nav: { home: 'é¦–é ', meds: 'ç”¨è—¥', diet: 'é£²é£Ÿ', armor: 'æ¸…å–®', consult: 'è«®è©¢' },
        home: { 
            risk_title: 'ğŸ“Š é¢¨éšªè©•ä¼°èˆ‡è¨­å®š', 
            risk_desc: 'è«‹è¼¸å…¥æ‚¨çš„åŸºæœ¬è³‡æ–™ï¼Œç³»çµ±å°‡ä¾æ“šæ‚¨çš„ç‹€æ³ (æ…¢æ€§è…è¡°ç«­ / ç³–å°¿ç—… / å¿ƒè¡°ç«­) æä¾›å€‹äººåŒ–çš„ç”¨è—¥èˆ‡é£²é£Ÿå»ºè­°ã€‚',
            hint_fill: 'ğŸ‘† è³‡æ–™å¡«å¯«å®Œæ•´å¾Œï¼Œçµæœå°‡è‡ªå‹•é¡¯ç¤º',
            hint_tabs: 'ğŸ‘‡ æ‚¨çš„å°ˆå±¬ç”¨è—¥èˆ‡é£²é£Ÿå»ºè­°å·²ç”Ÿæˆï¼Œè«‹é»é¸ä¸‹æ–¹é¸å–®åˆ‡æ›æŸ¥çœ‹ã€‚'
        },
        label: { age: '1. å¹´é½¡', sex: '2. æ€§åˆ¥', egfr: '3. è…çµ²çƒéæ¿¾ç‡ (eGFR)', uacr: '4. è›‹ç™½å°¿ç‹€æ³ (UACR)', dm: '5. æ˜¯å¦æœ‰ç³–å°¿ç—… (DM)', hf: '6. æ˜¯å¦æœ‰å¿ƒè¡°ç«­ (HF)' },
        opt: { 
            select_age: 'è«‹é¸æ“‡å¹´é½¡...', male: 'ç”·', female: 'å¥³', select_val: 'è«‹é¸æ“‡æ•¸å€¼å€é–“...',
            egfr_1: 'æ­£å¸¸ (eGFR â‰¥ 90)', egfr_2: 'ç¬¬2æœŸ (eGFR 60-89)', egfr_3a: 'ç¬¬3aæœŸ (eGFR 45-59)',
            egfr_3b: 'ç¬¬3bæœŸ (eGFR 30-44)', egfr_4: 'ç¬¬4æœŸ (eGFR 15-29)', egfr_5: 'ç¬¬5æœŸ (eGFR < 15)',
            uacr_norm: 'æ­£å¸¸\n<30', uacr_micro: 'å¾®é‡\n30-300', uacr_macro: 'åš´é‡\n>300',
            no: 'ç„¡', yes: 'æœ‰'
        },
        hf: { sym_check_title: 'ğŸ” å¿«é€Ÿç¯©æª¢ï¼šæ‚¨æœ‰ä»¥ä¸‹ç—‡ç‹€å—ï¼Ÿ', sym_1: 'å¹³èººç¡è¦ºæœƒå–˜ (ç«¯åå‘¼å¸)', sym_2: 'ä¸‹è‚¢æ°´è…« (æŒ‰å£“å½ˆä¸å›ä¾†)', sym_3: 'ç¨å¾®æ´»å‹•å°±å¾ˆå–˜', alert: 'ğŸš¨ ç–‘ä¼¼å¿ƒè‡Ÿè¡°ç«­ç—‡ç‹€ï¼Œå»ºè­°è‡³å¿ƒè‡Ÿç§‘æª¢æŸ¥ï¼' },
        res: { kfre_title: 'ğŸ“… æœªä¾†æ´—è…æ©Ÿç‡é æ¸¬', '2yr': '2å¹´å…§æ´—è…æ©Ÿç‡', '5yr': '5å¹´å…§æ´—è…æ©Ÿç‡' },
        btn: { clear: 'ğŸ—‘ï¸ æ¸…é™¤ç´€éŒ„ / é‡è¨­', go_home: 'å‰å¾€é¦–é ', emergency: 'ğŸ¥ ç—‡ç‹€æ²’æ”¹å–„? ç«‹å³æ›è™Ÿ', line_add: 'ğŸ“² åŠ å…¥å¥½å‹ (ç·šä¸Šè«®è©¢)' },
        med: { 
            title: 'ğŸ’Š å€‹äººåŒ–ç”¨è—¥å»ºè­°', placeholder: 'è«‹å…ˆè‡³ã€Œé¦–é ã€å¡«å¯«è³‡æ–™ï¼Œç³»çµ±å°‡ä¾ç–¾ç—…çµ„åˆç”¢ç”Ÿå»ºè­°', analyze_target: 'åˆ†æå°è±¡ï¼š',
            green: 'ğŸŸ¢ æ ¸å¿ƒæ²»ç™‚ (å»ºè­°è«®è©¢)', yellow: 'ğŸŸ¡ éœ€è¬¹æ… (æ³¨æ„å‰¯ä½œç”¨)', red: 'ğŸ”´ æ‡‰é¿å…/ç¦ç”¨',
            safety_title: 'ğŸš¦ è—¥ç‰©å®‰å…¨ç´…ç¶ ç‡ˆ', select_drug: 'ğŸ” è«‹é¸æ“‡è—¥ç‰©åç¨±...'
        },
        sick: { title: 'ğŸ¤¢ ç”Ÿç—…æ—¥åœè—¥å®ˆå‰‡', desc: 'ç•¶æ‚¨ç™¼ç”Ÿæ‹‰è‚šå­ã€ç™¼ç‡’ã€è„«æ°´æ™‚ï¼Œè«‹è«®è©¢é†«å¸«æˆ–è—¥å¸«ï¼Œæ˜¯å¦æš«åœä»¥ä¸‹è—¥ç‰©ï¼š' },
        diet: { 
            title: 'ğŸ½ï¸ å°ˆå±¬é£²é£Ÿå»ºè­°', green: 'ğŸŸ¢ å»ºè­°æ”å–', yellow: 'ğŸŸ¡ é ˆæ³¨æ„/æ¸›é‡', red: 'ğŸ”´ ä¸å»ºè­°æ”å–',
            protein_title: 'ğŸ¥© æ¯æ—¥è›‹ç™½è³ªå»ºè­°', energy_title: 'âš¡ è£œå……ç†±é‡å°å¹«æ‰‹', energy_desc: 'ç†±é‡æ”å–ä¸è¶³æœƒåˆ†è§£è‚Œè‚‰ï¼Œåè€Œç”¢ç”Ÿæ›´å¤šå°¿æ¯’ç´ ï¼è«‹å¤šåˆ©ç”¨ã€Œä½æ°®æ¾±ç²‰ã€å¡«è£œè‚šå­ã€‚',
            plate_title: 'ğŸ½ï¸ è­·è…é¤ç›¤', search_title: 'ğŸ” é£Ÿç‰©ç´…ç¶ ç‡ˆæŸ¥è©¢',
            legend_title: 'ğŸš¦ ç‡ˆè™Ÿä»£è¡¨æ„ç¾©',
            legend_g: 'ç¶ ç‡ˆ (å®‰å¿ƒåƒ)', legend_g_desc: 'ä½ç£·ã€ä½é‰€ã€å„ªè³ªè›‹ç™½æˆ–ä½æ°®æ¾±ç²‰ã€‚',
            legend_y: 'é»ƒç‡ˆ (éœ€æ³¨æ„)', legend_y_desc: 'é›–å¤©ç„¶ä½†å«ç£·é‰€ç¨é«˜ã€‚å»ºè­°ã€Œé™é‡ã€æˆ–ã€Œåˆ‡å°å¡Šæ±†ç‡™ã€ã€‚',
            legend_r: 'ç´…ç‡ˆ (æ‡‰é¿å…)', legend_r_desc: 'åŠ å·¥é«˜éˆ‰/ç„¡æ©Ÿç£·ã€å…§è‡Ÿã€æˆ–å«ç¥ç¶“æ¯’ç´ ã€‚'
        },
        armor: { title: 'ğŸ›¡ï¸ æˆ‘çš„è­·è…è—¥ç‰©æ¸…å–®', desc: 'è«‹å‹¾é¸æ‚¨ç›®å‰æ­£åœ¨æœç”¨çš„è—¥ç‰©ï¼Œç³»çµ±å°‡å¹«æ‚¨æª¢è¦–ç›®å‰çš„ä¿è­·åŠ›ã€‚' },
        consult: { title: 'ğŸ’¬ è—¥å¸«è«®è©¢å®¤' },
        help: { title: 'ğŸ“„ å¦‚ä½•çœ‹å ±å‘Šï¼Ÿ' }
    },
    'en': {
        app: { title: 'Kidney Care Assistant', subtitle: 'Heart / Kidney / Diabetes' },
        nav: { home: 'Home', meds: 'Meds', diet: 'Diet', armor: 'Armor', consult: 'Consult' },
        home: { 
            risk_title: 'ğŸ“Š Risk Assessment', 
            risk_desc: 'Please enter your profile. The system will provide personalized medication and diet advice based on your condition (CKD / Diabetes / Heart Failure).',
            hint_fill: 'ğŸ‘† Fill in data to see results',
            hint_tabs: 'ğŸ‘‡ Your personalized advice is ready. Click tabs below.'
        },
        label: { age: '1. Age', sex: '2. Gender', egfr: '3. eGFR', uacr: '4. Urine Protein (UACR)', dm: '5. Diabetes (DM)', hf: '6. Heart Failure (HF)' },
        opt: { 
            select_age: 'Select Age...', male: 'Male', female: 'Female', select_val: 'Select Value...',
            egfr_1: 'Normal (â‰¥ 90)', egfr_2: 'Stage 2 (60-89)', egfr_3a: 'Stage 3a (45-59)',
            egfr_3b: 'Stage 3b (30-44)', egfr_4: 'Stage 4 (15-29)', egfr_5: 'Stage 5 (< 15)',
            uacr_norm: 'Normal\n<30', uacr_micro: 'Micro\n30-300', uacr_macro: 'Macro\n>300',
            no: 'No', yes: 'Yes'
        },
        hf: { sym_check_title: 'ğŸ” Quick Check: Symptoms?', sym_1: 'Shortness of breath lying flat', sym_2: 'Leg Edema (Swelling)', sym_3: 'Breathless with activity', alert: 'ğŸš¨ Possible Heart Failure symptoms. Please visit a cardiologist!' },
        res: { kfre_title: 'ğŸ“… Kidney Failure Prediction', '2yr': '2-Year Risk', '5yr': '5-Year Risk' },
        btn: { clear: 'ğŸ—‘ï¸ Clear Data', go_home: 'Go Home', emergency: 'ğŸ¥ Seeking Medical Help', line_add: 'ğŸ“² Add LINE (Consult)' },
        med: { 
            title: 'ğŸ’Š Medication Advice', placeholder: 'Please fill in data at "Home" tab first.', analyze_target: 'Target: ',
            green: 'ğŸŸ¢ Core Therapy (Consult)', yellow: 'ğŸŸ¡ Caution', red: 'ğŸ”´ Avoid / Contraindicated',
            safety_title: 'ğŸš¦ Drug Safety Light', select_drug: 'ğŸ” Select Drug Name...'
        },
        sick: { title: 'ğŸ¤¢ Sick Day Rules', desc: 'If you have Diarrhea, Fever, or Dehydration, consult your doctor about pausing these:' },
        diet: { 
            title: 'ğŸ½ï¸ Personalized Diet', green: 'ğŸŸ¢ Recommended', yellow: 'ğŸŸ¡ Limit / Caution', red: 'ğŸ”´ Avoid',
            protein_title: 'ğŸ¥© Daily Protein', energy_title: 'âš¡ Energy Boosters', energy_desc: 'Insufficient calories cause muscle breakdown! Use low-nitrogen starch.',
            plate_title: 'ğŸ½ï¸ Kidney Plate', search_title: 'ğŸ” Food Traffic Light',
            legend_title: 'ğŸš¦ Traffic Light Meaning',
            legend_g: 'Green (Safe)', legend_g_desc: 'Low P/K, high quality protein.',
            legend_y: 'Yellow (Limit)', legend_y_desc: 'Limit portion or blanch vegetables.',
            legend_r: 'Red (Avoid)', legend_r_desc: 'Processed, high Na/P, organs, toxins.'
        },
        armor: { title: 'ğŸ›¡ï¸ My Drug Armor', desc: 'Check the meds you are taking to assess your protection level.' },
        consult: { title: 'ğŸ’¬ Pharmacist Consult' },
        help: { title: 'ğŸ“„ How to read report?' }
    }
};

// Global State
let curLang = 'zh-TW';

function changeLang(lang) {
    curLang = lang;
    
    // 1. Update static elements with data-i18n
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const keys = key.split('.');
        let val = i18nData[lang];
        keys.forEach(k => { if(val) val = val[k]; });
        if(val) el.innerText = val;
    });

    // 2. Refresh dynamic logic (to re-generate advice text in new lang)
    updateAllRisks();
    
    // 3. Update placeholders (special case)
    const foodInput = document.getElementById('food-search-input');
    if(foodInput) foodInput.placeholder = (lang === 'en') ? "Search food..." : "è¼¸å…¥é—œéµå­—...";

    // 4. Reload Food Categories
    initFoodSearch();
}

// --- DB Logic (Multilingual Support) ---
// Helper to get text based on lang
const t = (zh, en) => (curLang === 'en' ? (en || zh) : zh);

const medDB = {
    'ras': { level: 'g', get t() { return t('âœ… åŸºç¤é˜²ç¦¦ (ACEi/ARB)', 'âœ… Basic Defense (ACEi/ARB)'); }, get d() { return t('è­·è…é¦–é¸è¡€å£“è—¥ã€‚', 'First-line for CKD/BP.'); } },
    'arni': { level: 'g', get t() { return t('ğŸ† é›™æ•ˆç¥å…µ (ARNI)', 'ğŸ† ARNI'); }, get d() { return t('å¿ƒè¡°ç«­æ²»ç™‚é¦–é¸ï¼', 'Top choice for Heart Failure.'); } },
    'bb': { level: 'g', get t() { return t('â¤ï¸ è­·å¿ƒè—¥ (Beta-blocker)', 'â¤ï¸ Beta-blocker'); }, get d() { return t('æ¸›è¼•å¿ƒè‡Ÿè² æ“”ã€‚', 'Reduces heart workload.'); } },
    'sglt2': { level: 'g', get t() { return t('âœ… æ ¸å¿ƒç¥å™¨ (SGLT2i)', 'âœ… Core Drug (SGLT2i)'); }, get d() { return t('å¿ƒ/è…æ•‘å‘½æ”¯æŸ±ã€‚', 'Key for Heart & Kidney.'); } },
    'statins': { level: 'g', get t() { return t('âœ… é™è¡€è„‚ (Statins)', 'âœ… Statins'); }, get d() { return t('é é˜²ä¸­é¢¨ã€‚', 'Prevents stroke.'); } },
    'nsaid': { level: 'r', get t() { return t('ğŸ›‘ çµ•å°ç¦æ­¢ (NSAIDs)', 'ğŸ›‘ NSAIDs (Painkillers)'); }, get d() { return t('å‚·è…åœ°é›·ï¼', 'Major kidney hazard!'); } }
    // ... others can be added similarly
};

// Food Categories (Dynamic)
function getFoodCats() {
    return {
        'all': t('å…¨éƒ¨', 'All'), 'staple': t('ğŸš ä¸»é£Ÿ', 'ğŸš Staple'), 
        'protein': t('ğŸ– è›‹è±†é­šè‚‰', 'ğŸ– Protein'), 'veg': t('ğŸ¥¦ è”¬èœ', 'ğŸ¥¦ Veg'), 
        'fruit': t('ğŸ æ°´æœ', 'ğŸ Fruit'), 'snack': t('ğŸ¦ é»å¿ƒ', 'ğŸ¦ Snack')
    };
}

// --- Core Logic ---
function switchTab(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById('tab-' + id).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    const idx = (id==='home')?0:(id==='meds')?1:(id==='diet')?2:(id==='quiz')?3:4;
    const navItems = document.querySelectorAll('.nav-item');
    if(navItems[idx]) navItems[idx].classList.add('active');
    
    window.scrollTo(0,0);
    if (id === 'diet') initFoodSearch();
}

function updateAllRisks() {
    const age = parseFloat(document.getElementById('kfre-age').value);
    const sex = document.getElementById('kfre-sex').value;
    const egfr = parseFloat(document.getElementById('kfre-egfr').value);
    const uacr = parseFloat(document.getElementById('kfre-uacr').value);
    const dmVal = document.getElementById('kfre-dm').value;
    const hfVal = document.getElementById('kfre-hf').value;
    const hasDM = dmVal === '1'; 
    const hasHF = hfVal === '1';
    
    if (isNaN(age) || sex === "" || isNaN(egfr) || isNaN(uacr) || dmVal === "" || hfVal === "") return;

    document.getElementById('start-hint').classList.add('hidden');
    document.getElementById('unified-result').classList.remove('hidden');

    // Logic: Matrix Highlight (Simplified for brevity)
    let row = '5';
    if (egfr >= 90) row = '1'; else if (egfr >= 60) row = '2'; else if (egfr >= 45) row = '3a'; else if (egfr >= 30) row = '3b'; else if (egfr >= 15) row = '4';
    let col = '1'; if (uacr >= 300) col = '3'; else if (uacr >= 30) col = '2';

    // Risk Text
    const banner = document.getElementById('risk-banner');
    let riskText = t("ä½é¢¨éšª", "Low Risk");
    let color = "#6bbd45";
    if (row === '3b' || row === '4' || row === '5' || col === '3') { riskText = t("é«˜é¢¨éšª", "High Risk"); color = "#e03e2e"; }
    else if (row === '3a' || col === '2') { riskText = t("ä¸­åº¦é¢¨éšª", "Moderate Risk"); color = "#ffd700"; }
    
    banner.style.backgroundColor = color;
    document.getElementById('risk-title').innerText = riskText;
    document.getElementById('risk-desc').innerText = `eGFR Stage ${row} + UACR Group ${col}`;

    updateMeds(egfr, hasDM, hasHF);
    updateDiet(egfr, hasDM, hasHF);
    updateArmorVisibility(hasDM, egfr, hasHF); 

    // KFRE Calc
    const sexNum = parseFloat(sex);
    const logACR = Math.log(uacr);
    const sum = -0.2201 * (age/10 - 7.036) + 0.2467 * (sexNum - 0.5642) - 0.5567 * (egfr/5 - 7.222) + 0.4510 * (logACR - 5.137);
    const risk2 = 1 - Math.pow(0.9832, Math.exp(sum));
    const risk5 = 1 - Math.pow(0.9365, Math.exp(sum));
    document.getElementById('res-2yr').innerText = (risk2 * 100).toFixed(1) + "%";
    document.getElementById('res-5yr').innerText = (risk5 * 100).toFixed(1) + "%";

    const adviceBox = document.getElementById('kfre-advice-box');
    let msg = "";
    if (risk2 >= 0.2) msg = t("é¢¨éšªè¼ƒé«˜ï¼Œå»ºè­°è«®è©¢è…è‡Ÿç§‘é†«å¸«ã€‚", "High risk. Please consult a nephrologist.");
    else msg = t("ç›®å‰é¢¨éšªå°šå¯ï¼Œè«‹æŒçºŒä¿æŒã€‚", "Current risk is manageable. Keep it up.");
    
    if(hasHF) msg += "<br>" + t("â¤ï¸ åˆä½µå¿ƒè¡°ç«­ï¼šéœ€åš´æ ¼æ§åˆ¶æ°´åˆ†ã€‚", "â¤ï¸ HF Alert: Strict fluid control.");
    adviceBox.innerHTML = msg;
}

function updateMeds(egfr, hasDM, hasHF) {
    document.getElementById('med-placeholder').classList.add('hidden');
    document.getElementById('med-content').classList.remove('hidden');
    document.getElementById('med-egfr-val').innerText = egfr;
    
    let conds = ['CKD']; 
    if(hasDM) conds.push('DM'); 
    if(hasHF) conds.push('HF');
    document.getElementById('med-cond-text').innerText = conds.join(' + ');

    const g = document.getElementById('list-med-g'), y = document.getElementById('list-med-y'), r = document.getElementById('list-med-r');
    g.innerHTML = ''; y.innerHTML = ''; r.innerHTML = '';
    const add = (list, title, desc) => { list.innerHTML += `<div class="list-item"><span class="list-title">${title}</span><span style="color:#555;">${desc}</span></div>`; }

    // Logic
    if (egfr >= 20) add(g, "SGLT2i", t("æ ¸å¿ƒæ•‘å‘½è—¥ï¼", "Core life-saving drug!"));
    else add(y, "SGLT2i", t("eGFR<20 ä¸å»ºè­°æ–°èµ·å§‹", "Not recommended to start if eGFR < 20"));

    if (hasHF) {
        add(g, "ARNI", t("å¿ƒè¡°ç«­é¦–é¸", "Top choice for HF"));
        add(g, "Beta-blocker", t("è­·å¿ƒå¿…å‚™", "Essential for heart"));
    } else {
        add(g, "RASi (ACEi/ARB)", t("è­·è…åŸºç¤", "Basic kidney protection"));
    }

    if (hasDM && egfr >= 25) add(g, "ns-MRA (Finerenone)", t("ç³–å°¿ç—…è…ç—…è®Šå°ˆç”¨", "For Diabetic Kidney Disease"));
    
    add(r, "NSAIDs", t("çµ•å°ç¦æ­¢ï¼å‚·è…ã€‚", "AVOID! Damages kidneys."));
}

function updateDiet(egfr, hasDM, hasHF) {
    document.getElementById('diet-placeholder').classList.add('hidden');
    document.getElementById('diet-content').classList.remove('hidden');

    const pBox = document.getElementById('protein-guide-box');
    const pVal = document.getElementById('protein-guide-val');
    if(pBox) {
        pBox.style.display = 'block';
        if (egfr < 45) {
            pVal.innerText = "0.6 ~ 0.8"; pVal.style.color = "#d84315";
        } else {
            pVal.innerText = "0.8 ~ 1.0"; pVal.style.color = "#2e7d32";
        }
    }
    
    const g = document.getElementById('list-diet-g'), y = document.getElementById('list-diet-y'), r = document.getElementById('list-diet-r');
    g.innerHTML = ''; y.innerHTML = ''; r.innerHTML = '';
    const add = (list, title, desc) => { list.innerHTML += `<div class="list-item"><span class="list-title">${title}</span><span style="color:#555;">${desc}</span></div>`; }

    add(g, t("å„ªè³ªè›‹ç™½", "High Quality Protein"), t("è›‹ã€é­šã€é›è‚‰ã€è±†è…", "Egg, Fish, Chicken, Tofu"));
    if(egfr < 45) {
        add(g, t("ä½æ°®æ¾±ç²‰", "Low Nitrogen Starch"), t("å†¬ç²‰ã€ç±³ç²‰", "Glass noodles, Rice noodles"));
        add(y, t("ç³™ç±³/äº”ç©€ç±³", "Brown Rice"), t("å«ç£·è¼ƒé«˜", "High in Phosphorus"));
    }
    add(r, t("æ¥Šæ¡ƒ", "Starfruit"), t("å«ç¥ç¶“æ¯’ç´ ", "Neurotoxin risk"));
}

// Food Search
let currentCategory = 'all';
const foodDB = {
    'rice': { n: 'ç™½é£¯ (White Rice)', c: 'staple', t: 'ğŸŸ¢', d: 'Low P/K.' },
    'winter_noodle': { n: 'å†¬ç²‰ (Glass Noodle)', c: 'staple', t: 'ğŸŸ¢', d: 'Low Nitrogen.' },
    'banana': { n: 'é¦™è•‰ (Banana)', c: 'fruit', t: 'ğŸ”´', d: 'High Potassium!' },
    'starfruit': { n: 'æ¥Šæ¡ƒ (Starfruit)', c: 'fruit', t: 'ğŸ”´', d: 'Neurotoxin!' },
    'egg': { n: 'è›‹ç™½ (Egg White)', c: 'protein', t: 'ğŸŸ¢', d: 'Best protein.' },
    'cola': { n: 'å¯æ¨‚ (Cola)', c: 'snack', t: 'ğŸ”´', d: 'High Phosphorus.' }
};

function initFoodSearch() {
    const tagContainer = document.getElementById('food-tags');
    if(!tagContainer) return;
    tagContainer.innerHTML = '';
    const cats = getFoodCats();
    Object.keys(cats).forEach(key => {
        const btn = document.createElement('button');
        btn.innerText = cats[key];
        btn.className = `option-btn ${key === currentCategory ? 'active' : ''}`;
        btn.style.flex = '0 0 auto'; btn.style.padding = '8px 15px';
        btn.onclick = () => {
            document.querySelectorAll('#food-tags .option-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentCategory = key;
            filterFood();
        };
        tagContainer.appendChild(btn);
    });
    filterFood();
}

function filterFood() {
    const input = document.getElementById('food-search-input').value.toLowerCase().trim();
    const listArea = document.getElementById('food-list-area');
    listArea.innerHTML = '';
    
    Object.keys(foodDB).forEach(key => {
        const item = foodDB[key];
        const isGlobal = input !== '';
        const catMatch = isGlobal ? true : (currentCategory === 'all' || item.c === currentCategory);
        const keyMatch = item.n.toLowerCase().includes(input);

        if (catMatch && keyMatch) {
            const div = document.createElement('div');
            div.className = 'quiz-option'; 
            div.innerHTML = `<span style="font-weight:bold;">${item.t} ${item.n}</span><br><small>${item.d}</small>`;
            listArea.appendChild(div);
        }
    });
}

// Check Med
function checkMed() {
    const val = document.getElementById('med-select').value;
    const res = document.getElementById('med-result');
    document.querySelectorAll('.light').forEach(l => l.classList.remove('on'));
    res.classList.add('hidden');
    if(!val) return;
    
    const data = medDB[val];
    if(data) {
        res.classList.remove('hidden');
        res.innerHTML = `<strong>${data.t}</strong><br>${data.d}`;
        if(data.level==='g') document.getElementById('light-g').classList.add('on');
        else if(data.level==='r') document.getElementById('light-r').classList.add('on');
    }
}

// Armor Logic
function updateArmorVisibility(hasDM, egfr, hasHF) {
    const show = (id) => document.getElementById(id).style.display = 'flex';
    const hide = (id) => {
        document.getElementById(id).style.display = 'none';
        const chk = document.querySelector(`#${id} input`);
        if(chk) chk.checked = false;
        document.getElementById(id).classList.remove('equipped');
    };

    if (hasHF) {
        document.getElementById('name-rasi').innerText = "ARNI"; 
        show('slot-bb'); 
        show('slot-mra-old'); hide('slot-nsmra');
    } else {
        document.getElementById('name-rasi').innerText = "RASi";
        hide('slot-bb');
        if (hasDM && egfr >= 25) { show('slot-nsmra'); hide('slot-mra-old'); }
        else { hide('slot-nsmra'); hide('slot-mra-old'); }
    }
    
    if (hasDM) show('slot-glp1'); else hide('slot-glp1');
    updateStatusAndAdvice();
}

function toggleEquip(el, id) {
    const chk = document.getElementById(id);
    chk.checked = !chk.checked;
    el.classList.toggle('equipped', chk.checked);
    updateStatusAndAdvice();
}

function updateStatusAndAdvice() {
    // Simplified Advice Logic for Demo
    const adviceDiv = document.getElementById('dynamic-advice');
    const sglt2 = document.getElementById('drug-sglt2').checked;
    
    let msg = "";
    if (sglt2) msg += `<div style="color:green; font-weight:bold;">âœ… SGLT2i: ${t('å·²è£å‚™ï¼', 'Equipped!')}</div>`;
    else msg += `<div style="color:red; font-weight:bold;">âš ï¸ SGLT2i: ${t('å»ºè­°è«®è©¢é†«å¸«ã€‚', 'Consult doctor.')}</div>`;
    
    adviceDiv.innerHTML = msg;
    adviceDiv.classList.remove('hidden');
    
    const count = document.querySelectorAll('.equipped').length;
    document.getElementById('status-title').innerText = t("é˜²è­·ç­‰ç´š: ", "Level: ") + count;
    document.getElementById('status-msg').innerText = count > 2 ? t("é˜²è­·ç¶²å¾ˆå¼·ï¼", "Strong Protection!") : t("åŠ æ²¹ï¼Œå»ºç«‹é˜²è­·ï¼", "Keep building armor!");
}

// Utils
function setOption(id, val, btn) {
    document.getElementById(id).value = val;
    btn.parentElement.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    updateAllRisks();
}
function checkHFSymptoms(show) {
    document.getElementById('hf-check-box').classList.toggle('hidden', !show);
}
function symAlert() {
    const chk = document.querySelectorAll('.sym-check:checked').length;
    const alert = document.getElementById('sym-alert');
    if(chk > 0) { alert.innerText = i18nData[curLang].hf.alert; alert.classList.remove('hidden'); }
    else alert.classList.add('hidden');
}
function showHelp(id) {
    document.getElementById('help-modal').style.display = 'flex';
    document.querySelectorAll('.help-content').forEach(d => d.classList.add('hidden'));
    document.getElementById('help-'+id).classList.remove('hidden');
}
function closeHelp() { document.getElementById('help-modal').style.display = 'none'; }
function clearUserData() { location.reload(); }

// Init
window.onload = () => {
    initFoodSearch();
    updateAllRisks();
};
</script>
</body>
</html>
