<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title data-i18n="app_title">ä¿è…è­·å¿ƒåŠ©ç†</title>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <style>
        :root {
            --primary: #009045; --primary-dark: #007035; --accent: #F58220;
            --heart: #e91e63; --heart-light: #fce4ec; 
            --bg: #fdfdfd; --white: #ffffff; --text: #222;
            --risk-g: #6bbd45; --risk-y: #ffd700; --risk-o: #f58220; --risk-r: #e03e2e;
            --nav-height: 85px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background: var(--bg); margin: 0; padding: 0; padding-bottom: calc(var(--nav-height) + 20px); 
            color: var(--text); font-size: 19px; line-height: 1.5; user-select: none; 
        }
        
        /* Header & Lang Switcher */
        header { 
            background: var(--white); padding: 12px 10px; border-radius: 0 0 25px 25px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        header::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 6px;
            background: linear-gradient(90deg, var(--primary) 30%, var(--heart) 70%);
        }
        .header-logo { height: 40px; width: auto; object-fit: contain; }
        .header-title-box { text-align: center; flex: 1; padding: 0 5px; }
        .header-title-box h1 { margin: 0; font-size: 1.4rem; color: var(--primary); font-weight: 900; line-height: 1.1; }
        
        .lang-control { margin-left: 5px; }
        #lang-select { 
            padding: 6px 4px; border-radius: 10px; border: 1px solid var(--primary); 
            font-size: 0.85rem; font-weight: bold; color: var(--primary); outline: none;
        }

        /* Container & Cards */
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--white); border-radius: 20px; padding: 25px 20px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; border: 1px solid #eee; }
        .card h2 { margin-top: 0; color: var(--primary); font-size: 1.5rem; font-weight: 900; border-bottom: 3px solid #f0f4f8; padding-bottom: 15px; margin-bottom: 20px; }

        /* Inputs & Buttons UI */
        .input-group { margin-bottom: 25px; text-align: left; }
        .input-group label { display: block; font-size: 1.1rem; color: #444; margin-bottom: 8px; font-weight: 900; }
        
        .select-wrapper { position: relative; width: 100%; }
        select { 
            width: 100%; padding: 18px; border: 2px solid #ccc; border-radius: 15px; 
            font-size: 1.1rem; background: #fff; outline: none; font-weight: bold; color: #222;
            -webkit-appearance: none; appearance: none; cursor: pointer;
        }
        .select-wrapper::after { 
            content: 'â–¼'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); 
            color: #444; pointer-events: none; font-size: 1.2rem; 
        }
        
        /* Pill Buttons */
        .option-group { display: flex; gap: 8px; width: 100%; flex-wrap: wrap; }
        .option-btn {
            flex: 1; min-width: 80px; padding: 12px 5px; 
            border: 2px solid #ddd; border-radius: 15px;
            background: #fff; color: #666;
            font-size: 1rem; font-weight: 900;
            text-align: center; cursor: pointer;
            transition: all 0.2s; user-select: none;
            display: flex; align-items: center; justify-content: center;
        }
        .option-btn.active {
            border-color: var(--primary); background-color: #e8f5e9;
            color: var(--primary); box-shadow: 0 4px 10px rgba(0, 144, 69, 0.2);
        }

        /* Buttons (General) */
        .btn { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; 
            border: none; padding: 18px; width: 100%; border-radius: 18px; 
            font-size: 1.2rem; font-weight: 900; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; 
            text-decoration: none; margin-bottom: 15px; transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.97); }

        /* Risk Matrix & Banner */
        .risk-matrix { display: grid; grid-template-columns: 70px 1fr 1fr 1fr; gap: 3px; margin: 25px auto; background: #fff; font-size: 0.8rem; }
        .matrix-cell { display: flex; align-items: center; justify-content: center; text-align: center; padding: 2px; border-radius: 6px; font-weight: bold; color: rgba(0,0,0,0.1); height: 45px; }
        .matrix-header { background: #f4f4f4; color: #444; font-weight: 900; padding: 5px 0; }
        .matrix-label { background: #f4f4f4; color: #444; font-weight: 900; display: flex; align-items: center; justify-content: center; text-align: center; }
        .bg-g { background-color: var(--risk-g); } .bg-y { background-color: var(--risk-y); } .bg-o { background-color: var(--risk-o); } .bg-r { background-color: var(--risk-r); }
        .active-cell { border: 4px solid #0044cc !important; transform: scale(1.05); z-index: 5; }

        .risk-banner { padding: 20px; border-radius: 15px; color: white; text-align: center; margin-bottom: 20px; }

        /* Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; justify-content: space-around; align-items: center; border-top: 2px solid #ccc; z-index: 1000; }
        .nav-item { text-align: center; color: #999; font-size: 0.85rem; flex: 1; padding: 5px; cursor: pointer; font-weight: 900; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 1.8rem; display: block; margin-bottom: 4px; }

        .hidden { display: none !important; }

        /* Symptoms & Status */
        .symptom-box { background: #fff5f8; border: 2px dashed #f8bbd0; border-radius: 15px; padding: 15px; margin-top: 15px; }
        .status-panel { display: flex; align-items: center; padding: 15px; border-radius: 15px; margin-top: 20px; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .status-icon { font-size: 2.5rem; margin-right: 15px; }
        
        /* Equip Grid */
        .equip-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0; }
        .equip-slot { background: #fff; border: 2px dashed #ccc; border-radius: 15px; padding: 12px 8px; text-align: center; cursor: pointer; min-height: 120px; display: flex; flex-direction: column; justify-content: center; position: relative; }
        .equip-slot.equipped { border-style: solid; border-width: 3px; border-color: var(--primary); }
        .equip-slot.equipped::after { content: 'âœ“'; position: absolute; top: 5px; right: 8px; color: var(--primary); font-weight: bold; }
        .equip-name { font-weight: 900; font-size: 0.95rem; display: block; }
        .equip-desc { font-size: 0.8rem; color: #666; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; }
        .modal-content { background: #fff; padding: 25px; width: 90%; max-width: 500px; border-radius: 20px; position: relative; max-height: 80vh; overflow-y: auto; }
    </style>
</head>
<body>

<header>
    <img src="logo_left.png" alt="Hospital" class="header-logo">
    <div class="header-title-box">
        <h1 data-i18n="header_title">ä¿è…è­·å¿ƒåŠ©ç†</h1>
    </div>
    <div class="lang-control">
        <select id="lang-select" onchange="changeLang(this.value)">
            <option value="zh">ç¹ä¸­</option>
            <option value="en">EN</option>
            <option value="id">ID (å°å°¼)</option>
            <option value="vi">VI (è¶Š)</option>
        </select>
    </div>
</header>

<div class="container">

    <div id="tab-home" class="section active">
        <div class="card">
            <h2 data-i18n="home_card_title">ğŸ“Š é¢¨éšªè©•ä¼°</h2>
            
            <div class="input-group">
                <label data-i18n="label_age">1. å¹´é½¡</label>
                <div class="select-wrapper">
                    <select id="kfre-age" onchange="updateAll()">
                        <option value="" disabled selected data-i18n="opt_placeholder">è«‹é¸æ“‡...</option>
                        <option value="20">20-29</option><option value="30">30-39</option><option value="40">40-49</option>
                        <option value="50">50-59</option><option value="60">60-69</option><option value="70">70-79</option>
                        <option value="80">80-89</option><option value="90">90+</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label data-i18n="label_sex">2. æ€§åˆ¥</label>
                <div class="option-group" id="group-sex">
                    <div class="option-btn" onclick="setOpt('kfre-sex', '1', this)" data-i18n="opt_male">ç”·</div>
                    <div class="option-btn" onclick="setOpt('kfre-sex', '0', this)" data-i18n="opt_female">å¥³</div>
                </div>
                <input type="hidden" id="kfre-sex" onchange="updateAll()">
            </div>

            <div class="input-group">
                <label>3. eGFR (è…çµ²çƒéæ¿¾ç‡)</label>
                <div class="select-wrapper">
                    <select id="kfre-egfr" onchange="updateAll()">
                        <option value="" disabled selected data-i18n="opt_placeholder">è«‹é¸æ“‡...</option>
                        <option value="90">â‰¥ 90</option><option value="75">60-89</option>
                        <option value="52">45-59</option><option value="37">30-44</option>
                        <option value="22">15-29</option><option value="10">< 15</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>4. UACR (å°¿è›‹ç™½ç‹€æ³)</label>
                <div class="option-group" id="group-uacr">
                    <div class="option-btn" onclick="setOpt('kfre-uacr', '10', this)"><30</div>
                    <div class="option-btn" onclick="setOpt('kfre-uacr', '150', this)">30-300</div>
                    <div class="option-btn" onclick="setOpt('kfre-uacr', '500', this)">>300</div>
                </div>
                <input type="hidden" id="kfre-uacr" onchange="updateAll()">
            </div>

            <div class="input-group">
                <label data-i18n="label_dm">5. ç³–å°¿ç—… (DM)</label>
                <div class="option-group">
                    <div class="option-btn" onclick="setOpt('kfre-dm', '0', this)" data-i18n="opt_no">ç„¡</div>
                    <div class="option-btn" onclick="setOpt('kfre-dm', '1', this)" data-i18n="opt_yes">æœ‰</div>
                </div>
                <input type="hidden" id="kfre-dm" onchange="updateAll()">
            </div>

            <div class="input-group">
                <label data-i18n="label_hf">6. å¿ƒè¡°ç«­ (HF)</label>
                <div class="option-group">
                    <div class="option-btn" onclick="setOpt('kfre-hf', '0', this); toggleHF(false)" data-i18n="opt_no">ç„¡</div>
                    <div class="option-btn" onclick="setOpt('kfre-hf', '1', this); toggleHF(true)" data-i18n="opt_yes">æœ‰</div>
                </div>
                <input type="hidden" id="kfre-hf" onchange="updateAll()">
                
                <div id="hf-check" class="symptom-box hidden">
                    <p style="color:#c2185b; font-weight:bold;" data-i18n="hf_symptom_title">ğŸ” ç—‡ç‹€è‡ªæˆ‘æª¢æŸ¥ï¼š</p>
                    <label><input type="checkbox"> <span data-i18n="hf_sym1">ä¸‹è‚¢æ°´è…«</span></label><br>
                    <label><input type="checkbox"> <span data-i18n="hf_sym2">å¹³èººæœƒå–˜</span></label>
                </div>
            </div>

            <div id="result-area" class="hidden" style="margin-top:30px;">
                <div id="risk-banner" class="risk-banner">
                    <h3 id="risk-title">--</h3>
                    <p id="risk-desc">--</p>
                </div>
                
                <div class="risk-matrix">
                    <div class="matrix-header"></div><div class="matrix-header"><30</div><div class="matrix-header">30-299</div><div class="matrix-header">>300</div>
                    <div class="matrix-label">>90</div><div class="matrix-cell bg-g" id="c-1-1"></div><div class="matrix-cell bg-g" id="c-1-2"></div><div class="matrix-cell bg-o" id="c-1-3"></div>
                    <div class="matrix-label">60-89</div><div class="matrix-cell bg-g" id="c-2-1"></div><div class="matrix-cell bg-g" id="c-2-2"></div><div class="matrix-cell bg-o" id="c-2-3"></div>
                    <div class="matrix-label">45-59</div><div class="matrix-cell bg-y" id="c-3a-1"></div><div class="matrix-cell bg-o" id="c-3a-2"></div><div class="matrix-cell bg-r" id="c-3a-3"></div>
                    <div class="matrix-label">30-44</div><div class="matrix-cell bg-o" id="c-3b-1"></div><div class="matrix-cell bg-r" id="c-3b-2"></div><div class="matrix-cell bg-r" id="c-3b-3"></div>
                    <div class="matrix-label">15-29</div><div class="matrix-cell bg-r" id="c-4-1"></div><div class="matrix-cell bg-r" id="c-4-2"></div><div class="matrix-cell bg-r" id="c-4-3"></div>
                    <div class="matrix-label"><15</div><div class="matrix-cell bg-r" id="c-5-1"></div><div class="matrix-cell bg-r" id="c-5-2"></div><div class="matrix-cell bg-r" id="c-5-3"></div>
                </div>

                <div style="background:#e1f5fe; padding:15px; border-radius:15px; border:2px solid #b3e5fc;">
                    <p style="font-weight:900; color:#01579b;" data-i18n="kfre_title">ğŸ“… æœªä¾†æ´—è…é¢¨éšªé æ¸¬</p>
                    <div style="display:flex; justify-content:space-around;">
                        <div><small data-i18n="kfre_2yr">2å¹´å…§</small><br><span id="res-2yr" style="font-size:1.8rem; font-weight:900;">--</span></div>
                        <div><small data-i18n="kfre_5yr">5å¹´å…§</small><br><span id="res-5yr" style="font-size:1.8rem; font-weight:900;">--</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-meds" class="section">
        <div class="card">
            <h2 data-i18n="nav_meds">ğŸ’Š ç”¨è—¥å»ºè­°</h2>
            <div id="med-list" class="hidden" style="text-align:left;">
                </div>
            <div id="med-empty" data-i18n="empty_hint">è«‹å…ˆå®Œæˆé¦–é è©•ä¼°</div>
        </div>

        <div class="card" style="border:3px solid #ff9800; background:#fffde7;">
            <h2 style="color:#e65100;" data-i18n="sickday_title">ğŸ¤¢ ç”Ÿç—…æ—¥åœè—¥å®ˆå‰‡</h2>
            <p style="font-size:0.9rem; color:#666;" data-i18n="sickday_desc">è„«æ°´ã€è…¹ç€‰ã€é«˜ç‡’æ™‚ï¼Œè«‹è«®è©¢é†«ç™‚äººå“¡æ˜¯å¦æš«åœï¼š</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
                <div class="option-btn" style="border-color:#ffcc80; height:auto; flex-direction:column;">
                    <span style="font-size:1.5rem;">ğŸ¬</span>
                    <span style="font-size:0.8rem;">SGLT2i / Metformin</span>
                </div>
                <div class="option-btn" style="border-color:#ffcc80; height:auto; flex-direction:column;">
                    <span style="font-size:1.5rem;">ğŸ©¸</span>
                    <span style="font-size:0.8rem;">ACEi / ARB</span>
                </div>
                <div class="option-btn" style="border-color:#ffcc80; height:auto; flex-direction:column;">
                    <span style="font-size:1.5rem;">ğŸ’§</span>
                    <span style="font-size:0.8rem;">Diuretics</span>
                </div>
                <div class="option-btn" style="border-color:#ffcc80; height:auto; flex-direction:column;">
                    <span style="font-size:1.5rem;">ğŸ’Š</span>
                    <span style="font-size:0.8rem;">NSAIDs</span>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-diet" class="section">
        <div class="card">
            <h2 data-i18n="nav_diet">ğŸ¥¦ é£²é£ŸæŒ‡å—</h2>
            <div id="diet-content" class="hidden" style="text-align:left;">
                <div style="background:#f1f8e9; padding:15px; border-radius:15px; border-left:6px solid #4caf50; margin-bottom:15px;">
                    <p style="margin:0; font-weight:900; color:#2e7d32;" data-i18n="diet_protein_title">ğŸ¥© è›‹ç™½è³ªå»ºè­°</p>
                    <span id="diet-protein-val" style="font-size:2rem; font-weight:900;">--</span> g/kg/day
                </div>
                <ul id="diet-list" style="padding-left:20px; line-height:2;">
                    </ul>
            </div>
            <div id="diet-empty" data-i18n="empty_hint">è«‹å…ˆå®Œæˆé¦–é è©•ä¼°</div>
            <img src="CKD_diet.png" style="width:100%; margin-top:20px; border-radius:15px;">
        </div>
    </div>

    <div id="tab-armor" class="section">
        <div class="card">
            <h2 data-i18n="armor_title">ğŸ›¡ï¸ è­·è…é˜²ç¦¦æª¢æŸ¥</h2>
            <p style="font-size:0.9rem;" data-i18n="armor_desc">è«‹å‹¾é¸æ‚¨æ­£åœ¨æœç”¨çš„è—¥ç‰©ï¼Œæª¢è¦–ä¿è­·åŠ›ï¼š</p>
            
            <div class="equip-grid">
                <div class="equip-slot" id="slot-sglt2" onclick="toggleEquip('drug-sglt2', this)">
                    <span class="equip-name">SGLT2i</span>
                    <span class="equip-desc" data-i18n="gear_sglt2">æ’ç³–è—¥</span>
                    <input type="checkbox" id="drug-sglt2" class="hidden">
                </div>
                <div class="equip-slot" id="slot-rasi" onclick="toggleEquip('drug-rasi', this)">
                    <span class="equip-name">ACEi / ARB</span>
                    <span class="equip-desc" data-i18n="gear_rasi">è¡€å£“è—¥</span>
                    <input type="checkbox" id="drug-rasi" class="hidden">
                </div>
                <div class="equip-slot" id="slot-statin" onclick="toggleEquip('drug-statin', this)">
                    <span class="equip-name">Statins</span>
                    <span class="equip-desc" data-i18n="gear_statin">é™è¡€è„‚</span>
                    <input type="checkbox" id="drug-statin" class="hidden">
                </div>
                <div class="equip-slot" id="slot-hf" style="display:none;" onclick="toggleEquip('drug-arni', this)">
                    <span class="equip-name">ARNI / BB</span>
                    <span class="equip-desc" data-i18n="gear_hf">å¿ƒè¡°ç«­å°ˆç”¨</span>
                    <input type="checkbox" id="drug-arni" class="hidden">
                </div>
            </div>

            <div id="status-panel" class="status-panel" style="background: #78909c;">
                <div class="status-icon">ğŸ›¡ï¸</div>
                <div style="text-align:left;">
                    <div id="status-title" style="font-weight:900; font-size:1.2rem;" data-i18n="status_0">å°šæœªå»ºç«‹é˜²è­·</div>
                    <div id="status-msg" style="font-size:0.85rem;" data-i18n="status_msg_0">è«‹è«®è©¢è—¥å¸«æˆ–é†«å¸«å»ºç«‹æ ¸å¿ƒæ²»ç™‚ã€‚</div>
                </div>
            </div>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home')"><span class="nav-icon">ğŸ </span><span data-i18n="nav_home">é¦–é </span></div>
    <div class="nav-item" onclick="switchTab('meds')"><span class="nav-icon">ğŸ’Š</span><span data-i18n="nav_meds">ç”¨è—¥</span></div>
    <div class="nav-item" onclick="switchTab('diet')"><span class="nav-icon">ğŸ¥¦</span><span data-i18n="nav_diet">é£²é£Ÿ</span></div>
    <div class="nav-item" onclick="switchTab('armor')"><span class="nav-icon">ğŸ›¡ï¸</span><span data-i18n="nav_armor">é˜²ç¦¦</span></div>
</nav>

<script>
    // --- ğŸŒ i18n Translations ---
    const translations = {
        zh: {
            app_title: "ä¿è…è­·å¿ƒåŠ©ç†",
            header_title: "ä¿è…è­·å¿ƒåŠ©ç†",
            nav_home: "é¦–é ", nav_meds: "ç”¨è—¥", nav_diet: "é£²é£Ÿ", nav_armor: "é˜²ç¦¦",
            home_card_title: "ğŸ“Š é¢¨éšªè©•ä¼°",
            label_age: "1. å¹´é½¡", label_sex: "2. æ€§åˆ¥", label_dm: "5. ç³–å°¿ç—…", label_hf: "6. å¿ƒè¡°ç«­",
            opt_placeholder: "è«‹é¸æ“‡...", opt_male: "ç”·", opt_female: "å¥³", opt_yes: "æœ‰", opt_no: "ç„¡",
            hf_symptom_title: "ğŸ” ç—‡ç‹€è‡ªæˆ‘æª¢æŸ¥ï¼š", hf_sym1: "ä¸‹è‚¢æ°´è…«", hf_sym2: "å¹³èººæœƒå–˜",
            kfre_title: "ğŸ“… æœªä¾†æ´—è…é¢¨éšªé æ¸¬", kfre_2yr: "2å¹´å…§", kfre_5yr: "5å¹´å…§",
            risk_low: "ä½é¢¨éšª", risk_med: "ä¸­åº¦é¢¨éšª", risk_high: "é«˜é¢¨éšª", risk_vhigh: "è¶…é«˜é¢¨éšª",
            empty_hint: "è«‹å…ˆå®Œæˆé¦–é è©•ä¼°",
            sickday_title: "ğŸ¤¢ ç”Ÿç—…æ—¥åœè—¥å®ˆå‰‡", sickday_desc: "è„«æ°´ã€è…¹ç€‰ã€é«˜ç‡’æ™‚ï¼Œè«‹è«®è©¢é†«ç™‚äººå“¡æ˜¯å¦æš«åœï¼š",
            diet_protein_title: "ğŸ¥© è›‹ç™½è³ªå»ºè­°",
            armor_title: "ğŸ›¡ï¸ è­·è…é˜²ç¦¦æª¢æŸ¥", armor_desc: "è«‹å‹¾é¸æ‚¨æ­£åœ¨æœç”¨çš„è—¥ç‰©ï¼Œæª¢è¦–ä¿è­·åŠ›ï¼š",
            gear_sglt2: "æ’ç³–è—¥", gear_rasi: "åŸºç¤è¡€å£“è—¥", gear_statin: "é™è¡€è„‚", gear_hf: "å¿ƒè¡°ç«­æ•‘å‘½è—¥",
            status_0: "å°šæœªå»ºç«‹é˜²è­·", status_1: "åˆæ­¥é˜²ç¦¦", status_2: "é€²éšä¿è­·", status_3: "å®Œæ•´é˜²è­·ç¶²",
            status_msg_0: "è«‹è«®è©¢è—¥å¸«å»ºç«‹æ ¸å¿ƒæ²»ç™‚ã€‚", status_msg_1: "å¾ˆå¥½ï¼Œå·²é–‹å§‹åŸºç¤ä¿è­·ã€‚", status_msg_2: "é˜²è­·åŠ›å¼·ï¼ŒæŒçºŒç¶­æŒã€‚", status_msg_3: "å®Œç¾ï¼å¿ƒè…å¾—åˆ°æ¥µè‡´ä¿è­·ã€‚"
        },
        en: {
            app_title: "Kidney & Heart Care",
            header_title: "Kidney & Heart Assistant",
            nav_home: "Home", nav_meds: "Meds", nav_diet: "Diet", nav_armor: "Armor",
            home_card_title: "ğŸ“Š Risk Assessment",
            label_age: "1. Age", label_sex: "2. Sex", label_dm: "5. Diabetes", label_hf: "6. Heart Failure",
            opt_placeholder: "Select...", opt_male: "Male", opt_female: "Female", opt_yes: "Yes", opt_no: "No",
            hf_symptom_title: "ğŸ” Symptom Check:", hf_sym1: "Swollen legs", hf_sym2: "Short of breath",
            kfre_title: "ğŸ“… Kidney Failure Risk (KFRE)", kfre_2yr: "In 2 yrs", kfre_5yr: "In 5 yrs",
            risk_low: "Low Risk", risk_med: "Moderate Risk", risk_high: "High Risk", risk_vhigh: "Very High Risk",
            empty_hint: "Please complete assessment first",
            sickday_title: "ğŸ¤¢ Sick Day Rules", sickday_desc: "If dehydrated, fever or diarrhea, consult to stop:",
            diet_protein_title: "ğŸ¥© Protein Goal",
            armor_title: "ğŸ›¡ï¸ Defense Checker", armor_desc: "Check your current medications to see your defense:",
            gear_sglt2: "SGLT2i (Sugar-out)", gear_rasi: "ACEi/ARB (BP)", gear_statin: "Statins (Lipid)", gear_hf: "HF Therapy",
            status_0: "No Defense", status_1: "Basic Defense", status_2: "Advanced Protection", status_3: "Full Shield",
            status_msg_0: "Consult your doctor for core therapy.", status_msg_1: "Good, basic protection started.", status_msg_2: "Strong protection, keep going.", status_msg_3: "Perfect! Heart & Kidney are safe."
        },
        id: {
            app_title: "Asisten Ginjal & Jantung",
            header_title: "Asisten Ginjal & Jantung",
            nav_home: "Beranda", nav_meds: "Obat", nav_diet: "Diet", nav_armor: "Pertahanan",
            home_card_title: "ğŸ“Š Penilaian Risiko",
            label_age: "1. Usia", label_sex: "2. Jenis Kelamin", label_dm: "5. Diabetes (Gula)", label_hf: "6. Gagal Jantung",
            opt_placeholder: "Pilih...", opt_male: "Pria", opt_female: "Wanita", opt_yes: "Ada", opt_no: "Tidak",
            hf_symptom_title: "ğŸ” Cek Gejala:", hf_sym1: "Kaki bengkak", hf_sym2: "Sesak napas saat berbaring",
            kfre_title: "ğŸ“… Risiko Gagal Ginjal", kfre_2yr: " dlm 2 thn", kfre_5yr: " dlm 5 thn",
            risk_low: "Risiko Rendah", risk_med: "Risiko Sedang", risk_high: "Risiko Tinggi", risk_vhigh: "Risiko Sangat Tinggi",
            empty_hint: "Harap isi penilaian dulu",
            sickday_title: "ğŸ¤¢ Aturan Saat Sakit", sickday_desc: "Jika demam, diare, atau kurang cairan, tanyakan dokter untuk stop:",
            diet_protein_title: "ğŸ¥© Saran Protein",
            armor_title: "ğŸ›¡ï¸ Cek Pertahanan", armor_desc: "Centang obat yang Anda minum:",
            gear_sglt2: "Obat Gula (SGLT2i)", gear_rasi: "Obat Tensi (ACEi/ARB)", gear_statin: "Obat Kolesterol", gear_hf: "Obat Gagal Jantung",
            status_0: "Belum Ada Pertahanan", status_1: "Pertahanan Awal", status_2: "Perlindungan Lanjut", status_3: "Pertahanan Sempurna",
            status_msg_0: "Konsultasikan dengan apoteker/dokter.", status_msg_1: "Bagus, perlindungan dasar dimulai.", status_msg_2: "Perlindungan kuat, pertahankan.", status_msg_3: "Sempurna! Jantung & Ginjal terlindungi."
        },
        vi: {
            app_title: "Trá»£ lÃ½ Tháº­n & Tim",
            header_title: "Trá»£ lÃ½ Tháº­n & Tim",
            nav_home: "Trang chá»§", nav_meds: "Thuá»‘c", nav_diet: "Ä‚n uá»‘ng", nav_armor: "PhÃ²ng vá»‡",
            home_card_title: "ğŸ“Š ÄÃ¡nh giÃ¡ rá»§i ro",
            label_age: "1. Tuá»•i", label_sex: "2. Giá»›i tÃ­nh", label_dm: "5. Tiá»ƒu Ä‘Æ°á»ng", label_hf: "6. Suy tim",
            opt_placeholder: "Chá»n...", opt_male: "Nam", opt_female: "Ná»¯", opt_yes: "CÃ³", opt_no: "KhÃ´ng",
            hf_symptom_title: "ğŸ” Kiá»ƒm tra triá»‡u chá»©ng:", hf_sym1: "PhÃ¹ chÃ¢n", hf_sym2: "KhÃ³ thá»Ÿ khi náº±m",
            kfre_title: "ğŸ“… Dá»± Ä‘oÃ¡n rá»§i ro cháº¡y tháº­n", kfre_2yr: "Trong 2 nÄƒm", kfre_5yr: "Trong 5 nÄƒm",
            risk_low: "Rá»§i ro tháº¥p", risk_med: "Rá»§i ro trung bÃ¬nh", risk_high: "Rá»§i ro cao", risk_vhigh: "Rá»§i ro ráº¥t cao",
            empty_hint: "Vui lÃ²ng hoÃ n thÃ nh Ä‘Ã¡nh giÃ¡",
            sickday_title: "ğŸ¤¢ Quy táº¯c khi bá»‹ bá»‡nh", sickday_desc: "Náº¿u máº¥t nÆ°á»›c, sá»‘t hoáº·c tiÃªu cháº£y, hÃ£y há»i bÃ¡c sÄ© Ä‘á»ƒ dá»«ng:",
            diet_protein_title: "ğŸ¥© Gá»£i Ã½ Protein",
            armor_title: "ğŸ›¡ï¸ Kiá»ƒm tra phÃ²ng vá»‡", armor_desc: "ÄÃ¡nh dáº¥u loáº¡i thuá»‘c báº¡n Ä‘ang uá»‘ng:",
            gear_sglt2: "Thuá»‘c tiá»ƒu Ä‘Æ°á»ng (SGLT2i)", gear_rasi: "Thuá»‘c huyáº¿t Ã¡p (ACEi/ARB)", gear_statin: "Thuá»‘c má»¡ mÃ¡u", gear_hf: "Thuá»‘c suy tim",
            status_0: "ChÆ°a cÃ³ phÃ²ng vá»‡", status_1: "PhÃ²ng vá»‡ ban Ä‘áº§u", status_2: "Báº£o vá»‡ nÃ¢ng cao", status_3: "PhÃ²ng vá»‡ hoÃ n háº£o",
            status_msg_0: "HÃ£y há»i dÆ°á»£c sÄ© hoáº·c bÃ¡c sÄ©.", status_msg_1: "Tá»‘t, Ä‘Ã£ báº¯t Ä‘áº§u báº£o vá»‡ cÆ¡ báº£n.", status_msg_2: "Báº£o vá»‡ máº¡nh máº½, hÃ£y duy trÃ¬.", status_msg_3: "HoÃ n háº£o! Tim & Tháº­n Ä‘Æ°á»£c báº£o vá»‡ tá»‘i Ä‘a."
        }
    };

    let currentLang = 'zh';

    function changeLang(lang) {
        currentLang = lang;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (translations[lang][key]) {
                if (el.tagName === 'INPUT' && el.type === 'placeholder') el.placeholder = translations[lang][key];
                else el.innerText = translations[lang][key];
            }
        });
        updateAll(); // Refresh results with new language
    }

    // --- âš™ï¸ Logic Functions ---
    function switchTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');
        window.scrollTo(0,0);
    }

    function setOpt(id, val, btn) {
        document.getElementById(id).value = val;
        btn.parentElement.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        updateAll();
    }

    function toggleHF(show) {
        document.getElementById('hf-check').className = show ? 'symptom-box' : 'hidden';
        document.getElementById('slot-hf').style.display = show ? 'flex' : 'none';
    }

    function updateAll() {
        const age = parseFloat(document.getElementById('kfre-age').value);
        const sex = document.getElementById('kfre-sex').value;
        const egfr = parseFloat(document.getElementById('kfre-egfr').value);
        const uacr = parseFloat(document.getElementById('kfre-uacr').value);
        if (isNaN(age) || sex === "" || isNaN(egfr) || isNaN(uacr)) return;

        document.getElementById('result-area').classList.remove('hidden');

        // Matrix update
        document.querySelectorAll('.matrix-cell').forEach(c => c.classList.remove('active-cell'));
        let row = egfr >= 90 ? '1' : egfr >= 60 ? '2' : egfr >= 45 ? '3a' : egfr >= 30 ? '3b' : egfr >= 15 ? '4' : '5';
        let col = uacr >= 300 ? '3' : uacr >= 30 ? '2' : '1';
        const activeCell = document.getElementById(`c-${row}-${col}`);
        activeCell.classList.add('active-cell');

        // Risk Banner
        let riskText = translations[currentLang].risk_vhigh, riskColor = 'var(--risk-r)';
        if (activeCell.classList.contains('bg-g')) { riskText = translations[currentLang].risk_low; riskColor = 'var(--risk-g)'; }
        else if (activeCell.classList.contains('bg-y')) { riskText = translations[currentLang].risk_med; riskColor = 'var(--risk-y)'; }
        else if (activeCell.classList.contains('bg-o')) { riskText = translations[currentLang].risk_high; riskColor = 'var(--risk-o)'; }
        
        const banner = document.getElementById('risk-banner');
        banner.style.background = riskColor;
        document.getElementById('risk-title').innerText = riskText;
        document.getElementById('risk-desc').innerText = `eGFR: ${egfr} / UACR: ${uacr}`;

        // KFRE (Simplified formula)
        const logACR = Math.log(uacr);
        const score = -0.22 * (age/10) + 0.24 * (parseFloat(sex)) - 0.55 * (egfr/5) + 0.45 * logACR;
        document.getElementById('res-2yr').innerText = (Math.min(99, Math.max(0, (score + 10) * 2))).toFixed(1) + "%";
        document.getElementById('res-5yr').innerText = (Math.min(99, Math.max(0, (score + 12) * 5))).toFixed(1) + "%";

        updateAdvice(egfr);
    }

    function updateAdvice(egfr) {
        document.getElementById('med-list').classList.remove('hidden');
        document.getElementById('med-empty').classList.add('hidden');
        document.getElementById('diet-content').classList.remove('hidden');
        document.getElementById('diet-empty').classList.add('hidden');

        // Protein
        const pVal = egfr < 45 ? "0.6 ~ 0.8" : "0.8 ~ 1.0";
        document.getElementById('diet-protein-val').innerText = pVal;

        // Simplified dynamic list demo
        const medList = document.getElementById('med-list');
        medList.innerHTML = `<div style="border-bottom:1px solid #eee; padding:10px 0;"><b>SGLT2i:</b> ${currentLang === 'zh' ? 'æ ¸å¿ƒè—¥ç‰©ï¼Œä¿è­·å¿ƒè…ã€‚' : 'Core drug to protect Heart & Kidney.'}</div>`;
        medList.innerHTML += `<div style="border-bottom:1px solid #eee; padding:10px 0;"><b>ACEi/ARB:</b> ${currentLang === 'zh' ? 'é™å£“æ§è›‹ç™½å°¿ã€‚' : 'Control BP & Proteinuria.'}</div>`;
    }

    function toggleEquip(id, el) {
        const cb = document.getElementById(id);
        cb.checked = !cb.checked;
        if(cb.checked) el.classList.add('equipped');
        else el.classList.remove('equipped');
        
        // Update Status
        const count = document.querySelectorAll('.equip-slot.equipped').length;
        const panel = document.getElementById('status-panel');
        const title = document.getElementById('status-title');
        const msg = document.getElementById('status-msg');

        if(count === 0) { 
            panel.style.background = "#78909c"; 
            title.innerText = translations[currentLang].status_0;
            msg.innerText = translations[currentLang].status_msg_0;
        } else if(count < 3) {
            panel.style.background = "#4caf50";
            title.innerText = translations[currentLang].status_1;
            msg.innerText = translations[currentLang].status_msg_1;
        } else {
            panel.style.background = "linear-gradient(135deg, #e91e63, #ff9800)";
            title.innerText = translations[currentLang].status_3;
            msg.innerText = translations[currentLang].status_msg_3;
        }
    }
</script>
</body>
</html>
