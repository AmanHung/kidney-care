<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è…åˆ©ç®¡å®¶ v4.8</title>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <style>
        :root {
            --primary: #009045;
            --primary-dark: #007035;
            --accent: #F58220;
            --bg: #f8fbf8;
            --white: #ffffff;
            --text: #333;
            --risk-g: #6bbd45; --risk-y: #ffd700; --risk-o: #f58220; --risk-r: #e03e2e;
            --nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; padding: 0; 
            padding-bottom: calc(var(--nav-height) + 20px); 
            color: var(--text); 
            font-size: 18px;
            line-height: 1.5;
            user-select: none; 
        }

        /* --- Header --- */
        header { 
            background: var(--white); padding: 10px 15px; border-radius: 0 0 25px 25px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        header::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, #009ADA 20%, var(--primary) 50%, var(--accent) 80%);
        }
        .header-logo { height: 45px; width: auto; object-fit: contain; }
        .header-title-box { text-align: center; flex: 1; padding: 0 5px; }
        .header-title-box h1 { margin: 0; font-size: 1.4rem; color: var(--primary); font-weight: 900; }
        .header-title-box p { margin: 0; color: #666; font-size: 0.9rem; }

        /* --- Container --- */
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--white); border-radius: 20px; padding: 20px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; border: 1px solid #eee; }
        .card h2 { margin-top: 0; color: var(--primary); font-size: 1.4rem; font-weight: 800; border-bottom: 2px solid #f0f4f8; padding-bottom: 10px; margin-bottom: 20px; }

        /* è¼¸å…¥é¸å–® */
        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; font-size: 1.1rem; color: #444; margin-bottom: 8px; font-weight: 900; }
        .select-wrapper { position: relative; }
        select { 
            width: 100%; padding: 15px; border: 2px solid #ccc; border-radius: 12px; 
            font-size: 1.2rem; background: #fff; outline: none; font-weight: bold; color: #222;
            -webkit-appearance: none; appearance: none;
        }
        .select-wrapper::after { 
            content: 'â–¼'; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); 
            color: #444; pointer-events: none; font-size: 1rem; 
        }
        select:focus { border-color: var(--primary); background: #f9fff9; }

        /* æŒ‰éˆ•å„ªåŒ– */
        .btn { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; 
            border: none; padding: 15px; width: 100%; border-radius: 15px; 
            font-size: 1.2rem; font-weight: 900; cursor: pointer; 
            box-shadow: 0 5px 15px rgba(0,144,69,0.3); display: flex; align-items: center; justify-content: center; 
            text-decoration: none; margin-bottom: 10px; transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.97); }
        .btn-outline { background: #fff; border: 2px solid var(--primary); color: var(--primary); box-shadow: none; }
        .btn-line { background: #06c755; box-shadow: 0 5px 15px rgba(6,199,85,0.3); }
        .btn-refill { background: linear-gradient(135deg, var(--accent), #e07010); box-shadow: 0 5px 15px rgba(245,130,32,0.3); }
        .btn-next { background: linear-gradient(135deg, var(--accent), #e07010); margin-top: 15px; box-shadow: 0 5px 15px rgba(245,130,32,0.3); }

        /* é¢¨éšªçŸ©é™£ */
        .risk-matrix { 
            display: grid; grid-template-columns: 55px 1fr 1fr 1fr; 
            gap: 2px; margin: 20px auto; background: #fff; font-size: 0.85rem; 
        }
        .matrix-cell { 
            display: flex; align-items: center; justify-content: center; text-align: center; 
            padding: 2px; border-radius: 4px; font-weight: bold; color: rgba(0,0,0,0.3); 
            height: 50px; position: relative; 
        }
        .matrix-header { background: #f4f4f4; color: #444; font-weight: 900; font-size: 0.8rem; padding: 5px 0; }
        .matrix-label { background: #f4f4f4; color: #444; font-weight: 900; font-size: 0.75rem; flex-direction: column; justify-content: center; display: flex; align-items: center; }
        
        .bg-g { background-color: var(--risk-g); }
        .bg-y { background-color: var(--risk-y); }
        .bg-o { background-color: var(--risk-o); }
        .bg-r { background-color: var(--risk-r); }
        
        .matrix-cell.active-cell { 
            border: 4px solid #0044cc; box-shadow: 0 0 15px rgba(0,68,204,0.6); 
            z-index: 10; transform: scale(1.1); 
        }

        .risk-banner {
            padding: 20px; margin-top: 20px; border-radius: 15px; color: white; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); animation: fadeIn 0.3s ease;
        }
        .risk-banner h3 { margin: 0; font-size: 1.8rem; font-weight: 900; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .risk-banner p { margin: 5px 0 0; font-size: 1.1rem; font-weight: bold; opacity: 0.95; }

        /* åˆ—è¡¨å¡ç‰‡ */
        .list-card { text-align: left; margin-bottom: 20px; border-radius: 15px; overflow: hidden; border: 1px solid #ddd; }
        .list-head { padding: 15px; font-weight: 900; color: white; font-size: 1.2rem; }
        .list-body { padding: 20px; font-size: 1.1rem; line-height: 1.6; background: #fff; }
        .list-item { margin-bottom: 12px; border-bottom: 1px dashed #ccc; padding-bottom: 12px; }
        .list-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .list-title { font-weight: 900; display: block; color: #222; }
        
        /* å°èˆªåˆ— */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #ccc; z-index: 1000; }
        .nav-item { text-align: center; color: #999; font-size: 0.85rem; flex: 1; padding: 5px; cursor: pointer; font-weight: bold; }
        .nav-item.active { color: var(--primary); }
        .nav-item.active .nav-icon { transform: scale(1.1); color: var(--primary); }
        .nav-icon { font-size: 1.8rem; display: block; margin-bottom: 2px; }

        .hidden { display: none; }
        
        /* è¨ˆæ•¸å™¨æ¨£å¼ */
        .page-counter { text-align: center; font-size: 1.2rem; color: #555; margin-top: 20px; margin-bottom: 20px; font-weight: 900; }

        /* å…¶ä»–å…ƒä»¶ */
        .plate-container { width: 220px; height: 220px; background: white; border-radius: 50%; border: 8px solid #eee; margin: 20px auto; display: flex; flex-wrap: wrap; overflow: hidden; }
        .plate-half { width: 50%; height: 100%; background: #d4edda; display: flex; align-items: center; justify-content: center; flex-direction: column; color: #155724; font-weight: bold; border-right: 2px solid white; }
        .plate-quarter-container { width: 50%; height: 100%; display: flex; flex-direction: column; }
        .plate-quarter { width: 100%; height: 50%; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; font-weight: bold; }
        .pq-protein { background: #f8d7da; color: #721c24; border-bottom: 1px solid white; }
        .pq-starch { background: #fff3cd; color: #856404; }
        .food-icon { font-size: 1.5rem; margin-bottom: 2px; }
        .qr-box { width: 200px; height: 200px; margin: 15px auto; border: 2px solid #eee; border-radius: 15px; }
        .qr-img { width: 100%; height: 100%; object-fit: contain; }
        .refill-box { display: flex; align-items: center; background: #fff8e1; border: 1px solid #ffe0b2; padding: 15px; border-radius: 15px; margin-bottom: 25px; gap: 15px; }
        .refill-icon { width: 70px; height: 70px; object-fit: contain; flex-shrink: 0; }
        .traffic-container { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .light { width: 60px; height: 60px; border-radius: 50%; background: #ddd; opacity: 0.2; transition: 0.3s; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        .light.on { opacity: 1; transform: scale(1.1); box-shadow: 0 0 20px currentColor; }
        .med-result-box { background: #e8f5e9; padding: 15px; border-radius: 12px; margin-top: 15px; text-align: left; border-left: 5px solid var(--primary); animation: fadeIn 0.3s ease; }

        /* æ¸¬é©—é¸é …ç¾åŒ– */
        .quiz-option { 
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #444;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
            position: relative;
            text-align: left;
        }
        .quiz-option:active { transform: scale(0.98); background: #f0f0f0; }
        .quiz-option.correct { border-color: #6bbd45; background: #f0fff4; color: #2e7d32; box-shadow: 0 0 10px rgba(107, 189, 69, 0.3); }
        .quiz-option.correct::after { content: 'âœ…'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 1.5rem; }
        .quiz-option.wrong { border-color: #e03e2e; background: #fff5f5; color: #c62828; opacity: 0.9; }
        .quiz-option.wrong::after { content: 'âŒ'; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 1.5rem; }
        .progress-bar { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin-bottom: 15px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<header>
    <img src="logo_left.png" alt="è±åŸé†«é™¢" class="header-logo" onerror="this.style.opacity='0.2'">
    <div class="header-title-box">
        <h1>è…åˆ©ç®¡å®¶</h1>
        <p>æ‚¨çš„å°ˆå±¬è­·è…å°å¹«æ‰‹</p>
    </div>
    <img src="logo_right_new.png" alt="äº”ç¦è—¥å¸«åœˆ" class="header-logo" onerror="this.style.opacity='0.2'">
</header>

<div class="container">

    <div id="tab-home" class="section active">
        <div class="card">
            <h2>ğŸ“Š æˆ‘çš„è…è‡ŸåŠŸèƒ½è©•ä¼°</h2>
            
            <div class="input-group">
                <label>1. è…åŠŸèƒ½ (eGFR)</label>
                <div class="select-wrapper">
                    <select id="egfr-input" onchange="calcRisk()">
                        <option value="" disabled selected>è«‹é»æ­¤é¸æ“‡å€é–“...</option>
                        <option value="90">æ­£å¸¸ (eGFR â‰¥ 90)</option>
                        <option value="60">ç¬¬2æœŸ (eGFR 60-89)</option>
                        <option value="45">ç¬¬3aæœŸ (eGFR 45-59)</option>
                        <option value="30">ç¬¬3bæœŸ (eGFR 30-44)</option>
                        <option value="15">ç¬¬4æœŸ (eGFR 15-29)</option>
                        <option value="5">ç¬¬5æœŸ (eGFR &lt; 15)</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>2. è›‹ç™½å°¿ç‹€æ³ (UACR)</label>
                <div class="select-wrapper">
                    <select id="albumin-input" onchange="calcRisk()">
                        <option value="A1" selected>æ­£å¸¸/è¼•å¾® (&lt;30)</option>
                        <option value="A2">å¾®é‡è›‹ç™½å°¿ (30-299)</option>
                        <option value="A3">åš´é‡è›‹ç™½å°¿ (>300)</option>
                    </select>
                </div>
            </div>

            <p id="start-hint" style="color:#888; font-size:1.1rem; margin-top:20px;">
                ğŸ‘† è«‹é¸æ“‡ä¸Šæ–¹æ•¸å€¼ï¼Œä¸‹æ–¹å°‡è‡ªå‹•é¡¯ç¤ºçµæœ
            </p>

            <div id="risk-result-area" class="hidden">
                <div id="risk-banner" class="risk-banner" style="background:#ccc;">
                    <h3 id="risk-title">--</h3>
                    <p id="risk-desc">--</p>
                </div>

                <div class="risk-matrix">
                    <div class="matrix-header"></div><div class="matrix-header">æ­£å¸¸<br><30</div><div class="matrix-header">å¾®é‡<br>30-299</div><div class="matrix-header">åš´é‡<br>>300</div>
                    <div class="matrix-label">ç¬¬1æœŸ<br>>90</div><div class="matrix-cell bg-g" id="cell-1-1"></div><div class="matrix-cell bg-g" id="cell-1-2"></div><div class="matrix-cell bg-o" id="cell-1-3"></div>
                    <div class="matrix-label">ç¬¬2æœŸ<br>60-89</div><div class="matrix-cell bg-g" id="cell-2-1"></div><div class="matrix-cell bg-g" id="cell-2-2"></div><div class="matrix-cell bg-o" id="cell-2-3"></div>
                    <div class="matrix-label">ç¬¬3a<br>45-59</div><div class="matrix-cell bg-y" id="cell-3a-1"></div><div class="matrix-cell bg-o" id="cell-3a-2"></div><div class="matrix-cell bg-r" id="cell-3a-3"></div>
                    <div class="matrix-label">ç¬¬3b<br>30-44</div><div class="matrix-cell bg-o" id="cell-3b-1"></div><div class="matrix-cell bg-r" id="cell-3b-2"></div><div class="matrix-cell bg-r" id="cell-3b-3"></div>
                    <div class="matrix-label">ç¬¬4æœŸ<br>15-29</div><div class="matrix-cell bg-r" id="cell-4-1"></div><div class="matrix-cell bg-r" id="cell-4-2"></div><div class="matrix-cell bg-r" id="cell-4-3"></div>
                    <div class="matrix-label">ç¬¬5æœŸ<br><15</div><div class="matrix-cell bg-r" id="cell-5-1"></div><div class="matrix-cell bg-r" id="cell-5-2"></div><div class="matrix-cell bg-r" id="cell-5-3"></div>
                </div>

                <p style="color:#d32f2f; font-weight:bold; margin-top:20px;">
                    ğŸ‘‡ æ‚¨çš„ç”¨è—¥èˆ‡é£²é£Ÿå»ºè­°å·²ç”Ÿæˆï¼Œè«‹é»é¸ä¸‹æ–¹æŒ‰éˆ•æŸ¥çœ‹ã€‚
                </p>
            </div>
        </div>
        <div class="page-counter">
            ğŸ‘€ æœ¬ç«™ç´¯è¨ˆç€è¦½ï¼š<span id="busuanzi_value_site_pv">--</span> äººæ¬¡
        </div>
    </div>

    <div id="tab-meds" class="section">
        <div class="card">
            <h2>ğŸ’Š å€‹äººåŒ–ç”¨è—¥å»ºè­°</h2>
            
            <div id="med-placeholder" style="padding:40px 10px; color:#999;">
                <div style="font-size:4rem;">ğŸ“‰</div>
                <p>è«‹å…ˆè‡³ã€Œé¦–é ã€é¸æ“‡è…åŠŸèƒ½<br>ç³»çµ±å°‡è‡ªå‹•ç”¢ç”Ÿå»ºè­°</p>
                <button class="btn btn-outline" onclick="switchTab('home')">å‰å¾€é¦–é </button>
            </div>

            <div id="med-content" class="hidden">
                <p style="background:#eee; padding:10px; border-radius:10px; color:#555;">
                    ä¾æ“šæ‚¨çš„ <strong>eGFR <span id="med-egfr-val">--</span></strong> åˆ†æï¼š
                </p>

                <div class="list-card" style="border-color: var(--risk-g);">
                    <div class="list-head" style="background: var(--risk-g);">ğŸŸ¢ å»ºè­°ç”¨è—¥ (æ”¾å¿ƒä½¿ç”¨)</div>
                    <div class="list-body" id="list-med-g"></div>
                </div>
                
                <div class="list-card" style="border-color: var(--risk-y);">
                    <div class="list-head" style="background: var(--risk-y); color:#333;">ğŸŸ¡ é ˆæ³¨æ„ (å°å¿ƒå‰¯ä½œç”¨)</div>
                    <div class="list-body" id="list-med-y"></div>
                </div>

                <div class="list-card" style="border-color: var(--risk-r);">
                    <div class="list-head" style="background: var(--risk-r);">ğŸ”´ ä¸å»ºè­°æœç”¨ (å‚·è…)</div>
                    <div class="list-body" id="list-med-r"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ğŸš¦ è—¥ç‰©å®‰å…¨ç´…ç¶ ç‡ˆ</h2>
            <p style="font-size: 0.9rem; color:#666;">ä¸ç¢ºå®šè—¥å“é¢¨éšªï¼Ÿè«‹åœ¨æ­¤æŸ¥è©¢</p>
            <div class="select-wrapper">
                <select id="med-select" onchange="checkMed()">
                    <option value="">ğŸ” è«‹é¸æ“‡æŸ¥è©¢é …ç›®...</option>
                    <optgroup label="ğŸ”´ å±éšª / ç¦æ­¢ / éœ€ç‰¹åˆ¥æ³¨æ„">
                        <option value="nsaid">å¼·æ•ˆæ­¢ç—›è—¥ (NSAIDs)</option>
                        <option value="herbal">ä¾†è·¯ä¸æ˜ä¸­è‰è—¥/é»‘è—¥ä¸¸</option>
                        <option value="contrast">å«ç¢˜é¡¯å½±åŠ‘ (æª¢æŸ¥)</option>
                        <option value="mycin">éƒ¨åˆ†æŠ—ç”Ÿç´  (Aminoglycosides)</option>
                        <option value="starfruit_j">æ¥Šæ¡ƒæ±/æ¥Šæ¡ƒä¹¾</option>
                        <option value="smoking">å¸è¸ (å°¼å¤ä¸)</option>
                        <option value="hold_urine">é•·æœŸæ†‹å°¿</option>
                    </optgroup>
                    <optgroup label="ğŸŸ¡ è¬¹æ… / éœ€ç›£æ¸¬ / é©é‡">
                        <option value="diuretic">åˆ©å°¿åŠ‘ (Diuretics)</option>
                        <option value="metformin">é™ç³–è—¥ (Metformin)</option>
                        <option value="vit_d">ç¶­ç”Ÿç´  D (éˆ£ç£·å¹³è¡¡)</option>
                        <option value="multi_vit">ç¶œåˆç¶­ä»–å‘½</option>
                        <option value="enema">æ¸…è…¸åŠ‘ (å¤§è…¸é¡)</option>
                        <option value="antacid">å«é‹èƒƒè—¥/åˆ¶é…¸åŠ‘</option>
                        <option value="dehydration">å–æ°´ä¸è¶³/è„«æ°´</option>
                        <option value="constipation">é•·æœŸä¾¿ç§˜</option>
                    </optgroup>
                    <optgroup label="ğŸŸ¢ æ¨è–¦ / å®‰å…¨ / è­·è…">
                        <option value="sglt2">æ’ç³–è—¥ (SGLT2i)</option>
                        <option value="ras">è¡€å£“è—¥ (ACEi/ARB)</option>
                        <option value="panadol">æ™®æ‹¿ç–¼ (Acetaminophen)</option>
                        <option value="probiotic">è…è‡Ÿå°ˆç”¨ç›Šç”ŸèŒ</option>
                        <option value="bp_check">æ¯æ—¥é‡è¡€å£“</option>
                        <option value="vaccine">ç–«è‹—æ¥ç¨® (æµæ„Ÿ/è‚ºéˆ)</option>
                    </optgroup>
                </select>
            </div>
            <div class="traffic-container">
                <div id="light-r" class="light" style="color: var(--danger); background: var(--danger);"></div>
                <div id="light-y" class="light" style="color: var(--warning); background: var(--warning);"></div>
                <div id="light-g" class="light" style="color: var(--success); background: var(--success);"></div>
            </div>
            <div id="med-result" class="med-result-box hidden"></div>
        </div>

        <div class="card">
            <h2>ğŸ” ä¸æ¸…æ¥šç”¨ä»€éº¼è—¥ï¼Ÿ</h2>
            <div style="display:flex; gap:15px;">
                <button class="btn" style="margin:0; flex:1;" onclick="switchTab('consult')">ğŸ’¬ è«®è©¢è—¥å¸«</button>
                <a href="https://www.fyh.mohw.gov.tw/?aid=519" target="_blank" class="btn btn-outline" style="margin:0; flex:1; display:flex; align-items:center; justify-content:center;">ğŸ¥ è—¥å“æŸ¥è©¢</a>
            </div>
        </div>
    </div>

    <div id="tab-diet" class="section">
        <div class="card">
            <h2>ğŸ½ï¸ å€‹äººåŒ–é£²é£Ÿå»ºè­°</h2>
            
            <div id="diet-placeholder" style="padding:40px 10px; color:#999;">
                <div style="font-size:4rem;">ğŸ¥£</div>
                <p>è«‹å…ˆè‡³ã€Œé¦–é ã€é¸æ“‡è…åŠŸèƒ½<br>ä»¥å–å¾—å°ˆå±¬é£²é£Ÿæ¸…å–®</p>
                <button class="btn btn-outline" onclick="switchTab('home')">å‰å¾€é¦–é </button>
            </div>

            <div id="diet-content" class="hidden">
                <div class="list-card" style="border-color: var(--risk-g);">
                    <div class="list-head" style="background: var(--risk-g);">ğŸŸ¢ å»ºè­°æ”å–</div>
                    <div class="list-body" id="list-diet-g"></div>
                </div>
                <div class="list-card" style="border-color: var(--risk-y);">
                    <div class="list-head" style="background: var(--risk-y); color:#333;">ğŸŸ¡ é ˆæ³¨æ„/æ¸›é‡</div>
                    <div class="list-body" id="list-diet-y"></div>
                </div>
                <div class="list-card" style="border-color: var(--risk-r);">
                    <div class="list-head" style="background: var(--risk-r);">ğŸ”´ ä¸å»ºè­°æ”å–</div>
                    <div class="list-body" id="list-diet-r"></div>
                </div>
            </div>

            <hr style="margin: 30px 0; border:0; border-top:2px dashed #ddd;">

            <h3 style="color:var(--primary); margin-bottom:10px;">ğŸ” å–®é …é£Ÿç‰©æŸ¥è©¢</h3>
            <div class="select-wrapper">
                <select id="food-select" onchange="checkFood()">
                    <option value="">è«‹é»æ­¤é¸æ“‡é£Ÿç‰©...</option>
                    <optgroup label="å¸¸è¦‹é£Ÿæ">
                        <option value="egg">é›è›‹ç™½</option><option value="tofu">å«©è±†è…</option><option value="rice_noodle">å†¬ç²‰/ç±³ç²‰</option><option value="rice">ç™½é£¯</option><option value="veg">é«˜éº—èœ/æ´‹è”¥</option><option value="fruit_low">è˜‹æœ/é³³æ¢¨</option><option value="oil">æ©„æ¬–æ²¹/è‹¦èŒ¶æ²¹</option>
                        <option value="spinach">è èœ/åœ°ç“œè‘‰</option><option value="brown_rice">ç³™ç±³/äº”ç©€ç±³</option><option value="nuts">å …æœ</option><option value="coffee">é»‘å’–å•¡</option><option value="banana">é¦™è•‰</option>
                        <option value="starfruit">æ¥Šæ¡ƒ</option><option value="sausage">é¦™è…¸/ç«è…¿</option><option value="organs">å…§è‡Ÿ(è±¬è‚)</option><option value="cola">å¯æ¨‚/æ±½æ°´</option><option value="chicken">é›ç²¾</option>
                    </optgroup>
                </select>
            </div>
            <div id="food-result" class="med-result-box hidden"></div>
        </div>
    </div>

    <div id="tab-quiz" class="section">
        <div class="card">
            <h2>ğŸ“ è…åˆ©å¤§æœƒè€ƒ</h2>
            <div class="progress-bar"><div id="quiz-progress" class="progress-fill"></div></div>
            <p id="quiz-counter" style="text-align:right; color:#666;">Q1/10</p>
            <div id="quiz-area">
                <h3 id="quiz-question" style="min-height:60px;">è¼‰å…¥ä¸­...</h3>
                <div id="quiz-options"></div>
            </div>
            <div id="quiz-feedback" class="hidden" style="margin-top:20px;">
                <div id="quiz-res-text" style="font-size:1.5rem; font-weight:900; margin-bottom:10px;"></div>
                <div id="quiz-exp" style="background:#fff; padding:15px; border-radius:10px; border:1px solid #ccc; color:#444;"></div>
                <button class="btn btn-next" onclick="nextQ()">ä¸‹ä¸€é¡Œ âœ</button>
            </div>
            <div id="quiz-score" class="hidden">
                <h3 style="font-size:3rem; color:var(--primary);">å¾—åˆ†ï¼š<span id="final-score">0</span></h3>
                <button class="btn" onclick="initQuiz()">ğŸ”„ å†æ¸¬ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <div id="tab-consult" class="section">
        <div class="card">
            <h2>ğŸ’¬ è—¥å¸«è«®è©¢å®¤</h2>
            
            <div style="background:#f9f9f9; padding:20px; border-radius:20px; border:2px solid #eee; margin-bottom:20px;">
                <h3 style="color:#06c755; margin-top:0;">LINE å®˜æ–¹å¸³è™Ÿ</h3>
                <div class="qr-box">
                    <img src="line_qr.png" class="qr-img" onerror="this.style.display='none'">
                </div>
                <a href="https://lin.ee/zwLjX1Lb" target="_blank" class="btn btn-line">ğŸ“² åŠ å…¥å¥½å‹ (ç·šä¸Šè«®è©¢)</a>
            </div>

            <div style="background:#fff8e1; padding:20px; border-radius:20px; border:2px solid #ffe0b2;">
                <h3 style="color:var(--accent); margin-top:0;">æ…¢ç®‹é ç´„</h3>
                <p style="font-weight:bold; color:#555;">ä¸ç”¨æ’éšŠï¼Œæ‰‹æ©Ÿé ç´„é ˜è—¥</p>
                <a href="https://nreg.fyh.mohw.gov.tw/OReg/HomePage?page=ChronicRegisterPage#" target="_blank" class="btn btn-refill">å‰å¾€é ç´„ âœ</a>
            </div>
        </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home')"><span class="nav-icon">ğŸ </span>é¦–é </div>
    <div class="nav-item" onclick="switchTab('meds')"><span class="nav-icon">ğŸ’Š</span>ç”¨è—¥</div>
    <div class="nav-item" onclick="switchTab('diet')"><span class="nav-icon">ğŸ¥¦</span>é£²é£Ÿ</div>
    <div class="nav-item" onclick="switchTab('quiz')"><span class="nav-icon">ğŸ“</span>æ¸¬é©—</div>
    <div class="nav-item" onclick="switchTab('consult')"><span class="nav-icon">ğŸ’¬</span>è«®è©¢</div>
</nav>

<script>
    // --- ğŸ”Š éŸ³æ•ˆç”¢ç”Ÿå™¨ (å…ä¸‹è¼‰æª”æ¡ˆ) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(isCorrect) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (isCorrect) {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- DATABASE ---
    const medDB = {
        'nsaid': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (NSAIDs)', desc: 'æœ€å¼·çƒˆçš„è…è‡Ÿæ®ºæ‰‹ï¼é€™é¡æ­¢ç—›è—¥æœƒæ”¶ç¸®å…¥çƒå°å‹•è„ˆï¼Œæ¥µæ˜“é€ æˆæ€¥æ€§è…æå‚·ã€‚è«‹æ”¹ç”¨æ™®æ‹¿ç–¼ã€‚' },
        'herbal': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (ä¸­è‰è—¥)', desc: 'ä¾†è·¯ä¸æ˜çš„é»‘è—¥ä¸¸æˆ–å«é¦¬å…œéˆ´é…¸è—¥æï¼Œæ˜¯å°ç£æ´—è…ä¸»å› ä¹‹ä¸€ã€‚è«‹å‹¿è½ä¿¡é›»å°å»£å‘Šã€‚' },
        'contrast': { level: 'r', title: 'âš ï¸ é«˜é¢¨éšª (é¡¯å½±åŠ‘)', desc: 'åš CT æª¢æŸ¥å‰è«‹å‹™å¿…å‘ŠçŸ¥é†«å¸«æ‚¨çš„ eGFRã€‚æª¢æŸ¥å¾Œéœ€å¤§é‡å–æ°´å¹«åŠ©ä»£è¬ã€‚' },
        'mycin': { level: 'r', title: 'âš ï¸ é«˜é¢¨éšª (æŠ—ç”Ÿç´ )', desc: 'æŸäº›æŠ—ç”Ÿç´  (å¦‚ Aminoglycosides) å…·è…æ¯’æ€§ï¼Œä½¿ç”¨æ™‚éœ€ç›£æ¸¬è—¥ç‰©æ¿ƒåº¦ã€‚' },
        'starfruit_j': { level: 'r', title: 'ğŸ›‘ çµ•å°ç¦æ­¢ (æ¥Šæ¡ƒ)', desc: 'æ¥Šæ¡ƒå«ç¥ç¶“æ¯’ç´ ï¼Œè…å‹ç„¡æ³•æ’å‡ºï¼Œæœƒå°è‡´æ‰“å—ã€ç™²ç™‡ç”šè‡³æ˜è¿·ã€‚' },
        'smoking': { level: 'r', title: 'ğŸ›‘ å»ºè­°æˆ’é™¤ (å¸è¸)', desc: 'å°¼å¤ä¸æœƒæ”¶ç¸®è…è‡Ÿè¡€ç®¡ï¼ŒåŠ é€Ÿè…çµ²çƒç¡¬åŒ–ã€‚æˆ’è¸æ˜¯è­·è…ç¬¬ä¸€æ­¥ã€‚' },
        'hold_urine': { level: 'r', title: 'ğŸ›‘ å£ç¿’æ…£ (æ†‹å°¿)', desc: 'æ˜“å¼•ç™¼æ³Œå°¿é“æ„ŸæŸ“ï¼Œç´°èŒé€†è¡Œå‘ä¸Šæå°è‡´è…ç›‚è…ç‚ï¼Œæå‚·è…åŠŸèƒ½ã€‚' },
        'diuretic': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (åˆ©å°¿åŠ‘)', desc: 'æœ‰åŠ©æ¶ˆæ°´è…«ï¼Œä½†è‹¥è„«æ°´æˆ–ç”Ÿç—… (Sick Day) æ™‚éœ€è©•ä¼°æš«åœï¼Œä»¥å…æ€¥æ€§è…è¡°ç«­ã€‚' },
        'metformin': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (é™ç³–è—¥)', desc: 'eGFR < 30 åˆ†æ™‚é€šå¸¸éœ€åœç”¨ï¼Œä»¥å…ç™¼ç”Ÿä¹³é…¸ä¸­æ¯’ã€‚' },
        'vit_d': { level: 'y', title: 'ğŸŸ¡ éœ€ç›£æ¸¬ (ç¶­ç”Ÿç´ D)', desc: 'å»ºè­°ç”±é†«å¸«é–‹ç«‹æ´»æ€§ç¶­ç”Ÿç´  Dï¼Œéœ€å®šæœŸç›£æ¸¬è¡€éˆ£èˆ‡è¡€ç£·æ¿ƒåº¦ã€‚' },
        'multi_vit': { level: 'y', title: 'ğŸŸ¡ éœ€æŒ‘é¸ (ç¶œåˆç¶­ä»–å‘½)', desc: 'å¸‚å”®ç”¢å“å¯èƒ½å«é«˜ç£·ã€é«˜é‰€ã€‚é€æç—…æ‚£å»ºè­°è£œå……å°ˆç”¨æ°´æº¶æ€§ B ç¾¤ã€‚' },
        'enema': { level: 'y', title: 'ğŸŸ¡ éœ€å‘ŠçŸ¥ (æ¸…è…¸åŠ‘)', desc: 'å«ç£·é…¸éˆ‰çš„æ¸…è…¸åŠ‘å¯èƒ½é€ æˆæ€¥æ€§ç£·è…ç—…è®Šï¼Œè«‹äº‹å…ˆå‘ŠçŸ¥é†«å¸«ç—…å²ã€‚' },
        'antacid': { level: 'y', title: 'ğŸŸ¡ éœ€æ³¨æ„ (èƒƒè—¥)', desc: 'é¿å…é•·æœŸæœç”¨å«ã€Œé‹ã€æˆ–ã€Œé‚ã€çš„åˆ¶é…¸åŠ‘ï¼Œè…è‡Ÿç„¡æ³•ä»£è¬æä¸­æ¯’ã€‚' },
        'dehydration': { level: 'y', title: 'ğŸŸ¡ éœ€å–æ°´ (è„«æ°´)', desc: 'é™¤éé†«å¸«é™æ°´ï¼Œå¦å‰‡é£²æ°´ä¸è¶³æœƒæ¸›å°‘è…è‡Ÿè¡€æµã€‚' },
        'constipation': { level: 'y', title: 'ğŸŸ¡ éœ€æ”¹å–„ (ä¾¿ç§˜)', desc: 'ä¾¿ç§˜æœƒå¢åŠ è…¸é“å°¿æ¯’ç´ çš„å¸æ”¶ï¼ŒåŠ é‡è…è‡Ÿè² æ“”ã€‚' },
        'sglt2': { level: 'g', title: 'âœ… å¼·åŠ›æ¨è–¦ (æ’ç³–è—¥)', desc: 'æ–°ä¸€ä»£è­·è…ç¥è—¥ï¼èƒ½é¡¯è‘—å»¶ç·©æ´—è…æ™‚é–“ä¸¦ä¿è­·å¿ƒè‡Ÿï¼Œä½†éœ€æ³¨æ„ç”Ÿæ®–å™¨æ¸…æ½”ã€‚' },
        'ras': { level: 'g', title: 'âœ… å¼·åŠ›æ¨è–¦ (ACEi/ARB)', desc: 'é›–çŸ­æœŸå¯èƒ½è®“ eGFR å¾®é™ï¼Œä½†é•·æœŸèƒ½æ¸›å°‘è›‹ç™½å°¿ï¼Œæ˜¯æ ¸å¿ƒè­·è…è—¥ç‰©ã€‚' },
        'panadol': { level: 'g', title: 'âœ… ç›¸å°å®‰å…¨ (æ™®æ‹¿ç–¼)', desc: 'è‹¥éœ€æ­¢ç—›é€€ç‡’ï¼ŒAcetaminophen åœ¨å®‰å…¨åŠ‘é‡ä¸‹ä¸å‚·è…ï¼Œæ˜¯é¦–é¸è—¥ç‰©ã€‚' },
        'probiotic': { level: 'g', title: 'âœ… è¼”åŠ©æ¨è–¦ (ç›Šç”ŸèŒ)', desc: 'éƒ¨åˆ†ç‰¹å®šèŒæ ªè­‰å¯¦æœ‰åŠ©æ¸›å°‘è…¸é“å°¿æ¯’ç´ å‰é©…ç‰©ã€‚' },
        'bp_check': { level: 'g', title: 'âœ… å¿…è¦è¡Œç‚º (é‡è¡€å£“)', desc: 'æ§åˆ¶è¡€å£“ (<130/80) æ˜¯å»¶ç·©æ´—è…æœ€é‡è¦çš„ä¸€ä»¶äº‹ã€‚' },
        'vaccine': { level: 'g', title: 'âœ… å»ºè­°æ–½æ‰“ (ç–«è‹—)', desc: 'é é˜²æµæ„Ÿèˆ‡è‚ºç‚ï¼Œæ¸›å°‘å› åš´é‡æ„ŸæŸ“å¼•ç™¼æ€¥æ€§è…æå‚·çš„é¢¨éšªã€‚' }
    };

    const foodDB = {
        'egg': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'å„ªè³ªè›‹ç™½è³ªï¼Œæ¨è–¦é£Ÿç”¨ã€‚'},
        'tofu': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'æ¤ç‰©æ€§è›‹ç™½ï¼Œå°¿æ¯’ç´ å°‘ã€‚'},
        'rice_noodle': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'ä½æ°®æ¾±ç²‰ï¼Œè£œå……ç†±é‡é¦–é¸ã€‚'},
        'rice': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'æ¯”ç³™ç±³ä½ç£·ï¼Œé©åˆæ™šæœŸè…å‹ã€‚'},
        'veg': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'ä½é‰€è”¬èœï¼Œé©åˆé£Ÿç”¨ã€‚'},
        'fruit_low': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'ä½é‰€æ°´æœï¼Œå¯é©é‡é£Ÿç”¨ã€‚'},
        'oil': {t:'ğŸŸ¢ ç¶ ç‡ˆ', d:'å„ªè³ªå¥½æ²¹ï¼Œä¿è­·å¿ƒè¡€ç®¡ã€‚'},
        'spinach': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'é«˜é‰€ï¼Œè«‹æ±†ç‡™éå†åƒã€‚'},
        'brown_rice': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'é«˜ç£·ï¼Œæ™šæœŸå»ºè­°å°‘åƒã€‚'},
        'nuts': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'ç£·é‰€çš†é«˜ï¼Œä¸€å¤©é™ 5 é¡†ã€‚'},
        'coffee': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'å«é‰€ä¸”åˆ©å°¿ï¼Œä¸€å¤©ä¸€æ¯ã€‚'},
        'banana': {t:'ğŸŸ¡ é»ƒç‡ˆ', d:'é«˜é‰€æ°´æœï¼Œè¡€é‰€é«˜è€…é¿å…ã€‚'},
        'starfruit': {t:'ğŸ”´ ç´…ç‡ˆ', d:'çµ•å°ç¦æ­¢ï¼å«ç¥ç¶“æ¯’ç´ ã€‚'},
        'sausage': {t:'ğŸ”´ ç´…ç‡ˆ', d:'åŠ å·¥è‚‰å“å«ç„¡æ©Ÿç£·ï¼Œæ¥µå‚·è…ã€‚'},
        'organs': {t:'ğŸ”´ ç´…ç‡ˆ', d:'å…§è‡Ÿé«˜æ¯’ç´ ã€é«˜ç£·ã€‚'},
        'cola': {t:'ğŸ”´ ç´…ç‡ˆ', d:'å«å¤§é‡ç£·é…¸ï¼Œéš±å½¢æ®ºæ‰‹ã€‚'},
        'chicken': {t:'ğŸ”´ ç´…ç‡ˆ', d:'æ¿ƒç¸®é‰€èˆ‡æ™®æ—ï¼ŒåŠ é‡è² æ“”ã€‚'}
    };

    const quizData = [
        {q:"è¦æ”¹åƒã€Œè–„é¹½é†¬æ²¹ã€æˆ–ã€Œä½éˆ‰é¹½ã€å—ï¼Ÿ", a:[{t:"å°ï¼Œå°‘é¹½å°±å¥½",c:false},{t:"éŒ¯ï¼Œé‚£æ˜¯é«˜é‰€é¹½",c:true}], exp:"ä½éˆ‰é¹½é€šå¸¸ä»¥ã€Œé‰€ã€å–ä»£éˆ‰ï¼Œè…å‹æ’é‰€åŠŸèƒ½å·®ï¼Œåƒå¤šæè‡´å¿ƒå¾‹ä¸æ•´ã€‚"},
        {q:"é—œæ–¼å–æ°´ï¼Œä½•è€…æ­£ç¢ºï¼Ÿ", a:[{t:"å®Œå…¨ä¸èƒ½å–æ°´",c:false},{t:"æ²’æ°´è…«æ‡‰é©é‡å–",c:true}], exp:"é™¤éå·²é€ææˆ–åš´é‡æ°´è…«ï¼Œå¦å‰‡æ°´åˆ†ä¸è¶³æœƒæ¸›å°‘è…è‡Ÿè¡€æµï¼Œåè€Œå‚·è…ã€‚"},
        {q:"å¯ä»¥è‡ªå·±è²·ã€Œå¼·æ•ˆæ­¢ç—›è—¥ã€å—ï¼Ÿ", a:[{t:"çµ•å°ä¸å¯",c:true},{t:"å¯ä»¥ï¼Œå°‘åƒå°±å¥½",c:false}], exp:"å¸‚å”®å¼·æ•ˆæ­¢ç—›è—¥(NSAIDs)æœƒæ”¶ç¸®è…è¡€ç®¡ï¼Œæ¥µæ˜“é€ æˆæ€¥æ€§è…æå‚·ã€‚"},
        {q:"å°¿æœ‰æ³¡æ³¡å°±æ˜¯è…è‡Ÿå£äº†å—ï¼Ÿ", a:[{t:"ä¸ä¸€å®šï¼Œéœ€æª¢é©—",c:true},{t:"å°ï¼Œæº–å‚™æ´—è…",c:false}], exp:"å°¿å¤ªæ¿ƒæˆ–è¡åŠ›å¤§ä¹Ÿæœƒæœ‰æ³¡æ³¡ã€‚è‹¥æ³¡æ³¡ã€Œ10åˆ†é˜ä¸æ•£ã€æ‰é«˜åº¦æ‡·ç–‘è›‹ç™½å°¿ã€‚"},
        {q:"æ¥Šæ¡ƒå¾ˆå¥½åƒï¼Œåƒä¸€é»æ²’é—œä¿‚ï¼Ÿ", a:[{t:"çµ•å°ç¦æ­¢",c:true},{t:"å¯ä»¥åƒä¸€å£",c:false}], exp:"æ¥Šæ¡ƒå«ç¥ç¶“æ¯’ç´ ï¼Œè…å‹ç„¡æ³•ä»£è¬ï¼Œé£Ÿç”¨æå°è‡´æŠ½ææ˜è¿·ã€‚"},
        {q:"é—œæ–¼è›‹ç™½è³ªæ”å–ï¼Œå“ªç¨®é¸æ“‡è¼ƒä½³ï¼Ÿ", a:[{t:"åªæœ‰å‹•ç‰©è›‹ç™½",c:false},{t:"æ¤ç‰©æ€§è›‹ç™½å¦‚è±†è…ä¹Ÿä¸éŒ¯",c:true}], exp:"è±†é¡ï¼ˆå¦‚è±†è…ï¼‰æ˜¯å„ªè³ªæ¤ç‰©æ€§è›‹ç™½ï¼Œèƒ½æ¸›å°‘å«æ°®å»¢ç‰©ç”¢ç”Ÿï¼Œé©åˆè…å‹é£Ÿç”¨ã€‚"},
        {q:"è¡€å£“è—¥åƒå¤šäº†æœƒå‚·è…ï¼Œæ‰€ä»¥è¡€å£“æ­£å¸¸å°±è©²åœè—¥ï¼Ÿ", a:[{t:"å°ï¼Œåƒè—¥å‚·è…",c:false},{t:"éŒ¯ï¼Œæ“…è‡ªåœè—¥æ›´å‚·è…",c:true}], exp:"é«˜è¡€å£“æ˜¯æ´—è…ä¸»å› ä¹‹ä¸€ï¼Œç©©å®šæ§åˆ¶è¡€å£“åè€Œèƒ½ä¿è­·è…è‡Ÿï¼Œåˆ‡å‹¿è‡ªè¡Œåœè—¥ã€‚"},
        {q:"åŠ å·¥é£Ÿå“ï¼ˆå¦‚é¦™è…¸ã€è²¢ä¸¸ï¼‰ç‚ºä»€éº¼å°‘åƒï¼Ÿ", a:[{t:"ç†±é‡å¤ªä½",c:false},{t:"å«é«˜é‡ç„¡æ©Ÿç£·ï¼Œå‚·è…",c:true}], exp:"åŠ å·¥é£Ÿå“æ·»åŠ çš„ç£·é…¸é¹½ï¼ˆç„¡æ©Ÿç£·ï¼‰å¸æ”¶ç‡é«˜é”100%ï¼Œæ¥µæ˜“é€ æˆé«˜è¡€ç£·ï¼Œå°è‡´è¡€ç®¡éˆ£åŒ–ã€‚"},
        {q:"è…è‡Ÿç—…åˆæœŸé€šå¸¸æœ‰ä»€éº¼æ˜é¡¯ç—‡ç‹€ï¼Ÿ", a:[{t:"è…°è¶…ç—›",c:false},{t:"é€šå¸¸æ²’ç—‡ç‹€ï¼Œéœ€é æª¢æŸ¥",c:true}], exp:"è…è‡Ÿæ˜¯æ²‰é»˜çš„å™¨å®˜ï¼ŒåˆæœŸå¤šç„¡ç—‡ç‹€ï¼Œå®šæœŸæŠ½è¡€é©—å°¿æ‰æ˜¯å”¯ä¸€ç™¼ç¾é€”å¾‘ã€‚"},
        {q:"è½èªªã€Œæ´—è…ã€å¾Œäººç”Ÿå°±é»‘ç™½äº†ï¼Ÿ", a:[{t:"å°ï¼Œæ²’æ•‘äº†",c:false},{t:"éŒ¯ï¼Œä»å¯ç¶­æŒç”Ÿæ´»å“è³ª",c:true}], exp:"é…åˆæ²»ç™‚èˆ‡é€æï¼Œè¨±å¤šè…å‹ä»èƒ½å‡ºåœ‹æ—…éŠã€å·¥ä½œï¼Œç”Ÿæ´»ä¾ç„¶å¯ä»¥å¾ˆç²¾å½©ã€‚"}
    ];

    // --- Logic Functions ---

    function switchTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        const idx = (id==='home')?0:(id==='meds')?1:(id==='diet')?2:(id==='quiz')?3:4;
        document.querySelectorAll('.nav-item')[idx].classList.add('active');
        window.scrollTo(0,0);
    }

    // Auto Calc Logic
    function calcRisk() {
        const egfr = document.getElementById('egfr-input').value;
        const uacr = document.getElementById('albumin-input').value;
        if (!egfr) return; 

        document.getElementById('start-hint').classList.add('hidden');
        document.getElementById('risk-result-area').classList.remove('hidden');
        document.querySelectorAll('.matrix-cell').forEach(c => c.classList.remove('active-cell'));

        const eVal = parseFloat(egfr);
        let row = '5', stageText = 'ç¬¬5æœŸ';
        if (eVal >= 90) { row = '1'; stageText = 'ç¬¬1æœŸ'; }
        else if (eVal >= 60) { row = '2'; stageText = 'ç¬¬2æœŸ'; }
        else if (eVal >= 45) { row = '3a'; stageText = 'ç¬¬3aæœŸ'; }
        else if (eVal >= 30) { row = '3b'; stageText = 'ç¬¬3bæœŸ'; }
        else if (eVal >= 15) { row = '4'; stageText = 'ç¬¬4æœŸ'; }

        let col = '1', uacrText = 'æ­£å¸¸/è¼•å¾®';
        if (uacr === 'A2') { col = '2'; uacrText = 'å¾®é‡è›‹ç™½å°¿'; }
        if (uacr === 'A3') { col = '3'; uacrText = 'åš´é‡è›‹ç™½å°¿'; }

        const cellId = `cell-${row}-${col}`;
        const cell = document.getElementById(cellId);
        if (cell) cell.classList.add('active-cell');

        let color = '#e03e2e', text = 'è¶…é«˜é¢¨éšª';
        if (cell.classList.contains('bg-g')) { color = '#6bbd45'; text = 'ä½é¢¨éšª (å®šæœŸè¿½è¹¤)'; }
        else if (cell.classList.contains('bg-y')) { color = '#ffd700'; text = 'ä¸­åº¦é¢¨éšª (éœ€æ³¨æ„)'; }
        else if (cell.classList.contains('bg-o')) { color = '#f58220'; text = 'é«˜é¢¨éšª (åš´æ ¼æ§åˆ¶)'; }

        const banner = document.getElementById('risk-banner');
        banner.style.backgroundColor = color;
        banner.style.color = (color === '#ffd700') ? '#222' : '#fff'; 
        
        document.getElementById('risk-title').innerText = text;
        document.getElementById('risk-desc').innerText = `è…çµ²çƒéæ¿¾ç‡${stageText} + ${uacrText}`;

        updateMeds(eVal);
        updateDiet(eVal);
    }

    // Dynamic Meds Advice
    function updateMeds(egfr) {
        document.getElementById('med-placeholder').classList.add('hidden');
        document.getElementById('med-content').classList.remove('hidden');
        
        const sel = document.getElementById('egfr-input');
        const txt = sel.options[sel.selectedIndex].text;
        document.getElementById('med-egfr-val').innerText = txt;

        const g = document.getElementById('list-med-g');
        const y = document.getElementById('list-med-y');
        const r = document.getElementById('list-med-r');
        g.innerHTML = ''; y.innerHTML = ''; r.innerHTML = '';

        function add(list, title, desc) {
            list.innerHTML += `<div class="list-item"><span class="list-title">${title}</span><span style="color:#555;">${desc}</span></div>`;
        }

        add(g, "ACEi / ARB (è¡€å£“è—¥)", "é™ä½è›‹ç™½å°¿ï¼Œå»¶ç·©æƒ¡åŒ–é¦–é¸ã€‚");
        add(g, "SGLT2 æŠ‘åˆ¶åŠ‘ (æ’ç³–è—¥)", "åœ‹éš›å¼·æ¨ï¼Œä¿è­·å¿ƒè‡Ÿèˆ‡è…è‡Ÿã€‚");
        add(g, "Statins (é™è¡€è„‚è—¥)", "é é˜²è¡€ç®¡é˜»å¡èˆ‡ä¸­é¢¨ã€‚");

        add(y, "Diuretics (åˆ©å°¿åŠ‘)", "æ‹‰è‚šå­/è„«æ°´æ™‚éœ€è©•ä¼°æš«åœã€‚");
        add(y, "æŠ—ç”Ÿç´  (Antibiotics)", "çœ‹è¨ºè«‹ä¸»å‹•å‘ŠçŸ¥é†«å¸«è…åŠŸèƒ½ã€‚");

        add(r, "NSAIDs (å¼·æ•ˆæ­¢ç—›è—¥)", "å‚·è…åœ°é›·ï¼æ˜“å°è‡´æ€¥æ€§è¡°ç«­ã€‚");
        add(r, "ä¾†è·¯ä¸æ˜ä¸­è‰è—¥", "å¯èƒ½å«é‡é‡‘å±¬/é¦¬å…œéˆ´é…¸ï¼Œç¦æ­¢ã€‚");
        add(r, "å«ç¢˜é¡¯å½±åŠ‘ (CT)", "æª¢æŸ¥å‰å‘ŠçŸ¥é†«å¸«ï¼Œäº‹å¾Œå¤šå–æ°´ã€‚");

        if (egfr < 30) {
            add(r, "Metformin (é™ç³–è—¥)", "eGFR < 30 ç¦æ­¢ä½¿ç”¨ (ä¹³é…¸ä¸­æ¯’é¢¨éšª)ã€‚");
        } else if (egfr < 45) {
            add(y, "Metformin (é™ç³–è—¥)", "eGFR 30-45 éœ€æ¸›é‡å°å¿ƒä½¿ç”¨ã€‚");
        }
    }

    // Dynamic Diet Advice
    function updateDiet(egfr) {
        document.getElementById('diet-placeholder').classList.add('hidden');
        document.getElementById('diet-content').classList.remove('hidden');

        const g = document.getElementById('list-diet-g');
        const y = document.getElementById('list-diet-y');
        const r = document.getElementById('list-diet-r');
        g.innerHTML = ''; y.innerHTML = ''; r.innerHTML = '';

        function add(list, title, desc) {
            list.innerHTML += `<div class="list-item"><span class="list-title">${title}</span><span style="color:#555;">${desc}</span></div>`;
        }

        add(g, "å„ªè³ªè›‹ç™½è³ª", "é›è›‹ã€è±†è…ã€é­šè‚‰ã€‚");
        add(g, "å¤©ç„¶å¥½æ²¹", "æ©„æ¬–æ²¹ã€è‹¦èŒ¶æ²¹ã€‚");
        add(r, "æ¥Šæ¡ƒ (çµ•å°ç¦æ­¢)", "å«ç¥ç¶“æ¯’ç´ ï¼Œåš´é‡ææ˜è¿·ã€‚");
        add(r, "åŠ å·¥è‚‰å“", "é¦™è…¸ç«è…¿å«é«˜ç£·ï¼Œæ¥µå‚·è¡€ç®¡ã€‚");

        if (egfr < 45) { 
            add(g, "ä½æ°®æ¾±ç²‰", "å†¬ç²‰ã€ç±³ç²‰ã€‚è£œå……ç†±é‡ä¸å‚·è…ã€‚");
            add(y, "ç³™ç±³/äº”ç©€ç±³", "ç£·å«é‡é«˜ï¼Œæ™šæœŸå»ºè­°æ”¹åƒç™½é£¯ã€‚");
            add(y, "æ·±ç¶ è‰²è”¬èœ", "é‰€é«˜ï¼Œå»ºè­°åˆ‡æ®µæ±†ç‡™å¾Œå†åƒã€‚");
            add(y, "å …æœé¡", "ç£·é‰€é›™é«˜ï¼Œå°‘åƒç‚ºå¦™ã€‚");
            add(r, "ä½éˆ‰é¹½", "é€šå¸¸æ˜¯ã€Œé«˜é‰€é¹½ã€ï¼Œæœƒå¿ƒå¾‹ä¸æ•´ã€‚");
        } else { 
            add(g, "è”¬èœæ°´æœ", "ä¿æŒæ’ä¾¿é †æš¢ã€‚");
            add(y, "é‡å£å‘³é£Ÿç‰©", "é¹½åˆ†å¤ªé«˜æœƒå‚·è…ã€‚");
        }
    }

    // Lookup Tool Logic
    function checkMed() {
        const val = document.getElementById('med-select').value;
        const lights = document.querySelectorAll('.light');
        const res = document.getElementById('med-result');
        lights.forEach(l => l.classList.remove('on'));
        res.classList.add('hidden');
        if(!val) return;

        const data = medDB[val];
        res.classList.remove('hidden');
        res.innerHTML = `<strong>${data.title}</strong><br>${data.desc}`;
        
        if (data.level === 'r') {
            document.getElementById('light-r').classList.add('on');
            res.style.borderColor = "var(--danger)"; res.style.background = "#fff5f5";
        } else if (data.level === 'y') {
            document.getElementById('light-y').classList.add('on');
            res.style.borderColor = "var(--warning)"; res.style.background = "#fffbf0";
        } else {
            document.getElementById('light-g').classList.add('on');
            res.style.borderColor = "var(--success)"; res.style.background = "#e6fffa";
        }
    }

    function checkFood() {
        const val = document.getElementById('food-select').value;
        const res = document.getElementById('food-result');
        res.classList.add('hidden');
        if(!val) return;
        const data = foodDB[val];
        res.classList.remove('hidden');
        res.innerHTML = `<strong style="font-size:1.4rem;">${data.t}</strong><br>${data.d}`;
        if(data.t.includes('ç´…')) { res.style.borderColor = 'red'; res.style.background = '#fff5f5'; }
        else if(data.t.includes('é»ƒ')) { res.style.borderColor = 'gold'; res.style.background = '#fffbe6'; }
        else { res.style.borderColor = 'green'; res.style.background = '#e8f5e9'; }
    }

    // Quiz Logic
    let qIdx = 0, score = 0;
    
    function initQuiz() { 
        qIdx=0; score=0; 
        document.getElementById('quiz-score').classList.add('hidden'); 
        document.getElementById('quiz-area').classList.remove('hidden'); 
        renderQ(); 
    }
    
    function renderQ() {
        const q = quizData[qIdx];
        document.getElementById('quiz-counter').innerText = `Q${qIdx+1}/${quizData.length}`;
        document.getElementById('quiz-question').innerText = q.q;
        document.getElementById('quiz-feedback').classList.add('hidden');
        const div = document.getElementById('quiz-options');
        div.innerHTML = '';
        q.a.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'quiz-option';
            btn.innerText = opt.t;
            btn.onclick = () => checkAnswer(btn, opt.c);
            div.appendChild(btn);
        });
        document.querySelector('.progress-fill').style.width = `${((qIdx)/quizData.length)*100}%`;
    }

    function checkAnswer(btn, isCorrect) {
        playSound(isCorrect);
        document.querySelectorAll('.quiz-option').forEach(b => b.style.pointerEvents = 'none');
        if (isCorrect) { 
            btn.classList.add('correct'); 
            score += 10; 
            document.getElementById('quiz-res-text').innerText = "ğŸ‰ ç­”å°äº†ï¼"; 
            document.getElementById('quiz-res-text').style.color = "var(--success)"; 
        } else { 
            btn.classList.add('wrong'); 
            document.getElementById('quiz-res-text').innerText = "ğŸ˜± ç­”éŒ¯å›‰ï¼"; 
            document.getElementById('quiz-res-text').style.color = "var(--danger)"; 
        }
        document.getElementById('quiz-feedback-box').classList.remove('hidden');
        document.getElementById('quiz-explanation').innerText = quizData[qIdx].exp;
    }

    function nextQ() {
        qIdx++;
        if(qIdx < quizData.length) renderQ();
        else {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('quiz-feedback').classList.add('hidden');
            document.getElementById('quiz-score').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.querySelector('.progress-fill').style.width = '100%';
        }
    }
    initQuiz();
</script>
</body>
</html>
